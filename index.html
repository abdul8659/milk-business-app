<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Complete Online Business Solution</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            overflow-x: auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .backup-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .backup-status.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .backup-status.syncing {
            background: rgba(255, 152, 0, 0.9);
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            overflow-x: auto;
            min-width: 800px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.9);
            border-color: white;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        .content-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 500px;
            overflow-x: auto;
        }

        .controls-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .customer-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .customer-card:hover {
            transform: translateY(-5px);
        }

        .customer-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .customer-card:hover::before {
            right: -40%;
        }

        .add-customer-card {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: white;
            text-align: center;
        }

        .payment-status {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .payment-status.paid {
            background: rgba(76, 175, 80, 0.9);
        }

        .payment-status.partial {
            background: rgba(255, 152, 0, 0.9);
        }

        .payment-status.pending {
            background: rgba(244, 67, 54, 0.9);
        }

        .customer-delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(244, 67, 54, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .customer-delete-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }

        .ledger-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ledger-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ledger-entries {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
        }

        .entry-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .entry-item.day-off {
            border-left-color: #ff416c;
            background: #fff5f5;
        }

        .entry-item.payment {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }

        .entry-actions {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 3px;
            z-index: 10;
        }

        .entry-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.2s ease;
            color: white;
            font-weight: bold;
        }

        .edit-btn {
            background: #2196F3;
        }

        .edit-btn:hover {
            background: #1976D2;
            transform: scale(1.1);
        }

        .delete-btn {
            background: #f44336;
        }

        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .entry-content {
            margin-left: 85px;
        }

        .online-features {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .pdf-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .backup-section {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .backup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .backup-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .github-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-online { background: #4CAF50; }
        .status-offline { background: #f44336; }
        .status-syncing { background: #ff9800; animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        }

        .btn.pdf {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .btn.payment {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .btn.holiday {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .btn.success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .hidden {
            display: none;
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .report-filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .required-field {
            border: 2px solid #ff9800 !important;
            background-color: #fff3e0 !important;
        }

        .month-selector {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .month-selector h3 {
            color: white;
            margin-bottom: 15px;
            text-align: center;
        }

        .month-selector select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            text-align: center;
            background: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .customers-grid {
                grid-template-columns: 1fr;
            }
            
            .main-nav {
                gap: 5px;
                min-width: 100%;
                overflow-x: auto;
            }
            
            .nav-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 12px;
            }

            .entry-content {
                margin-left: 75px;
            }

            .ledger-header {
                flex-direction: column;
                align-items: stretch;
            }

            .ledger-actions {
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="backup-status" id="backup-status">
        <span class="status-indicator status-online"></span>
        Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
            <p>Complete Online Business Solution with Enhanced Features</p>
        </div>

        <nav class="main-nav">
            <button class="nav-btn active" onclick="showDashboard()">
                ğŸ“ˆ ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ
            </button>
            <button class="nav-btn" onclick="showCustomers()">
                ğŸ‘¥ Ú¯Ø§ÛÚ©
            </button>
            <button class="nav-btn" onclick="showReports()">
                ğŸ“Š Ø±Ù¾ÙˆØ±Ù¹Ø³
            </button>
            <button class="nav-btn" onclick="showBackupManagement()">
                â˜ï¸ Ø¢Ù† Ù„Ø§Ø¦Ù† Ø¨ÛŒÚ© Ø§Ù¾
            </button>
            <button class="nav-btn" onclick="showDataManagement()">
                ğŸ—‚ï¸ ÚˆÛŒÙ¹Ø§ Ù…Ù†ÛŒØ¬Ù…Ù†Ù¹
            </button>
        </nav>

        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard-section">
                <div class="month-selector">
                    <h3>ğŸ“… Ú©Ø§Ù… Ú©Ø§ Ù…ÛÛŒÙ†Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h3>
                    <select id="working-month" onchange="updateWorkingMonth()">
                        <option value="2024-01">Ø¬Ù†ÙˆØ±ÛŒ 2024</option>
                        <option value="2024-02">ÙØ±ÙˆØ±ÛŒ 2024</option>
                        <option value="2024-03">Ù…Ø§Ø±Ú† 2024</option>
                        <option value="2024-04">Ø§Ù¾Ø±ÛŒÙ„ 2024</option>
                        <option value="2024-05">Ù…Ø¦ÛŒ 2024</option>
                        <option value="2024-06">Ø¬ÙˆÙ† 2024</option>
                        <option value="2024-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2024</option>
                        <option value="2024-08">Ø§Ú¯Ø³Øª 2024</option>
                        <option value="2024-09">Ø³ØªÙ…Ø¨Ø± 2024</option>
                        <option value="2024-10">Ø§Ú©ØªÙˆØ¨Ø± 2024</option>
                        <option value="2024-11">Ù†ÙˆÙ…Ø¨Ø± 2024</option>
                        <option value="2024-12">Ø¯Ø³Ù…Ø¨Ø± 2024</option>
                        <option value="2025-01">Ø¬Ù†ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-02">ÙØ±ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-03">Ù…Ø§Ø±Ú† 2025</option>
                        <option value="2025-04">Ø§Ù¾Ø±ÛŒÙ„ 2025</option>
                        <option value="2025-05">Ù…Ø¦ÛŒ 2025</option>
                        <option value="2025-06">Ø¬ÙˆÙ† 2025</option>
                        <option value="2025-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025</option>
                        <option value="2025-08">Ø§Ú¯Ø³Øª 2025</option>
                        <option value="2025-09">Ø³ØªÙ…Ø¨Ø± 2025</option>
                        <option value="2025-10">Ø§Ú©ØªÙˆØ¨Ø± 2025</option>
                        <option value="2025-11">Ù†ÙˆÙ…Ø¨Ø± 2025</option>
                        <option value="2025-12">Ø¯Ø³Ù…Ø¨Ø± 2025</option>
                    </select>
                </div>

                <h2 class="section-title">ğŸ“ˆ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="total-customers-stat">0</h3>
                        <p>Ú©Ù„ Ú¯Ø§ÛÚ©</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-revenue-stat">0</h3>
                        <p>Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-payments-stat">0</h3>
                        <p>ÙˆØµÙˆÙ„ Ø´Ø¯Û</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="pending-amount-stat">0</h3>
                        <p>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…</p>
                    </div>
                </div>

                <div class="online-features">
                    <h3>ğŸŒ Ø¢Ù† Ù„Ø§Ø¦Ù† ÙÛŒÚ†Ø±Ø²</h3>
                    <p>ÛŒÛ Ø§ÛŒÙ¾ Ù…Ú©Ù…Ù„ Ø·ÙˆØ± Ù¾Ø± Ø¢Ù† Ù„Ø§Ø¦Ù† Ú©Ø§Ù… Ú©Ø±ØªÛŒ ÛÛ’ Ø§ÙˆØ± Ø¢Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ø±Ú©Ú¾ØªÛŒ ÛÛ’Û”</p>
                    <div class="pdf-actions">
                        <button class="btn pdf" onclick="generateComprehensivePDFWithDownload()">ğŸ“„ Ù…Ú©Ù…Ù„ PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                        <button class="btn pdf" onclick="generateMonthlyPDFWithDownload()">ğŸ“… Ù…Ø§ÛØ§Ù†Û PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                        <button class="btn pdf" onclick="generateBusinessReportPDFWithDownload()">ğŸ“Š Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                    </div>
                </div>
            </div>

            <!-- Customers Section -->
            <div id="customers-section" class="hidden">
                <div class="controls-section">
                    <input type="text" class="search-box" id="customer-search" placeholder="Ú¯Ø§ÛÚ© ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº..." onkeyup="searchCustomers()">
                    <button class="btn success" onclick="showAddCustomerModal()">â• Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                </div>
                <div class="customers-grid" id="customers-grid">
                    <!-- Customers will be loaded here -->
                </div>
            </div>

            <!-- Ledger Section -->
            <div id="ledger-section" class="hidden">
                <div class="ledger-header">
                    <h2 id="ledger-title">Ú¯Ø§ÛÚ© Ú©Ú¾Ø§ØªÛ</h2>
                    <div class="ledger-actions">
                        <button class="btn success" onclick="showAddEntryModal()">â• Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ</button>
                        <button class="btn whatsapp" onclick="shareOnWhatsApp()">ğŸ“± WhatsApp</button>
                        <button class="btn pdf" onclick="generateCustomerLedgerPDFWithDownload()">ğŸ“„ Ù„ÛŒØ¬Ø± PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                        <button class="btn payment" onclick="showPaymentModal()">ğŸ’° Ø±Ù‚Ù… ÙˆØµÙˆÙ„ Ú©Ø±ÛŒÚº</button>
                        <button class="btn holiday" onclick="showDayOffModal()">ğŸš« Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</button>
                        <button class="btn" onclick="showCustomers()">â¬…ï¸ ÙˆØ§Ù¾Ø³</button>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="month-filter">Ù…ÛÛŒÙ†Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                    <select id="month-filter" onchange="loadLedgerEntries(currentCustomerId)" style="margin-right: 10px; padding: 8px; border-radius: 5px;">
                        <option value="all">ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’</option>
                        <option value="2024-01">Ø¬Ù†ÙˆØ±ÛŒ 2024</option>
                        <option value="2024-02">ÙØ±ÙˆØ±ÛŒ 2024</option>
                        <option value="2024-03">Ù…Ø§Ø±Ú† 2024</option>
                        <option value="2024-04">Ø§Ù¾Ø±ÛŒÙ„ 2024</option>
                        <option value="2024-05">Ù…Ø¦ÛŒ 2024</option>
                        <option value="2024-06">Ø¬ÙˆÙ† 2024</option>
                        <option value="2024-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2024</option>
                        <option value="2024-08">Ø§Ú¯Ø³Øª 2024</option>
                        <option value="2024-09">Ø³ØªÙ…Ø¨Ø± 2024</option>
                        <option value="2024-10">Ø§Ú©ØªÙˆØ¨Ø± 2024</option>
                        <option value="2024-11">Ù†ÙˆÙ…Ø¨Ø± 2024</option>
                        <option value="2024-12">Ø¯Ø³Ù…Ø¨Ø± 2024</option>
                        <option value="2025-01">Ø¬Ù†ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-02">ÙØ±ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-03">Ù…Ø§Ø±Ú† 2025</option>
                        <option value="2025-04">Ø§Ù¾Ø±ÛŒÙ„ 2025</option>
                        <option value="2025-05">Ù…Ø¦ÛŒ 2025</option>
                        <option value="2025-06">Ø¬ÙˆÙ† 2025</option>
                        <option value="2025-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025</option>
                        <option value="2025-08">Ø§Ú¯Ø³Øª 2025</option>
                        <option value="2025-09">Ø³ØªÙ…Ø¨Ø± 2025</option>
                        <option value="2025-10">Ø§Ú©ØªÙˆØ¨Ø± 2025</option>
                        <option value="2025-11">Ù†ÙˆÙ…Ø¨Ø± 2025</option>
                        <option value="2025-12">Ø¯Ø³Ù…Ø¨Ø± 2025</option>
                    </select>
                </div>

                <div class="ledger-entries" id="ledger-entries">
                    <!-- Entries will be loaded here -->
                </div>

                <div id="bill-summary" style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <!-- Bill summary will be shown here -->
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="hidden">
                <h2 class="section-title">ğŸ“Š Ø±Ù¾ÙˆØ±Ù¹Ø³ Ø§ÙˆØ± ØªØ¬Ø²ÛŒÛ</h2>
                
                <div class="report-filters">
                    <h3>Ø±Ù¾ÙˆØ±Ù¹ ÙÙ„Ù¹Ø±Ø²</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                            <input type="date" id="report-start-date">
                        </div>
                        <div class="filter-group">
                            <label>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                            <input type="date" id="report-end-date">
                        </div>
                        <div class="filter-group">
                            <label>Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù…:</label>
                            <select id="report-type">
                                <option value="all">ØªÙ…Ø§Ù…</option>
                                <option value="revenue">Ø¢Ù…Ø¯Ù†ÛŒ</option>
                                <option value="payments">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº</option>
                                <option value="pending">Ø¨Ø§Ù‚ÛŒØ§Øª</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <button class="btn" onclick="generateReport()">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                        </div>
                    </div>
                </div>

                <div id="report-results">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px;">
                            <h3>Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ</h3>
                            <p style="font-size: 2em; color: #4CAF50;" id="total-revenue">0 Ø±ÙˆÙ¾Û’</p>
                        </div>
                        <div style="background: #fff3e0; padding: 20px; border-radius: 10px;">
                            <h3>Ú©Ù„ Ú¯Ø§ÛÚ©</h3>
                            <p style="font-size: 2em; color: #ff9800;" id="total-customers">0</p>
                        </div>
                        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px;">
                            <h3>Ø§Ø³ Ù…Ø§Û Ø¢Ù…Ø¯Ù†ÛŒ</h3>
                            <p style="font-size: 2em; color: #2196F3;" id="monthly-revenue">0 Ø±ÙˆÙ¾Û’</p>
                        </div>
                        <div style="background: #fce4ec; padding: 20px; border-radius: 10px;">
                            <h3>ÙˆØµÙˆÙ„ Ø´Ø¯Û Ø±Ù‚Ù…</h3>
                            <p style="font-size: 2em; color: #e91e63;" id="total-received">0 Ø±ÙˆÙ¾Û’</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Backup Management Section -->
            <div id="backup-management-section" class="hidden">
                <h2 class="section-title">â˜ï¸ Ø¨ÛŒÚ© Ø§Ù¾ Ø§ÙˆØ± ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ÛŒØª</h2>
                
                <div class="backup-grid">
                    <!-- Local Storage Card -->
                    <div class="backup-card">
                        <h3>ğŸ“± Ù„ÙˆÚ©Ù„ Ø¨ÛŒÚ© Ø§Ù¾</h3>
                        <p>Ø¢Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</p>
                        <div style="margin: 15px 0;">
                            <div>Ø¢Ø®Ø±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾: <span id="local-backup-time">Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº</span></div>
                            <div>ÚˆÛŒÙ¹Ø§ Ø³Ø§Ø§Ø¦Ø²: <span id="data-size">0 KB</span></div>
                        </div>
                        <div>
                            <button class="btn" onclick="exportData()">ğŸ“¥ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ</button>
                            <button class="btn" onclick="document.getElementById('import-input').click()">ğŸ“¤ Ø§Ù¾ Ù„ÙˆÚˆ</button>
                            <input type="file" id="import-input" accept=".json" onchange="importData(event)" style="display: none;">
                        </div>
                    </div>

                    <!-- GitHub Backup Card -->
                    <div class="backup-card">
                        <h3>ğŸŒ GitHub Ø¨ÛŒÚ© Ø§Ù¾</h3>
                        <p>Ø¢Ù† Ù„Ø§Ø¦Ù† Ù…Ø­ÙÙˆØ¸ Ø¨ÛŒÚ© Ø§Ù¾</p>
                        <div id="github-status" style="margin: 15px 0;">
                            <div>Ø­Ø§Ù„Øª: <span class="status-indicator status-online"></span>ÙØ¹Ø§Ù„</div>
                            <div>Ø¢Ø®Ø±ÛŒ Ø³Ù†Ú©: <span id="github-sync-time">Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº</span></div>
                        </div>
                        
                        <div>
                            <button class="btn" onclick="testGitHubConnection()">ğŸ”— Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹</button>
                            <button class="btn" onclick="backupToGitHub()">â˜ï¸ GitHub Ù…ÛŒÚº Ø¨ÛŒÚ© Ø§Ù¾</button>
                            <button class="btn" onclick="restoreFromGitHub()">ğŸ“¥ GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ</button>
                        </div>
                    </div>

                    <!-- Auto Backup Card -->
                    <div class="backup-card">
                        <h3>âš¡ Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾</h3>
                        <p>Ø®ÙˆØ¯Ú©Ø§Ø± Ø·ÙˆØ± Ù¾Ø± ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</p>
                        <div style="margin: 15px 0;">
                            <label>
                                <input type="checkbox" id="auto-backup-enabled" onchange="updateAutoBackupSettings()" checked> 
                                Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ¹Ø§Ù„ Ú©Ø±ÛŒÚº
                            </label>
                            <div style="margin-top: 10px;">
                                <label>ÙˆÙ‚ÙÛ:</label>
                                <select id="backup-interval" onchange="updateAutoBackupSettings()">
                                    <option value="120000" selected>2 Ù…Ù†Ù¹</option>
                                    <option value="300000">5 Ù…Ù†Ù¹</option>
                                    <option value="600000">10 Ù…Ù†Ù¹</option>
                                    <option value="1800000">30 Ù…Ù†Ù¹</option>
                                    <option value="3600000">1 Ú¯Ú¾Ù†Ù¹Û</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <button class="btn" onclick="saveToStorage(); setTimeout(() => backupToGitHub(), 500);">ğŸ”„ ÙÙˆØ±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                    <h4>âš ï¸ Ø§ÛÙ… ÛØ¯Ø§ÛŒØ§Øª:</h4>
                    <ul style="margin-top: 10px; text-align: right;">
                        <li>GitHub Ú©Ù†Ú©Ø´Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ø·ÙˆØ± Ù¾Ø± Ø³ÛŒÙ¹ Ø§Ù¾ ÛÙˆ Ú¯ÛŒØ§ ÛÛ’</li>
                        <li>Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ ÛØ± 2 Ù…Ù†Ù¹ Ù…ÛŒÚº Ú†Ù„ØªØ§ ÛÛ’</li>
                        <li>ÚˆÛŒÙ¹Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ø·ÙˆØ± Ù¾Ø± GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ ÛÙˆØªØ§ ÛÛ’</li>
                        <li>Ù„ÙˆÚ©Ù„ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ú©Ùˆ Ù…Ø­ÙÙˆØ¸ Ø¬Ú¯Û Ø±Ú©Ú¾ÛŒÚº</li>
                    </ul>
                </div>
            </div>

            <!-- Data Management Section -->
            <div id="data-management-section" class="hidden">
                <h2 class="section-title">ğŸ—‚ï¸ ÚˆÛŒÙ¹Ø§ Ù…Ù†ÛŒØ¬Ù…Ù†Ù¹</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border: 2px solid #4CAF50;">
                        <h3 style="color: #4CAF50;">ğŸ“Š ÚˆÛŒÙ¹Ø§ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                        <div id="data-stats">
                            <p>Ú©Ù„ Ú¯Ø§ÛÚ©: <span id="stats-customers">0</span></p>
                            <p>Ú©Ù„ Ø§Ù†Ù¹Ø±ÛŒØ§Úº: <span id="stats-entries">0</span></p>
                            <p>Ú©Ù„ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº: <span id="stats-payments">0</span></p>
                            <p>ÚˆÛŒÙ¹Ø§ Ø³Ø§Ø§Ø¦Ø²: <span id="stats-size">0 KB</span></p>
                        </div>
                    </div>
                    
                    <div style="background: #ffebee; padding: 20px; border-radius: 10px; border: 2px solid #f44336;">
                        <h3 style="color: #f44336;">âš ï¸ Ø®Ø·Ø±Ù†Ø§Ú© Ø§ÛŒÚ©Ø´Ù†Ø²</h3>
                        <p style="margin: 10px 0;">ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§</p>
                        <button class="btn" onclick="clearAllData()" style="background: #f44336; margin-top: 10px;">ğŸ—‘ï¸ ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ØµØ§Ù Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h3>
            <div class="form-group">
                <label>Ù†Ø§Ù…:</label>
                <input type="text" id="customer-name" placeholder="Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù…">
            </div>
            <div class="form-group">
                <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø±:</label>
                <input type="tel" id="customer-phone" placeholder="03xxxxxxxxx">
            </div>
            <button class="btn" onclick="addCustomer()">Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Add/Edit Entry Modal -->
    <div id="add-entry-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="entry-modal-title">Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h3>
            <div class="form-group">
                <label>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="entry-from-date">
            </div>
            <div class="form-group">
                <label>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="entry-to-date">
            </div>
            <div class="form-group">
                <label>Ø±ÙˆØ²Ø§Ù†Û Ù„ÛŒÙ¹Ø±:</label>
                <input type="number" id="entry-liters" placeholder="Ø¬ÛŒØ³Û’ 2" step="0.1">
            </div>
            <div class="form-group">
                <label>ÙÛŒ Ù„ÛŒÙ¹Ø± Ø±ÛŒÙ¹:</label>
                <input type="number" id="entry-rate" placeholder="Ø¬ÛŒØ³Û’ 120" step="0.1">
            </div>
            <button class="btn" id="entry-submit-btn" onclick="addEntry()">Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ø±Ù‚Ù… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</h3>
            <div class="form-group">
                <label>Ø±Ù‚Ù…:</label>
                <input type="number" id="payment-amount" placeholder="Ø§Ø¯Ø§ Ø´Ø¯Û Ø±Ù‚Ù…">
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="payment-date">
            </div>
            <div class="form-group">
                <label>ØªØ¨ØµØ±Û:</label>
                <textarea id="payment-note" placeholder="Ú©ÙˆØ¦ÛŒ Ø®Ø§Øµ Ø¨Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>
            </div>
            <button class="btn" onclick="addPayment()">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Day Off Modal -->
    <div id="day-off-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</h3>
            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="day-off-date">
            </div>
            <div class="form-group">
                <label>ÙˆØ¬Û:</label>
                <textarea id="day-off-reason" placeholder="Ú†Ú¾Ù¹ÛŒ Ú©ÛŒ ÙˆØ¬Û"></textarea>
            </div>
            <button class="btn" onclick="addDayOff()">Ú†Ú¾Ù¹ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <script>
        // Global variables
        let customers = [];
        let currentCustomerId = null;
        let nextId = 1;
        let editingEntryId = null;
        let autoBackupInterval = null;
        let currentWorkingMonth = '';

        // GitHub credentials (auto-implemented)
        const GITHUB_TOKEN = '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';
        const GITHUB_REPO = 'abdul8659/milk-business-app';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Set current month as default working month
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('working-month').value = currentMonth;
            currentWorkingMonth = currentMonth;
            
            // Auto-setup GitHub credentials
            localStorage.setItem('github-token', GITHUB_TOKEN);
            localStorage.setItem('github-repo', GITHUB_REPO);
            localStorage.setItem('github-filename', 'milk-business-backup.json');
            
            // Auto-enable backup with 2-minute interval
            localStorage.setItem('auto-backup-enabled', 'true');
            localStorage.setItem('backup-interval', '120000');
            
            // Try to restore data from GitHub first
            await autoRestoreFromGitHub();
            
            // Load local data if GitHub restore fails
            loadFromStorage();
            
            showDashboard();
            updateDashboard();
            setupGitHubBackup();
            updateAutoBackupSettings();
        }

        async function autoRestoreFromGitHub() {
            try {
                updateBackupStatus('GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
                
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/milk-business-backup.json`, {
                    headers: {
                        'Authorization': `Bearer ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'MilkBusinessApp/1.0'
                    }
                });
                
                if (response.ok) {
                    const fileData = await response.json();
                    const content = decodeURIComponent(escape(atob(fileData.content)));
                    const data = JSON.parse(content);
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        customers = data.customers;
                        nextId = data.nextId || customers.length + 1;
                        
                        saveToStorage();
                        updateBackupStatus('GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ ÛÙˆ Ú¯ÛŒØ§', 'success');
                        return true;
                    }
                }
            } catch (error) {
                console.log('Auto restore failed, using local data');
            }
            
            updateBackupStatus('Ù„ÙˆÚ©Ù„ ÚˆÛŒÙ¹Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº', 'info');
            return false;
        }

        function updateWorkingMonth() {
            currentWorkingMonth = document.getElementById('working-month').value;
            localStorage.setItem('working-month', currentWorkingMonth);
            updateDashboard();
        }

        // =================== STORAGE AND BACKUP FUNCTIONS ===================
        function saveToStorage() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    lastBackup: new Date().toISOString(),
                    workingMonth: currentWorkingMonth,
                    version: '2.0'
                };
                
                localStorage.setItem('milkBusinessData', JSON.stringify(data));
                updateBackupStatus('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û', 'success');
                updateBackupStats();
                
            } catch (error) {
                console.error('Storage save error:', error);
                updateBackupStatus('Ø¨ÛŒÚ© Ø§Ù¾ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function loadFromStorage() {
            try {
                const data = localStorage.getItem('milkBusinessData');
                if (data) {
                    const parsed = JSON.parse(data);
                    customers = parsed.customers || [];
                    nextId = parsed.nextId || 1;
                    currentWorkingMonth = parsed.workingMonth || new Date().toISOString().slice(0, 7);
                }
            } catch (error) {
                console.error('Storage load error:', error);
                customers = [];
                nextId = 1;
                currentWorkingMonth = new Date().toISOString().slice(0, 7);
            }
        }

        function updateBackupStatus(message, type = 'info') {
            const statusElement = document.getElementById('backup-status');
            statusElement.className = `backup-status ${type}`;
            statusElement.innerHTML = `
                <span class="status-indicator status-${type === 'syncing' ? 'syncing' : type === 'error' ? 'offline' : 'online'}"></span>
                ${message}
            `;
        }

        function setupGitHubBackup() {
            updateGitHubStatus();
            updateBackupStats();
        }

        async function testGitHubConnection() {
            updateBackupStatus('Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    updateGitHubStatus();
                    showNotification('GitHub Ú©Ù†Ú©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('GitHub connection test failed:', error);
                showNotification('GitHub Ú©Ù†Ú©Ø´Ù† Ù†Ø§Ú©Ø§Ù…: ' + error.message, 'error');
            }
        }

        async function backupToGitHub() {
            updateBackupStatus('GitHub Ù…ÛŒÚº Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                const currentDate = new Date().toISOString().split('T')[0];
                const currentTime = new Date().toISOString().replace(/[:.]/g, '-');
                
                // Create main backup data with timestamp
                const mainData = {
                    customers: customers,
                    nextId: nextId,
                    lastSync: new Date().toISOString(),
                    workingMonth: currentWorkingMonth,
                    version: '2.0',
                    appName: 'Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±',
                    backupDate: currentDate,
                    backupTime: currentTime
                };
                
                // Upload main backup file
                await uploadToGitHub(GITHUB_TOKEN, GITHUB_REPO, 'milk-business-backup.json', mainData, `Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Ù…Ú©Ù…Ù„ Ø¨ÛŒÚ© Ø§Ù¾ ${currentDate} ${new Date().toLocaleTimeString('ur-PK')}`);
                
                // Upload timestamped backup
                const timestampedPath = `backups/business_backup_${currentTime}.json`;
                await uploadToGitHub(GITHUB_TOKEN, GITHUB_REPO, timestampedPath, mainData, `Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Ù¹Ø§Ø¦Ù… Ø³Ù¹ÛŒÙ…Ù¾ Ø¨ÛŒÚ© Ø§Ù¾ ${currentDate} ${new Date().toLocaleTimeString('ur-PK')}`);
                
                localStorage.setItem('last-github-sync', new Date().toISOString());
                updateGitHubStatus();
                updateBackupStatus('GitHub Ø¨ÛŒÚ© Ø§Ù¾: Ú©Ø§Ù…ÛŒØ§Ø¨', 'success');
                
            } catch (error) {
                console.error('GitHub backup failed:', error);
                updateBackupStatus('GitHub Ø¨ÛŒÚ© Ø§Ù¾: Ù†Ø§Ú©Ø§Ù…', 'error');
                showNotification('GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ù†Ø§Ú©Ø§Ù…: ' + error.message, 'error');
            }
        }

        async function uploadToGitHub(token, repo, filePath, data, commitMessage) {
            const jsonString = JSON.stringify(data, null, 2);
            const encoder = new TextEncoder();
            const utf8Array = encoder.encode(jsonString);
            const base64String = btoa(String.fromCharCode.apply(null, utf8Array));
            
            return await uploadBinaryToGitHub(token, repo, filePath, base64String, commitMessage);
        }

        async function uploadBinaryToGitHub(token, repo, filePath, base64Content, commitMessage) {
            const headers = {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };
            
            // Get existing file SHA if it exists
            let sha = null;
            try {
                const getResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                    headers: headers
                });
                
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
            } catch (e) {
                // File doesn't exist, will create new
            }
            
            const commitData = {
                message: commitMessage,
                content: base64Content
            };
            
            if (sha) {
                commitData.sha = sha;
            }
            
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                method: 'PUT',
                headers: headers,
                body: JSON.stringify(commitData)
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`GitHub API Error: ${response.status} - ${errorData.message || response.statusText}`);
            }
            
            return response.json();
        }

        async function restoreFromGitHub() {
            updateBackupStatus('GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/milk-business-backup.json`, {
                    headers: {
                        'Authorization': `Bearer ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'MilkBusinessApp/1.0'
                    }
                });
                
                if (response.status === 404) {
                    updateBackupStatus('GitHub Ø¨Ø­Ø§Ù„ÛŒ: ÙØ§Ø¦Ù„ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                    showNotification('GitHub Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                    return;
                }
                
                if (response.ok) {
                    const fileData = await response.json();
                    const content = decodeURIComponent(escape(atob(fileData.content)));
                    const data = JSON.parse(content);
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ú©Ùˆ GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ', () => {
                            customers = data.customers;
                            nextId = data.nextId || customers.length + 1;
                            currentWorkingMonth = data.workingMonth || new Date().toISOString().slice(0, 7);
                            
                            saveToStorage();
                            loadCustomers();
                            updateDashboard();
                            
                            updateBackupStatus('GitHub Ø¨Ø­Ø§Ù„ÛŒ: Ú©Ø§Ù…ÛŒØ§Ø¨', 'success');
                            showNotification('GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ø­Ø§Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                        });
                    } else {
                        updateBackupStatus('GitHub Ø¨Ø­Ø§Ù„ÛŒ: ØºÙ„Ø· ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                        showNotification('GitHub ÙØ§Ø¦Ù„ Ù…ÛŒÚº ØºÙ„Ø· ÚˆÛŒÙ¹Ø§ ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('GitHub restore failed:', error);
                updateBackupStatus('GitHub Ø¨Ø­Ø§Ù„ÛŒ: Ù†Ø§Ú©Ø§Ù…', 'error');
                showNotification('GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ Ù†Ø§Ú©Ø§Ù…: ' + error.message, 'error');
            }
        }

        function updateGitHubStatus() {
            const statusElement = document.getElementById('github-status');
            const syncTimeElement = document.getElementById('github-sync-time');
            const lastSync = localStorage.getItem('last-github-sync');
            
            if (statusElement) {
                statusElement.innerHTML = '<div>Ø­Ø§Ù„Øª: <span class="status-indicator status-online"></span>ÙØ¹Ø§Ù„</div>';
            }
            
            if (syncTimeElement) {
                syncTimeElement.textContent = lastSync ? 
                    new Date(lastSync).toLocaleString('ur-PK') : 'Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº';
            }
        }

        function updateAutoBackupSettings() {
            const enabled = document.getElementById('auto-backup-enabled')?.checked !== false;
            const interval = document.getElementById('backup-interval')?.value || '120000';
            
            localStorage.setItem('auto-backup-enabled', enabled);
            localStorage.setItem('backup-interval', interval);
            
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
                autoBackupInterval = null;
            }
            
            if (enabled) {
                autoBackupInterval = setInterval(() => {
                    saveToStorage();
                    setTimeout(() => backupToGitHub(), 1000);
                }, parseInt(interval));
                
                updateBackupStatus('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„ (ÛØ± ' + (parseInt(interval)/60000) + ' Ù…Ù†Ù¹)', 'success');
            } else {
                updateBackupStatus('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ØºÛŒØ± ÙØ¹Ø§Ù„', 'info');
            }
        }

        function updateBackupStats() {
            const lastBackup = localStorage.getItem('milkBusinessData') ? 
                new Date(JSON.parse(localStorage.getItem('milkBusinessData')).lastBackup || Date.now()).toLocaleString('ur-PK') : 
                'Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº';
            
            const dataSize = new Blob([localStorage.getItem('milkBusinessData') || '']).size;
            const sizeKB = (dataSize / 1024).toFixed(2);
            
            if (document.getElementById('local-backup-time')) {
                document.getElementById('local-backup-time').textContent = lastBackup;
            }
            if (document.getElementById('data-size')) {
                document.getElementById('data-size').textContent = sizeKB + ' KB';
            }
        }

        function exportData() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    workingMonth: currentWorkingMonth,
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `milk_business_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Export ÛÙˆ Ú¯ÛŒØ§!', 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Export Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ù†Ø¦Û’ ÚˆÛŒÙ¹Ø§ Ø³Û’ Ø¨Ø¯Ù„Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ', () => {
                            customers = data.customers;
                            nextId = data.nextId || customers.length + 1;
                            currentWorkingMonth = data.workingMonth || new Date().toISOString().slice(0, 7);
                            
                            saveToStorage();
                            loadCustomers();
                            updateDashboard();
                            
                            showNotification('ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Import ÛÙˆ Ú¯ÛŒØ§!', 'success');
                        });
                    } else {
                        showNotification('ØºÙ„Ø· ÙØ§Ø¦Ù„ ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                    }
                    
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification('ÙØ§Ø¦Ù„ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        // =================== PDF GENERATION FUNCTIONS WITH URDU SUPPORT ===================
        
        function createUrduPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set font to support Urdu (using embedded font data)
            try {
                // Using default font but with special handling for Urdu text
                doc.setFont("helvetica");
            } catch (e) {
                console.log("Font setting failed, using default");
            }
            
            return doc;
        }

        function addUrduText(doc, text, x, y, options = {}) {
            try {
                // Convert Urdu text to display properly
                const processedText = text.toString();
                doc.setFontSize(options.fontSize || 12);
                if (options.style) doc.setFont("helvetica", options.style);
                if (options.color) doc.setTextColor(options.color[0], options.color[1], options.color[2]);
                
                if (options.align) {
                    doc.text(processedText, x, y, { align: options.align });
                } else {
                    doc.text(processedText, x, y);
                }
            } catch (e) {
                console.error("Error adding Urdu text:", e);
                doc.text(text.toString(), x, y);
            }
        }

        function generateTimestamp() {
            const now = new Date();
            const date = now.toLocaleDateString('ur-PK');
            const time = now.toLocaleTimeString('ur-PK');
            return `${date} - ${time}`;
        }

        async function generateCustomerLedgerPDFWithDownload() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            const selectedMonth = document.getElementById('month-filter')?.value || 'all';
            const monthName = getMonthName(selectedMonth);
            
            try {
                const doc = createUrduPDF();
                const primaryColor = [102, 126, 234];
                const secondaryColor = [118, 75, 162];
                const successColor = [76, 175, 80];
                const errorColor = [244, 67, 54];
                const infoColor = [33, 150, 243];
                
                let yPosition = 20;
                
                // Header with customer name and timestamp
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(0, 0, 210, 50, 'F');
                
                addUrduText(doc, 'Ú¯Ø§ÛÚ© Ú©Ø§ Ù…Ú©Ù…Ù„ Ù„ÛŒØ¬Ø±', 105, 18, {
                    fontSize: 20, 
                    style: 'bold', 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, `${customer.name} - ${monthName}`, 105, 30, {
                    fontSize: 16, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, generateTimestamp(), 105, 42, {
                    fontSize: 10, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                yPosition = 60;
                
                // Customer Contact Information
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 25, 'F');
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 25, 'S');
                
                yPosition += 10;
                addUrduText(doc, 'Ø±Ø§Ø¨Ø·Û Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 15, yPosition, {
                    fontSize: 14, 
                    style: 'bold', 
                    color: [0, 0, 0]
                });
                
                yPosition += 8;
                addUrduText(doc, `Ù†Ø§Ù…: ${customer.name}`, 15, yPosition, {fontSize: 11});
                yPosition += 6;
                addUrduText(doc, `ÙÙˆÙ†: ${customer.phone || 'ÙØ±Ø§ÛÙ… Ù†ÛÛŒÚº Ú©ÛŒØ§ Ú¯ÛŒØ§'}`, 15, yPosition, {fontSize: 11});
                
                yPosition += 20;
                
                // Filter entries by selected month
                let filteredEntries = customer.entries || [];
                if (selectedMonth !== 'all') {
                    filteredEntries = customer.entries.filter(entry => {
                        const entryDate = entry.date || entry.fromDate;
                        const entryMonth = entry.month || (entryDate ? entryDate.substring(0, 7) : null);
                        return entryMonth === selectedMonth;
                    });
                }
                
                // Calculate totals
                let customerRevenue = 0;
                let customerPayments = 0;
                let totalLiters = 0;
                let totalDays = 0;
                
                filteredEntries.forEach(entry => {
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const liters = days * entry.liters;
                        const amount = liters * entry.rate;
                        customerRevenue += amount;
                        totalLiters += liters;
                        totalDays += days;
                    } else if (entry.type === 'payment') {
                        customerPayments += parseFloat(entry.amount);
                    }
                });
                
                const customerPending = customerRevenue - customerPayments;
                
                // Summary Section
                doc.setFillColor(infoColor[0], infoColor[1], infoColor[2]);
                doc.rect(10, yPosition, 190, 12, 'F');
                addUrduText(doc, 'Ø®Ù„Ø§ØµÛ', 15, yPosition + 8, {
                    fontSize: 14, 
                    style: 'bold', 
                    color: [255, 255, 255]
                });
                
                yPosition += 20;
                
                // Summary Cards
                const cardWidth = 47;
                const cardHeight = 35;
                const cardSpacing = 5;
                
                // Total Bill Card
                doc.setFillColor(successColor[0], successColor[1], successColor[2]);
                doc.rect(10, yPosition, cardWidth, cardHeight, 'F');
                addUrduText(doc, `${customerRevenue.toLocaleString()}`, 10 + cardWidth/2, yPosition + 15, {
                    fontSize: 14, 
                    style: 'bold', 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                addUrduText(doc, 'Ú©Ù„ Ø¨Ù„', 10 + cardWidth/2, yPosition + 22, {
                    fontSize: 9, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                // Add more summary cards...
                yPosition += cardHeight + 15;
                
                // Delivery Entries Section
                const deliveryEntries = filteredEntries.filter(entry => entry.type === 'delivery');
                
                if (deliveryEntries.length > 0) {
                    doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.rect(10, yPosition, 190, 12, 'F');
                    addUrduText(doc, 'Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition + 8, {
                        fontSize: 14, 
                        style: 'bold', 
                        color: [255, 255, 255]
                    });
                    
                    yPosition += 20;
                    
                    let entryNumber = 1;
                    deliveryEntries.forEach(entry => {
                        if (yPosition > 250) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const totalLitersEntry = days * entry.liters;
                        const amount = totalLitersEntry * entry.rate;
                        
                        // Entry background
                        doc.setFillColor(240, 248, 255);
                        doc.rect(10, yPosition, 190, 28, 'F');
                        doc.setDrawColor(infoColor[0], infoColor[1], infoColor[2]);
                        doc.setLineWidth(1);
                        doc.rect(10, yPosition, 190, 28, 'S');
                        
                        // Entry details in Urdu
                        addUrduText(doc, `${entryNumber}. ${formatDate(entry.fromDate)} Ø³Û’ ${formatDate(entry.toDate)}`, 15, yPosition + 8, {fontSize: 10});
                        addUrduText(doc, `${days} Ø¯Ù† Ã— ${entry.liters} Ù„ÛŒÙ¹Ø± = ${totalLitersEntry} Ú©Ù„ Ù„ÛŒÙ¹Ø±`, 15, yPosition + 15, {fontSize: 10});
                        addUrduText(doc, `Ù…ÛÛŒÙ†Û: ${getMonthName(entry.month)}`, 15, yPosition + 22, {fontSize: 10});
                        
                        // Amount
                        addUrduText(doc, `${totalLitersEntry} Ù„ÛŒÙ¹Ø± Ã— ${entry.rate} = ${amount} Ø±ÙˆÙ¾Û’`, 15, yPosition + 29, {
                            fontSize: 10, 
                            style: 'bold', 
                            color: successColor
                        });
                        
                        yPosition += 35;
                        entryNumber++;
                    });
                }
                
                // Payments Section
                const paymentEntries = filteredEntries.filter(entry => entry.type === 'payment');
                
                if (paymentEntries.length > 0) {
                    yPosition += 10;
                    
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFillColor(successColor[0], successColor[1], successColor[2]);
                    doc.rect(10, yPosition, 190, 12, 'F');
                    addUrduText(doc, 'Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition + 8, {
                        fontSize: 14, 
                        style: 'bold', 
                        color: [255, 255, 255]
                    });
                    
                    yPosition += 20;
                    
                    paymentEntries.forEach((payment, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        // Payment background
                        doc.setFillColor(240, 255, 240);
                        doc.rect(10, yPosition, 190, 22, 'F');
                        doc.setDrawColor(successColor[0], successColor[1], successColor[2]);
                        doc.setLineWidth(1);
                        doc.rect(10, yPosition, 190, 22, 'S');
                        
                        addUrduText(doc, `${index + 1}. ${formatDate(payment.date)}`, 15, yPosition + 8, {
                            fontSize: 10, 
                            style: 'bold'
                        });
                        
                        if (payment.month) {
                            addUrduText(doc, `Ù…ÛÛŒÙ†Û: ${getMonthName(payment.month)}`, 15, yPosition + 15, {fontSize: 10});
                        }
                        
                        addUrduText(doc, `${payment.amount} Ø±ÙˆÙ¾Û’`, 120, yPosition + 8, {
                            fontSize: 10, 
                            style: 'bold', 
                            color: successColor
                        });
                        
                        if (payment.note) {
                            addUrduText(doc, `Ù†ÙˆÙ¹: ${payment.note}`, 120, yPosition + 15, {
                                fontSize: 9, 
                                color: [100, 100, 100]
                            });
                        }
                        
                        yPosition += 27;
                    });
                }
                
                // Day-off entries
                const dayOffEntries = filteredEntries.filter(entry => entry.type === 'day-off');
                if (dayOffEntries.length > 0) {
                    yPosition += 10;
                    
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFillColor(errorColor[0], errorColor[1], errorColor[2]);
                    doc.rect(10, yPosition, 190, 12, 'F');
                    addUrduText(doc, 'Ú†Ú¾Ù¹ÛŒÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition + 8, {
                        fontSize: 14, 
                        style: 'bold', 
                        color: [255, 255, 255]
                    });
                    
                    yPosition += 20;
                    
                    dayOffEntries.forEach((dayOff, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        doc.setFillColor(255, 245, 245);
                        doc.rect(10, yPosition, 190, 18, 'F');
                        doc.setDrawColor(errorColor[0], errorColor[1], errorColor[2]);
                        doc.setLineWidth(1);
                        doc.rect(10, yPosition, 190, 18, 'S');
                        
                        addUrduText(doc, `${index + 1}. ${formatDate(dayOff.date)}`, 15, yPosition + 8, {
                            fontSize: 10, 
                            style: 'bold'
                        });
                        
                        if (dayOff.reason) {
                            addUrduText(doc, `ÙˆØ¬Û: ${dayOff.reason}`, 15, yPosition + 15, {fontSize: 10});
                        }
                        
                        if (dayOff.month) {
                            addUrduText(doc, `Ù…ÛÛŒÙ†Û: ${getMonthName(dayOff.month)}`, 120, yPosition + 8, {fontSize: 10});
                        }
                        
                        yPosition += 23;
                    });
                }
                
                // Final Summary
                yPosition += 15;
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                doc.rect(10, yPosition, 190, 40, 'F');
                addUrduText(doc, 'Ø­ØªÙ…ÛŒ Ø®Ù„Ø§ØµÛ', 15, yPosition + 12, {
                    fontSize: 16, 
                    style: 'bold', 
                    color: [255, 255, 255]
                });
                
                addUrduText(doc, `Ú©Ù„ Ø¯Ù†: ${totalDays} | Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${totalLiters.toFixed(1)}`, 15, yPosition + 22, {
                    fontSize: 12, 
                    color: [255, 255, 255]
                });
                addUrduText(doc, `Ú©Ù„ Ø¨Ù„: ${customerRevenue.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition + 30, {
                    fontSize: 12, 
                    color: [255, 255, 255]
                });
                addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…: ${customerPending.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition + 38, {
                    fontSize: 12, 
                    color: [255, 255, 255]
                });
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.rect(0, 285, 210, 12, 'F');
                    addUrduText(doc, `${customer.name} Ú©Ø§ Ù„ÛŒØ¬Ø± | ${generateTimestamp()} | ØµÙØ­Û ${i}/${pageCount}`, 105, 292, {
                        fontSize: 10, 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                }
                
                const fileName = `${customer.name}_Ù„ÛŒØ¬Ø±_${monthName.replace(/\s/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification(`${customer.name} Ú©Ø§ Ù„ÛŒØ¬Ø± PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!`, 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function generateComprehensivePDFWithDownload() {
            try {
                const doc = createUrduPDF();
                const primaryColor = [102, 126, 234];
                const secondaryColor = [118, 75, 162];
                const successColor = [76, 175, 80];
                const warningColor = [255, 152, 0];
                const errorColor = [244, 67, 54];
                
                let yPosition = 20;
                
                // Beautiful header with timestamp
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(0, 0, 210, 50, 'F');
                doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                doc.rect(0, 35, 210, 15, 'F');
                
                addUrduText(doc, 'Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹', 105, 20, {
                    fontSize: 24, 
                    style: 'bold', 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, 'Milk Business - Complete Report', 105, 30, {
                    fontSize: 14, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, generateTimestamp(), 105, 42, {
                    fontSize: 10, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                yPosition = 60;
                
                // Calculate business totals for working month
                let totalRevenue = 0;
                let totalPayments = 0;
                let totalLiters = 0;
                let totalDays = 0;
                
                customers.forEach(customer => {
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            const entryMonth = entry.month || (entry.date ? entry.date.substring(0, 7) : null);
                            if (entryMonth === currentWorkingMonth) {
                                if (entry.type === 'delivery') {
                                    const days = calculateDays(entry.fromDate, entry.toDate);
                                    const liters = days * entry.liters;
                                    totalRevenue += liters * entry.rate;
                                    totalLiters += liters;
                                    totalDays += days;
                                } else if (entry.type === 'payment') {
                                    totalPayments += parseFloat(entry.amount);
                                }
                            }
                        });
                    }
                });
                
                const pendingAmount = totalRevenue - totalPayments;
                
                // Business Summary Section
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 55, 'F');
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 55, 'S');
                
                yPosition += 12;
                
                addUrduText(doc, `Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ - ${getMonthName(currentWorkingMonth)}`, 15, yPosition, {
                    fontSize: 16, 
                    style: 'bold', 
                    color: primaryColor
                });
                
                yPosition += 15;
                
                // Summary in organized layout with Urdu text
                addUrduText(doc, `Ú©Ù„ Ú¯Ø§ÛÚ©: ${customers.length}`, 15, yPosition, {fontSize: 11});
                addUrduText(doc, `Ú©Ù„ Ø¯Ù†: ${totalDays}`, 110, yPosition, {fontSize: 11});
                yPosition += 8;
                
                addUrduText(doc, `Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${totalLiters.toFixed(1)}`, 15, yPosition, {fontSize: 11});
                addUrduText(doc, `Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ: ${totalRevenue.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 11, 
                    color: successColor
                });
                yPosition += 8;
                
                addUrduText(doc, `ÙˆØµÙˆÙ„ Ø´Ø¯Û: ${totalPayments.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition, {
                    fontSize: 11, 
                    color: primaryColor
                });
                addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…: ${pendingAmount.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 11, 
                    color: pendingAmount > 0 ? errorColor : successColor
                });
                
                yPosition += 25;
                
                // Customer Details Header
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(10, yPosition, 190, 12, 'F');
                addUrduText(doc, 'Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition + 8, {
                    fontSize: 14, 
                    style: 'bold', 
                    color: [255, 255, 255]
                });
                
                yPosition += 20;
                
                customers.forEach((customer, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Customer card with better design
                    doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.setLineWidth(1.5);
                    doc.rect(10, yPosition - 5, 190, 40, 'S');
                    
                    // Customer number badge
                    doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                    doc.rect(10, yPosition - 5, 25, 12, 'F');
                    addUrduText(doc, `${index + 1}`, 22.5, yPosition + 2, {
                        fontSize: 10, 
                        style: 'bold', 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                    
                    // Customer name and phone in Urdu
                    addUrduText(doc, `${customer.name}`, 40, yPosition + 2, {
                        fontSize: 14, 
                        style: 'bold'
                    });
                    
                    addUrduText(doc, `ÙÙˆÙ†: ${customer.phone || 'Ù†ÛÛŒÚº Ø¯ÛŒØ§ Ú¯ÛŒØ§'}`, 40, yPosition + 10, {fontSize: 10});
                    
                    // Calculate customer totals for working month
                    let customerRevenue = 0;
                    let customerPayments = 0;
                    let customerLiters = 0;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            const entryMonth = entry.month || (entry.date ? entry.date.substring(0, 7) : null);
                            if (entryMonth === currentWorkingMonth) {
                                if (entry.type === 'delivery') {
                                    const days = calculateDays(entry.fromDate, entry.toDate);
                                    const liters = days * entry.liters;
                                    customerRevenue += liters * entry.rate;
                                    customerLiters += liters;
                                } else if (entry.type === 'payment') {
                                    customerPayments += parseFloat(entry.amount);
                                }
                            }
                        });
                    }
                    
                    const customerPending = customerRevenue - customerPayments;
                    
                    yPosition += 18;
                    addUrduText(doc, `Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${customerLiters.toFixed(1)}`, 15, yPosition, {fontSize: 10});
                    addUrduText(doc, `Ú©Ù„ Ø¨Ù„: ${customerRevenue.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition + 7, {
                        fontSize: 10, 
                        color: successColor
                    });
                    
                    addUrduText(doc, `Ø§Ø¯Ø§ Ø´Ø¯Û: ${customerPayments.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                        fontSize: 10, 
                        color: primaryColor
                    });
                    addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ: ${customerPending.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition + 7, {
                        fontSize: 10, 
                        color: customerPending > 0 ? errorColor : successColor
                    });
                    
                    yPosition += 20;
                });
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.rect(0, 285, 210, 12, 'F');
                    addUrduText(doc, `Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ | ${generateTimestamp()} | ØµÙØ­Û ${i}/${pageCount}`, 105, 292, {
                        fontSize: 9, 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                }
                
                const fileName = `Ù…Ú©Ù…Ù„_Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ_Ø±Ù¾ÙˆØ±Ù¹_${getMonthName(currentWorkingMonth).replace(/\s/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification('Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function generateMonthlyPDFWithDownload() {
            try {
                const doc = createUrduPDF();
                const primaryColor = [102, 126, 234];
                const secondaryColor = [118, 75, 162];
                const successColor = [76, 175, 80];
                const warningColor = [255, 152, 0];
                const infoColor = [33, 150, 243];
                const errorColor = [244, 67, 54];
                
                const monthName = getMonthName(currentWorkingMonth);
                
                let yPosition = 20;
                
                // Beautiful header with timestamp
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(0, 0, 210, 45, 'F');
                doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                doc.rect(0, 30, 210, 15, 'F');
                
                addUrduText(doc, 'Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹', 105, 18, {
                    fontSize: 20, 
                    style: 'bold', 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, monthName, 105, 28, {
                    fontSize: 14, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, generateTimestamp(), 105, 38, {
                    fontSize: 10, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                yPosition = 55;
                
                // Calculate monthly data
                let monthlyRevenue = 0;
                let monthlyPayments = 0;
                let monthlyCustomers = 0;
                let monthlyLiters = 0;
                let monthlyDays = 0;
                let activeCustomersThisMonth = [];
                
                customers.forEach(customer => {
                    let hasMonthlyActivity = false;
                    let customerMonthlyRevenue = 0;
                    let customerMonthlyPayments = 0;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            const entryMonth = entry.month || (entry.date ? entry.date.substring(0, 7) : null);
                            if (entryMonth === currentWorkingMonth) {
                                hasMonthlyActivity = true;
                                if (entry.type === 'delivery') {
                                    const days = calculateDays(entry.fromDate, entry.toDate);
                                    const liters = days * entry.liters;
                                    const amount = liters * entry.rate;
                                    monthlyRevenue += amount;
                                    monthlyLiters += liters;
                                    monthlyDays += days;
                                    customerMonthlyRevenue += amount;
                                } else if (entry.type === 'payment') {
                                    monthlyPayments += parseFloat(entry.amount);
                                    customerMonthlyPayments += parseFloat(entry.amount);
                                }
                            }
                        });
                    }
                    
                    if (hasMonthlyActivity) {
                        monthlyCustomers++;
                        activeCustomersThisMonth.push({
                            name: customer.name,
                            phone: customer.phone,
                            revenue: customerMonthlyRevenue,
                            payments: customerMonthlyPayments,
                            pending: customerMonthlyRevenue - customerMonthlyPayments
                        });
                    }
                });
                
                const monthlyPending = monthlyRevenue - monthlyPayments;
                
                // Monthly Summary Cards
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 60, 'F');
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 60, 'S');
                
                yPosition += 12;
                addUrduText(doc, 'Ù…Ø§ÛØ§Ù†Û Ø®Ù„Ø§ØµÛ', 15, yPosition, {
                    fontSize: 16, 
                    style: 'bold', 
                    color: primaryColor
                });
                
                yPosition += 15;
                
                // Summary with Urdu text
                addUrduText(doc, `ÙØ¹Ø§Ù„ Ú¯Ø§ÛÚ©: ${monthlyCustomers}`, 15, yPosition, {fontSize: 11});
                addUrduText(doc, `Ú©Ù„ Ø¯Ù†: ${monthlyDays}`, 110, yPosition, {fontSize: 11});
                yPosition += 8;
                
                addUrduText(doc, `Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${monthlyLiters.toFixed(1)}`, 15, yPosition, {fontSize: 11});
                addUrduText(doc, `Ù…Ø§ÛØ§Ù†Û Ø¢Ù…Ø¯Ù†ÛŒ: ${monthlyRevenue.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 11, 
                    color: successColor
                });
                yPosition += 8;
                
                addUrduText(doc, `ÙˆØµÙˆÙ„ Ø´Ø¯Û: ${monthlyPayments.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition, {
                    fontSize: 11, 
                    color: infoColor
                });
                addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…: ${monthlyPending.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 11, 
                    color: monthlyPending > 0 ? errorColor : successColor
                });
                yPosition += 8;
                
                // Performance metrics
                const avgDailyRevenue = monthlyDays > 0 ? (monthlyRevenue / monthlyDays).toFixed(0) : 0;
                const collectionRate = monthlyRevenue > 0 ? ((monthlyPayments / monthlyRevenue) * 100).toFixed(1) : 0;
                
                addUrduText(doc, `Ø§ÙˆØ³Ø· Ø±ÙˆØ²Ø§Ù†Û: ${avgDailyRevenue} Ø±ÙˆÙ¾Û’`, 15, yPosition, {fontSize: 11});
                addUrduText(doc, `ÙˆØµÙˆÙ„ÛŒ ÙÛŒØµØ¯: ${collectionRate}%`, 110, yPosition, {fontSize: 11});
                
                yPosition += 25;
                
                // Active Customers This Month
                if (activeCustomersThisMonth.length > 0) {
                    doc.setFillColor(successColor[0], successColor[1], successColor[2]);
                    doc.rect(10, yPosition, 190, 12, 'F');
                    addUrduText(doc, 'Ø§Ø³ Ù…Ø§Û ÙØ¹Ø§Ù„ Ú¯Ø§ÛÚ©', 15, yPosition + 8, {
                        fontSize: 14, 
                        style: 'bold', 
                        color: [255, 255, 255]
                    });
                    
                    yPosition += 20;
                    
                    // Sort by revenue (highest first)
                    activeCustomersThisMonth.sort((a, b) => b.revenue - a.revenue);
                    
                    activeCustomersThisMonth.forEach((customer, index) => {
                        if (yPosition > 260) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        // Customer monthly card
                        const cardColor = index < 3 ? [255, 193, 7] : [240, 248, 255]; // Gold for top 3
                        doc.setFillColor(cardColor[0], cardColor[1], cardColor[2]);
                        doc.rect(10, yPosition, 190, 25, 'F');
                        doc.setDrawColor(index < 3 ? 255 : infoColor[0], index < 3 ? 193 : infoColor[1], index < 3 ? 7 : infoColor[2]);
                        doc.setLineWidth(1);
                        doc.rect(10, yPosition, 190, 25, 'S');
                        
                        // Rank badge
                        if (index < 3) {
                            const rankColors = [[255, 215, 0], [192, 192, 192], [205, 127, 50]]; // Gold, Silver, Bronze
                            doc.setFillColor(rankColors[index][0], rankColors[index][1], rankColors[index][2]);
                            doc.circle(20, yPosition + 8, 4, 'F');
                            addUrduText(doc, `${index + 1}`, 20, yPosition + 10, {
                                fontSize: 8, 
                                style: 'bold', 
                                color: [0, 0, 0], 
                                align: 'center'
                            });
                        } else {
                            doc.setFillColor(infoColor[0], infoColor[1], infoColor[2]);
                            doc.circle(20, yPosition + 8, 3, 'F');
                            addUrduText(doc, `${index + 1}`, 20, yPosition + 10, {
                                fontSize: 8, 
                                style: 'bold', 
                                color: [255, 255, 255], 
                                align: 'center'
                            });
                        }
                        
                        addUrduText(doc, `${customer.name}`, 30, yPosition + 8, {
                            fontSize: 11, 
                            style: 'bold'
                        });
                        
                        if (customer.phone) {
                            addUrduText(doc, `${customer.phone}`, 30, yPosition + 15, {fontSize: 9});
                        }
                        
                        // Financial details in Urdu
                        addUrduText(doc, `Ø¢Ù…Ø¯Ù†ÛŒ: ${customer.revenue.toLocaleString()}`, 120, yPosition + 6, {
                            fontSize: 10, 
                            style: 'bold', 
                            color: successColor
                        });
                        
                        addUrduText(doc, `Ø§Ø¯Ø§Ø¦ÛŒ: ${customer.payments.toLocaleString()}`, 120, yPosition + 13, {
                            fontSize: 10, 
                            color: infoColor
                        });
                        
                        addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ: ${customer.pending.toLocaleString()}`, 120, yPosition + 20, {
                            fontSize: 10, 
                            color: customer.pending > 0 ? errorColor : successColor
                        });
                        
                        yPosition += 30;
                    });
                }
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.rect(0, 285, 210, 12, 'F');
                    addUrduText(doc, `${monthName} Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹ | ${generateTimestamp()} | ØµÙØ­Û ${i}/${pageCount}`, 105, 292, {
                        fontSize: 9, 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                }
                
                const fileName = `Ù…Ø§ÛØ§Ù†Û_Ø±Ù¾ÙˆØ±Ù¹_${currentWorkingMonth}_${monthName.replace(/\s/g, '_')}.pdf`;
                doc.save(fileName);
                showNotification('Ù…Ø§ÛØ§Ù†Û PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('Monthly PDF generation error:', error);
                showNotification('Ù…Ø§ÛØ§Ù†Û PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function generateBusinessReportPDFWithDownload() {
            try {
                const doc = createUrduPDF();
                const primaryColor = [102, 126, 234];
                const secondaryColor = [118, 75, 162];
                const successColor = [76, 175, 80];
                const warningColor = [255, 152, 0];
                const errorColor = [244, 67, 54];
                const infoColor = [33, 150, 243];
                
                let yPosition = 20;
                
                // Header with timestamp
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(0, 0, 210, 50, 'F');
                doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                doc.rect(0, 35, 210, 15, 'F');
                
                addUrduText(doc, 'Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹', 105, 20, {
                    fontSize: 24, 
                    style: 'bold', 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, 'Complete Business Report', 105, 30, {
                    fontSize: 14, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                addUrduText(doc, generateTimestamp(), 105, 42, {
                    fontSize: 10, 
                    color: [255, 255, 255], 
                    align: 'center'
                });
                
                yPosition = 60;
                
                // Calculate overall business totals
                let totalRevenue = 0;
                let totalPayments = 0;
                let totalLiters = 0;
                let totalDays = 0;
                
                customers.forEach(customer => {
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                const liters = days * entry.liters;
                                totalRevenue += liters * entry.rate;
                                totalLiters += liters;
                                totalDays += days;
                            } else if (entry.type === 'payment') {
                                totalPayments += parseFloat(entry.amount);
                            }
                        });
                    }
                });
                
                const pendingAmount = totalRevenue - totalPayments;
                
                // Overall Business Summary
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 55, 'F');
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 55, 'S');
                
                yPosition += 12;
                
                addUrduText(doc, 'Ù…Ø¬Ù…ÙˆØ¹ÛŒ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ', 15, yPosition, {
                    fontSize: 18, 
                    style: 'bold', 
                    color: primaryColor
                });
                
                yPosition += 15;
                
                addUrduText(doc, `Ú©Ù„ Ú¯Ø§ÛÚ©: ${customers.length}`, 15, yPosition, {fontSize: 12});
                addUrduText(doc, `Ú©Ù„ Ø¯Ù†: ${totalDays}`, 110, yPosition, {fontSize: 12});
                yPosition += 8;
                
                addUrduText(doc, `Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${totalLiters.toFixed(1)}`, 15, yPosition, {fontSize: 12});
                addUrduText(doc, `Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ: ${totalRevenue.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 12, 
                    color: successColor
                });
                yPosition += 8;
                
                addUrduText(doc, `ÙˆØµÙˆÙ„ Ø´Ø¯Û: ${totalPayments.toLocaleString()} Ø±ÙˆÙ¾Û’`, 15, yPosition, {
                    fontSize: 12, 
                    color: primaryColor
                });
                addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…: ${pendingAmount.toLocaleString()} Ø±ÙˆÙ¾Û’`, 110, yPosition, {
                    fontSize: 12, 
                    color: pendingAmount > 0 ? errorColor : successColor
                });
                
                yPosition += 25;
                
                // Monthly Breakdown
                addUrduText(doc, 'Ù…Ø§Û ÙˆØ§Ø± ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition, {
                    fontSize: 16, 
                    style: 'bold', 
                    color: primaryColor
                });
                
                yPosition += 15;
                
                // Calculate monthly data for all months
                const monthlyData = {};
                const allMonths = ['2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06', 
                                  '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12',
                                  '2025-01', '2025-02', '2025-03', '2025-04', '2025-05', '2025-06',
                                  '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12'];
                
                allMonths.forEach(month => {
                    monthlyData[month] = { revenue: 0, payments: 0, customers: 0, liters: 0 };
                });
                
                customers.forEach(customer => {
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            const entryMonth = entry.month || (entry.date ? entry.date.substring(0, 7) : null);
                            if (entryMonth && monthlyData[entryMonth]) {
                                if (entry.type === 'delivery') {
                                    const days = calculateDays(entry.fromDate, entry.toDate);
                                    const liters = days * entry.liters;
                                    monthlyData[entryMonth].revenue += liters * entry.rate;
                                    monthlyData[entryMonth].liters += liters;
                                } else if (entry.type === 'payment') {
                                    monthlyData[entryMonth].payments += parseFloat(entry.amount);
                                }
                            }
                        });
                    }
                });
                
                // Display monthly data
                Object.keys(monthlyData).forEach(month => {
                    const data = monthlyData[month];
                    if (data.revenue > 0 || data.payments > 0) {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const monthName = getMonthName(month);
                        
                        doc.setFillColor(240, 248, 255);
                        doc.rect(10, yPosition, 190, 20, 'F');
                        doc.setDrawColor(infoColor[0], infoColor[1], infoColor[2]);
                        doc.setLineWidth(1);
                        doc.rect(10, yPosition, 190, 20, 'S');
                        
                        addUrduText(doc, monthName, 15, yPosition + 8, {
                            fontSize: 12, 
                            style: 'bold'
                        });
                        
                        addUrduText(doc, `Ø¢Ù…Ø¯Ù†ÛŒ: ${data.revenue.toLocaleString()}`, 15, yPosition + 15, {
                            fontSize: 10, 
                            color: successColor
                        });
                        
                        addUrduText(doc, `ÙˆØµÙˆÙ„ÛŒ: ${data.payments.toLocaleString()}`, 70, yPosition + 15, {
                            fontSize: 10, 
                            color: infoColor
                        });
                        
                        addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ: ${(data.revenue - data.payments).toLocaleString()}`, 125, yPosition + 15, {
                            fontSize: 10, 
                            color: (data.revenue - data.payments) > 0 ? errorColor : successColor
                        });
                        
                        addUrduText(doc, `Ù„ÛŒÙ¹Ø±: ${data.liters.toFixed(1)}`, 170, yPosition + 15, {fontSize: 10});
                        
                        yPosition += 25;
                    }
                });
                
                // Customer wise details
                yPosition += 10;
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.rect(10, yPosition, 190, 12, 'F');
                addUrduText(doc, 'ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª', 15, yPosition + 8, {
                    fontSize: 14, 
                    style: 'bold', 
                    color: [255, 255, 255]
                });
                
                yPosition += 20;
                
                customers.forEach((customer, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Calculate customer totals
                    let customerRevenue = 0;
                    let customerPayments = 0;
                    let customerLiters = 0;
                    let customerEntries = 0;
                    let customerDayOffs = 0;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                const liters = days * entry.liters;
                                customerRevenue += liters * entry.rate;
                                customerLiters += liters;
                                customerEntries++;
                            } else if (entry.type === 'payment') {
                                customerPayments += parseFloat(entry.amount);
                            } else if (entry.type === 'day-off') {
                                customerDayOffs++;
                            }
                        });
                    }
                    
                    const customerPending = customerRevenue - customerPayments;
                    
                    // Customer detailed card
                    doc.setFillColor(248, 249, 250);
                    doc.rect(10, yPosition, 190, 35, 'F');
                    doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.setLineWidth(1);
                    doc.rect(10, yPosition, 190, 35, 'S');
                    
                    // Customer number
                    doc.setFillColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                    doc.rect(10, yPosition, 20, 12, 'F');
                    addUrduText(doc, `${index + 1}`, 20, yPosition + 8, {
                        fontSize: 10, 
                        style: 'bold', 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                    
                    // Customer details
                    addUrduText(doc, `${customer.name}`, 35, yPosition + 8, {
                        fontSize: 12, 
                        style: 'bold'
                    });
                    
                    addUrduText(doc, `ÙÙˆÙ†: ${customer.phone || 'Ù†ÛÛŒÚº Ø¯ÛŒØ§ Ú¯ÛŒØ§'}`, 35, yPosition + 16, {fontSize: 9});
                    
                    addUrduText(doc, `Ø§Ù†Ù¹Ø±ÛŒØ²: ${customerEntries}`, 35, yPosition + 24, {fontSize: 9});
                    addUrduText(doc, `Ú†Ú¾Ù¹ÛŒØ§Úº: ${customerDayOffs}`, 75, yPosition + 24, {fontSize: 9});
                    
                    // Financial summary
                    addUrduText(doc, `Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${customerLiters.toFixed(1)}`, 120, yPosition + 8, {fontSize: 10});
                    addUrduText(doc, `Ú©Ù„ Ø¨Ù„: ${customerRevenue.toLocaleString()}`, 120, yPosition + 16, {
                        fontSize: 10, 
                        color: successColor
                    });
                    addUrduText(doc, `Ø§Ø¯Ø§ Ø´Ø¯Û: ${customerPayments.toLocaleString()}`, 120, yPosition + 24, {
                        fontSize: 10, 
                        color: infoColor
                    });
                    addUrduText(doc, `Ø¨Ø§Ù‚ÛŒ: ${customerPending.toLocaleString()}`, 120, yPosition + 32, {
                        fontSize: 10, 
                        color: customerPending > 0 ? errorColor : successColor
                    });
                    
                    yPosition += 40;
                });
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.rect(0, 285, 210, 12, 'F');
                    addUrduText(doc, `Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ | ${generateTimestamp()} | ØµÙØ­Û ${i}/${pageCount}`, 105, 292, {
                        fontSize: 9, 
                        color: [255, 255, 255], 
                        align: 'center'
                    });
                }
                
                const fileName = `Ù…Ú©Ù…Ù„_Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ_Ø±Ù¾ÙˆØ±Ù¹_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification('Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('Business PDF generation error:', error);
                showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        // =================== WHATSAPP SHARING ===================
        function shareOnWhatsApp() {
            const customer = customers.find(c => c.id === currentCustomerId);
            const selectedMonth = document.getElementById('month-filter').value;
            const monthName = getMonthName(selectedMonth);
            
            let message = `*${customer.name} Ú©Ø§ Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ø¨Ù„*\n${monthName}\n\n`;
            
            let filteredEntries = customer.entries || [];
            if (selectedMonth !== 'all') {
                filteredEntries = customer.entries.filter(entry => {
                    const entryDate = entry.date || entry.fromDate;
                    const entryMonth = entry.month || (entryDate ? entryDate.substring(0, 7) : null);
                    return entryMonth === selectedMonth;
                });
            }
            
            let totalLiters = 0;
            let totalAmount = 0;
            let entryNumber = 1;
            
            filteredEntries.sort((a, b) => new Date(a.date || a.fromDate) - new Date(b.date || b.fromDate));
            
            filteredEntries.forEach(entry => {
                if (entry.type === 'delivery') {
                    const days = calculateDays(entry.fromDate, entry.toDate);
                    const liters = days * entry.liters;
                    const amount = liters * entry.rate;
                    
                    const fromDateFormatted = formatDate(entry.fromDate);
                    const toDateFormatted = formatDate(entry.toDate);
                    
                    message += `${entryNumber}. ${fromDateFormatted} Ø³Û’ ${toDateFormatted}\n`;
                    message += `ğŸ“¦ ${days} Ø¯Ù† Ã— ${entry.liters} Ù„ÛŒÙ¹Ø± = *${liters} Ú©Ù„ Ù„ÛŒÙ¹Ø±*\n`;
                    message += `ğŸ’° ${liters} Ù„ÛŒÙ¹Ø± Ã— ${entry.rate} Ø±ÙˆÙ¾Û’ = *${amount} Ø±ÙˆÙ¾Û’*\n\n`;
                    
                    totalLiters += liters;
                    totalAmount += amount;
                    entryNumber++;
                }
            });
            
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            message += `ğŸ¥› *Ú©Ù„ Ù„ÛŒÙ¹Ø±:* ${totalLiters.toFixed(1)}\n`;
            message += `ğŸ’µ *Ú©Ù„ Ø±Ù‚Ù…:* ${totalAmount.toFixed(0)} Ø±ÙˆÙ¾Û’\n`;
            message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            message += `ğŸ“ ÙÙˆÙ†: ${customer.phone || 'Ù†ÛÛŒÚº Ø¯ÛŒØ§ Ú¯ÛŒØ§'}\n`;
            message += `\n*Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±*\nØ´Ú©Ø±ÛŒÛ! ğŸ™`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('WhatsApp Ù¾Ø± Ø´ÛŒØ¦Ø± Ú©Û’ Ù„ÛŒÛ’ ØªÛŒØ§Ø±!', 'success');
        }

        // =================== CUSTOMER MANAGEMENT ===================
        function loadCustomers() {
            displayCustomers(customers);
        }

        function displayCustomers(customerList) {
            const grid = document.getElementById('customers-grid');
            grid.innerHTML = '';

            customerList.forEach(customer => {
                const card = document.createElement('div');
                card.className = 'customer-card';
                card.onclick = () => showLedger(customer.id);
                
                const paymentStatus = getPaymentStatus(customer);
                const total = calculateCustomerTotal(customer.id);
                const totalPaid = customer.payments ? customer.payments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0) : 0;
                const remaining = total - totalPaid;
                
                card.innerHTML = `
                    <div class="payment-status ${paymentStatus.class}">${paymentStatus.text}</div>
                    <button class="customer-delete-btn" onclick="deleteCustomer(${customer.id}); event.stopPropagation();" title="Ú¯Ø§ÛÚ© Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                    <h3>${customer.name}</h3>
                    <p>ğŸ“ ${customer.phone || 'ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                    <p>ğŸ’° Ú©Ù„: ${total} Ø±ÙˆÙ¾Û’</p>
                    <p>ğŸ’³ Ø§Ø¯Ø§ Ø´Ø¯Û: ${totalPaid} Ø±ÙˆÙ¾Û’</p>
                    <p>ğŸ“‹ Ø¨Ø§Ù‚ÛŒ: ${remaining} Ø±ÙˆÙ¾Û’</p>
                `;
                
                grid.appendChild(card);
            });

            const addBtn = document.createElement('div');
            addBtn.className = 'customer-card add-customer-card';
            addBtn.innerHTML = 'â•';
            addBtn.onclick = showAddCustomerModal;
            grid.appendChild(addBtn);
        }

        function deleteCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // Triple confirmation as requested
            showTripleConfirm(customer, customerId);
        }

        function showTripleConfirm(customer, customerId) {
            // First confirmation
            const confirmDiv1 = document.createElement('div');
            confirmDiv1.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            confirmDiv1.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; direction: rtl; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">âš ï¸</div>
                    <h3 style="color: #f44336; margin-bottom: 15px;">Ù¾ÛÙ„ÛŒ ØªØµØ¯ÛŒÙ‚</h3>
                    <p style="margin-bottom: 20px; font-size: 16px;">Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ "${customer.name}" Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ</p>
                    <div>
                        <button id="confirm1-yes" style="background: #f44336; color: white; border: none; padding: 12px 20px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 14px;">ÛØ§ÚºØŒ Ø¢Ú¯Û’ Ø¨Ú‘Ú¾ÛŒÚº</button>
                        <button id="confirm1-no" style="background: #4CAF50; color: white; border: none; padding: 12px 20px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 14px;">Ù†ÛÛŒÚºØŒ Ù…Ù†Ø³ÙˆØ® Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv1);
            
            document.getElementById('confirm1-yes').onclick = function() {
                document.body.removeChild(confirmDiv1);
                showSecondConfirm(customer, customerId);
            };
            
            document.getElementById('confirm1-no').onclick = function() {
                document.body.removeChild(confirmDiv1);
            };
        }

        function showSecondConfirm(customer, customerId) {
            // Second confirmation
            const confirmDiv2 = document.createElement('div');
            confirmDiv2.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            confirmDiv2.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; direction: rtl; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 3px solid #ff9800;">
                    <div style="font-size: 48px; margin-bottom: 15px;">âš ï¸âš ï¸</div>
                    <h3 style="color: #ff9800; margin-bottom: 15px;">Ø¯ÙˆØ³Ø±ÛŒ ØªØµØ¯ÛŒÙ‚</h3>
                    <p style="margin-bottom: 20px; font-size: 16px; color: #f44336; font-weight: bold;">ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§!</p>
                    <p style="margin-bottom: 20px; font-size: 16px;">Ú©ÛŒØ§ Ø¢Ù¾ "${customer.name}" Ú©Ùˆ Ù…Ú©Ù…Ù„ Ø·ÙˆØ± Ù¾Ø± Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ</p>
                    <div>
                        <button id="confirm2-yes" style="background: #f44336; color: white; border: none; padding: 12px 20px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 14px;">ÛØ§ÚºØŒ Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                        <button id="confirm2-no" style="background: #4CAF50; color: white; border: none; padding: 12px 20px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 14px;">Ù†ÛÛŒÚºØŒ Ù…Ø­ÙÙˆØ¸ Ø±Ú©Ú¾ÛŒÚº</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv2);
            
            document.getElementById('confirm2-yes').onclick = function() {
                document.body.removeChild(confirmDiv2);
                showFinalConfirm(customer, customerId);
            };
            
            document.getElementById('confirm2-no').onclick = function() {
                document.body.removeChild(confirmDiv2);
            };
        }

        function showFinalConfirm(customer, customerId) {
            // Final confirmation
            const confirmDiv3 = document.createElement('div');
            confirmDiv3.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 10002;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            confirmDiv3.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; direction: rtl; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 3px solid #f44336;">
                    <div style="font-size: 48px; margin-bottom: 15px;">âš ï¸âš ï¸âš ï¸</div>
                    <h3 style="color: #f44336; margin-bottom: 15px;">Ø¢Ø®Ø±ÛŒ ØªØµØ¯ÛŒÙ‚</h3>
                    <p style="margin-bottom: 15px; font-size: 18px; color: #f44336; font-weight: bold;">"${customer.name}"</p>
                    <p style="margin-bottom: 20px; font-size: 16px; color: #333;">Ú©Ø§ ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ ÛÙ…ÛŒØ´Û Ú©Û’ Ù„ÛŒÛ’ Ø­Ø°Ù ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§!</p>
                    <div style="background: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="color: #d32f2f; font-size: 14px;">â€¢ ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ² Ø­Ø°Ù ÛÙˆÚº Ú¯ÛŒ</p>
                        <p style="color: #d32f2f; font-size: 14px;">â€¢ ØªÙ…Ø§Ù… Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº Ø­Ø°Ù ÛÙˆÚº Ú¯ÛŒ</p>
                        <p style="color: #d32f2f; font-size: 14px;">â€¢ ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§</p>
                    </div>
                    <div>
                        <button id="confirm3-yes" style="background: #d32f2f; color: white; border: none; padding: 15px 25px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 16px; font-weight: bold;">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                        <button id="confirm3-no" style="background: #4CAF50; color: white; border: none; padding: 15px 25px; border-radius: 5px; margin: 5px; cursor: pointer; font-size: 16px;">Ù…Ù†Ø³ÙˆØ®</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv3);
            
            document.getElementById('confirm3-yes').onclick = function() {
                document.body.removeChild(confirmDiv3);
                performCustomerDeletion(customer, customerId);
            };
            
            document.getElementById('confirm3-no').onclick = function() {
                document.body.removeChild(confirmDiv3);
            };
        }

        function performCustomerDeletion(customer, customerId) {
            // Remove customer and clean up all data
            customers = customers.filter(c => c.id !== customerId);
            
            // If currently viewing this customer's ledger, go back to customers view
            if (currentCustomerId === customerId) {
                currentCustomerId = null;
                showCustomers();
            }
            
            // Save and update all views
            saveToStorage();
            loadCustomers();
            updateDashboard();
            
            // Clear any cached data
            updateDataManagementStats();
            
            showNotification(`"${customer.name}" Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø­Ø°Ù ÛÙˆ Ú¯ÛŒØ§!`, 'success');
        }

        function getPaymentStatus(customer) {
            const totalBill = calculateCustomerTotal(customer.id);
            const totalPaid = customer.payments ? customer.payments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0) : 0;
            const pending = totalBill - totalPaid;
            
            if (pending <= 0) {
                return { class: 'paid', text: 'Ø§Ø¯Ø§ Ø´Ø¯Û' };
            } else if (totalPaid > 0) {
                return { class: 'partial', text: 'Ø¬Ø²ÙˆÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ' };
            } else {
                return { class: 'pending', text: 'Ø¨Ø§Ù‚ÛŒ' };
            }
        }

        function calculateCustomerTotal(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer || !customer.entries) return 0;
            
            let total = 0;
            customer.entries.forEach(entry => {
                if (entry.type === 'delivery') {
                    const days = calculateDays(entry.fromDate, entry.toDate);
                    const totalLiters = days * entry.liters;
                    total += totalLiters * entry.rate;
                }
            });
            
            return total;
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                (customer.phone && customer.phone.includes(searchTerm))
            );
            displayCustomers(filteredCustomers);
        }

        function showAddCustomerModal() {
            document.getElementById('add-customer-modal').style.display = 'block';
        }

        function addCustomer() {
            const name = document.getElementById('customer-name').value.trim();
            const phone = document.getElementById('customer-phone').value.trim();
            
            if (!name) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = {
                id: nextId++,
                name: name,
                phone: phone,
                entries: [],
                payments: []
            };
            
            customers.push(customer);
            saveToStorage();
            
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            
            closeModal();
            loadCustomers();
            updateDashboard();
            
            showNotification('Ú¯Ø§ÛÚ© Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
        }

        // =================== ENTRY MANAGEMENT WITH EDIT/DELETE ===================
        function showLedger(customerId) {
            currentCustomerId = customerId;
            const customer = customers.find(c => c.id === customerId);
            
            document.getElementById('ledger-title').textContent = `${customer.name} Ú©Ø§ Ú©Ú¾Ø§ØªÛ`;
            showSection('ledger-section');
            loadLedgerEntries(customerId);
        }

        function loadLedgerEntries(customerId) {
            const customer = customers.find(c => c.id === customerId);
            const container = document.getElementById('ledger-entries');
            const selectedMonth = document.getElementById('month-filter')?.value || 'all';
            
            container.innerHTML = '';

            if (!customer.entries || customer.entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</div>';
                updateBillSummary([]);
                return;
            }

            let filteredEntries = customer.entries;
            if (selectedMonth !== 'all') {
                filteredEntries = customer.entries.filter(entry => {
                    const entryDate = entry.date || entry.fromDate;
                    const entryMonth = entry.month || (entryDate ? entryDate.substring(0, 7) : null);
                    return entryMonth === selectedMonth;
                });
            }

            if (filteredEntries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</div>';
                updateBillSummary([]);
                return;
            }

            filteredEntries.sort((a, b) => new Date(b.date || b.fromDate) - new Date(a.date || a.fromDate));

            filteredEntries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = `entry-item ${entry.type}`;
                
                if (entry.type === 'delivery') {
                    const days = calculateDays(entry.fromDate, entry.toDate);
                    const totalLiters = days * entry.liters;
                    const total = totalLiters * entry.rate;
                    
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn edit-btn" onclick="editEntry(${entry.id})" title="ØªØ±Ù…ÛŒÙ… Ú©Ø±ÛŒÚº">âœï¸</button>
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ</strong>
                                <div style="background: #667eea; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    ${total} Ø±ÙˆÙ¾Û’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.fromDate)} Ø³Û’ ${formatDate(entry.toDate)} ØªÚ© (${days} Ø¯Ù†)<br>
                            ğŸ¥› Ø±ÙˆØ²Ø§Ù†Û ${entry.liters} Ù„ÛŒÙ¹Ø± Ã— ${days} Ø¯Ù† = <strong>${totalLiters} Ú©Ù„ Ù„ÛŒÙ¹Ø±</strong><br>
                            ğŸ’° ${totalLiters} Ù„ÛŒÙ¹Ø± Ã— ${entry.rate} Ø±ÙˆÙ¾Û’ = <strong>${total} Ø±ÙˆÙ¾Û’</strong><br>
                            ğŸ“† Ù…ÛÛŒÙ†Û: <span style="background: #e3f2fd; padding: 2px 8px; border-radius: 10px;">${getMonthName(entry.month)}</span>
                        </div>
                    `;
                } else if (entry.type === 'day-off') {
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</strong>
                                <div style="background: #ff416c; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    Ø¢Ù ÚˆÛ’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.date)}<br>
                            ğŸ“ ${entry.reason || 'Ú©ÙˆØ¦ÛŒ ÙˆØ¬Û Ù†ÛÛŒÚº Ø¯ÛŒ Ú¯Ø¦ÛŒ'}<br>
                            ğŸ“† Ù…ÛÛŒÙ†Û: <span style="background: #ffebee; padding: 2px 8px; border-radius: 10px;">${getMonthName(entry.month)}</span>
                        </div>
                    `;
                } else if (entry.type === 'payment') {
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</strong>
                                <div style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    ${entry.amount} Ø±ÙˆÙ¾Û’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.date)}<br>
                            ğŸ’° ${entry.amount} Ø±ÙˆÙ¾Û’<br>
                            ğŸ“† Ù…ÛÛŒÙ†Û: <span style="background: #e8f5e8; padding: 2px 8px; border-radius: 10px;">${getMonthName(entry.month)}</span>
                            ${entry.note ? `<br>ğŸ“ ${entry.note}` : ''}
                        </div>
                    `;
                }
                
                container.appendChild(entryDiv);
            });

            updateBillSummary(filteredEntries);
        }

        function showAddEntryModal() {
            editingEntryId = null;
            document.getElementById('entry-modal-title').textContent = 'Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            document.getElementById('entry-submit-btn').textContent = 'Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            
            // Clear form
            document.getElementById('entry-from-date').value = '';
            document.getElementById('entry-to-date').value = '';
            document.getElementById('entry-liters').value = '';
            document.getElementById('entry-rate').value = '';
            
            document.getElementById('add-entry-modal').style.display = 'block';
        }

        function editEntry(entryId) {
            const customer = customers.find(c => c.id === currentCustomerId);
            const entry = customer.entries.find(e => e.id === entryId);
            
            if (!entry || entry.type !== 'delivery') {
                showNotification('ØµØ±Ù Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÛŒÚº ØªØ±Ù…ÛŒÙ… ÛÙˆ Ø³Ú©ØªÛŒ ÛÛ’', 'error');
                return;
            }
            
            editingEntryId = entryId;
            document.getElementById('entry-modal-title').textContent = 'Ø§Ù†Ù¹Ø±ÛŒ Ù…ÛŒÚº ØªØ±Ù…ÛŒÙ… Ú©Ø±ÛŒÚº';
            document.getElementById('entry-submit-btn').textContent = 'Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            
            // Fill form with existing data
            document.getElementById('entry-from-date').value = entry.fromDate;
            document.getElementById('entry-to-date').value = entry.toDate;
            document.getElementById('entry-liters').value = entry.liters;
            document.getElementById('entry-rate').value = entry.rate;
            
            document.getElementById('add-entry-modal').style.display = 'block';
        }

        function deleteEntry(entryId) {
            showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÛ Ø§Ù†Ù¹Ø±ÛŒ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ', () => {
                const customer = customers.find(c => c.id === currentCustomerId);
                const entryToDelete = customer.entries.find(e => e.id === entryId);
                
                // Remove from entries
                customer.entries = customer.entries.filter(e => e.id !== entryId);
                
                // If it was a payment, also remove from payments array
                if (entryToDelete && entryToDelete.type === 'payment') {
                    customer.payments = customer.payments.filter(p => p.id !== entryId);
                }
                
                saveToStorage();
                loadLedgerEntries(currentCustomerId);
                loadCustomers(); // Update customer cards to reflect new totals
                updateDashboard();
                
                showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø­Ø°Ù ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
            });
        }

        function addEntry() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const fromDate = document.getElementById('entry-from-date').value;
            const toDate = document.getElementById('entry-to-date').value;
            const liters = parseFloat(document.getElementById('entry-liters').value);
            const rate = parseFloat(document.getElementById('entry-rate').value);
            
            if (!fromDate || !toDate || !liters || !rate) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ø¨Ú¾Ø±ÛŒÚº', 'error');
                return;
            }
            
            if (new Date(fromDate) > new Date(toDate)) {
                showNotification('Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø³Û’ Ù¾ÛÙ„Û’ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.entries) {
                customer.entries = [];
            }
            
            // Determine month from date
            const entryMonth = currentWorkingMonth;
            
            if (editingEntryId) {
                // Update existing entry
                const entryIndex = customer.entries.findIndex(e => e.id === editingEntryId);
                if (entryIndex > -1) {
                    customer.entries[entryIndex] = {
                        ...customer.entries[entryIndex],
                        month: entryMonth,
                        fromDate: fromDate,
                        toDate: toDate,
                        liters: liters,
                        rate: rate,
                        updatedAt: new Date().toISOString()
                    };
                    showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
                }
            } else {
                // Add new entry
                const entry = {
                    id: Date.now(),
                    type: 'delivery',
                    month: entryMonth,
                    fromDate: fromDate,
                    toDate: toDate,
                    liters: liters,
                    rate: rate,
                    date: fromDate,
                    createdAt: new Date().toISOString()
                };
                
                customer.entries.push(entry);
                showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
            }
            
            saveToStorage();
            
            // Clear form
            document.getElementById('entry-from-date').value = '';
            document.getElementById('entry-to-date').value = '';
            document.getElementById('entry-liters').value = '';
            document.getElementById('entry-rate').value = '';
            
            closeModal();
            loadLedgerEntries(currentCustomerId);
            loadCustomers(); // Update customer cards
            updateDashboard();
        }

        function showPaymentModal() {
            const modal = document.getElementById('payment-modal');
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('payment-date').value = today;
            
            modal.classList.add('show');
            modal.style.display = 'flex';
        }

        function addPayment() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const date = document.getElementById('payment-date').value;
            const note = document.getElementById('payment-note').value.trim();
            
            if (!amount || !date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù‚Ù… Ø§ÙˆØ± ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.payments) {
                customer.payments = [];
            }
            if (!customer.entries) {
                customer.entries = [];
            }
            
            const payment = {
                id: Date.now(),
                type: 'payment',
                month: currentWorkingMonth,
                amount: amount,
                date: date,
                note: note,
                createdAt: new Date().toISOString()
            };
            
            customer.payments.push(payment);
            customer.entries.push(payment);
            
            saveToStorage();
            
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-note').value = '';
            
            closeModal();
            loadLedgerEntries(currentCustomerId);
            loadCustomers(); // Update customer cards
            updateDashboard();
            
            showNotification('Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
        }

        function showDayOffModal() {
            const modal = document.getElementById('day-off-modal');
            if (modal) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('day-off-date').value = today;
                modal.classList.add('show');
                modal.style.display = 'flex';
            }
        }

        function addDayOff() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const date = document.getElementById('day-off-date').value;
            const reason = document.getElementById('day-off-reason').value.trim();
            
            if (!date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.entries) {
                customer.entries = [];
            }
            
            const dayOff = {
                id: Date.now(),
                type: 'day-off',
                month: currentWorkingMonth,
                date: date,
                reason: reason,
                createdAt: new Date().toISOString()
            };
            
            customer.entries.push(dayOff);
            saveToStorage();
            
            document.getElementById('day-off-date').value = '';
            document.getElementById('day-off-reason').value = '';
            
            closeModal();
            loadLedgerEntries(currentCustomerId);
            updateDashboard();
            
            showNotification('Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
        }

        // =================== REPORTING FUNCTIONS ===================
        function setupReportFilters() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('report-start-date').value = firstDay.toISOString().split('T')[0];
            document.getElementById('report-end-date').value = today.toISOString().split('T')[0];
        }

        function generateReport() {
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const reportType = document.getElementById('report-type').value;
            
            if (!startDate || !endDate) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ú©ÛŒ Ø­Ø¯ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            generateBasicReport(startDate, endDate, reportType);
        }

        function generateBasicReport(startDate, endDate, reportType) {
            let totalRevenue = 0;
            let totalPayments = 0;
            let totalCustomers = customers.length;
            
            customers.forEach(customer => {
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        const entryDate = entry.date || entry.fromDate;
                        if (entryDate && entryDate >= startDate && entryDate <= endDate) {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                totalRevenue += days * entry.liters * entry.rate;
                            } else if (entry.type === 'payment') {
                                totalPayments += parseFloat(entry.amount);
                            }
                        }
                    });
                }
            });
            
            document.getElementById('total-revenue').textContent = `${totalRevenue} Ø±ÙˆÙ¾Û’`;
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('total-received').textContent = `${totalPayments} Ø±ÙˆÙ¾Û’`;
            
            // Calculate monthly revenue for working month
            let monthlyRevenue = 0;
            
            customers.forEach(customer => {
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        if (entry.type === 'delivery') {
                            const entryDate = entry.date || entry.fromDate;
                            const entryMonth = entry.month || (entryDate ? entryDate.substring(0, 7) : null);
                            if (entryMonth === currentWorkingMonth) {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                monthlyRevenue += days * entry.liters * entry.rate;
                            }
                        }
                    });
                }
            });
            
            document.getElementById('monthly-revenue').textContent = `${monthlyRevenue} Ø±ÙˆÙ¾Û’`;
            
            showNotification('Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
        }

        // =================== UTILITY FUNCTIONS ===================
        function calculateDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ur-PK');
        }

        function getMonthName(monthValue) {
            const months = {
                'all': 'ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’',
                '2024-01': 'Ø¬Ù†ÙˆØ±ÛŒ 2024',
                '2024-02': 'ÙØ±ÙˆØ±ÛŒ 2024',
                '2024-03': 'Ù…Ø§Ø±Ú† 2024',
                '2024-04': 'Ø§Ù¾Ø±ÛŒÙ„ 2024',
                '2024-05': 'Ù…Ø¦ÛŒ 2024',
                '2024-06': 'Ø¬ÙˆÙ† 2024',
                '2024-07': 'Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2024',
                '2024-08': 'Ø§Ú¯Ø³Øª 2024',
                '2024-09': 'Ø³ØªÙ…Ø¨Ø± 2024',
                '2024-10': 'Ø§Ú©ØªÙˆØ¨Ø± 2024',
                '2024-11': 'Ù†ÙˆÙ…Ø¨Ø± 2024',
                '2024-12': 'Ø¯Ø³Ù…Ø¨Ø± 2024',
                '2025-01': 'Ø¬Ù†ÙˆØ±ÛŒ 2025',
                '2025-02': 'ÙØ±ÙˆØ±ÛŒ 2025',
                '2025-03': 'Ù…Ø§Ø±Ú† 2025',
                '2025-04': 'Ø§Ù¾Ø±ÛŒÙ„ 2025',
                '2025-05': 'Ù…Ø¦ÛŒ 2025',
                '2025-06': 'Ø¬ÙˆÙ† 2025',
                '2025-07': 'Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025',
                '2025-08': 'Ø§Ú¯Ø³Øª 2025',
                '2025-09': 'Ø³ØªÙ…Ø¨Ø± 2025',
                '2025-10': 'Ø§Ú©ØªÙˆØ¨Ø± 2025',
                '2025-11': 'Ù†ÙˆÙ…Ø¨Ø± 2025',
                '2025-12': 'Ø¯Ø³Ù…Ø¨Ø± 2025'
            };
            return months[monthValue] || monthValue;
        }

        function updateBillSummary(entries) {
            let totalLiters = 0;
            let totalDays = 0;
            let totalAmount = 0;

            if (entries && entries.length > 0) {
                entries.forEach(entry => {
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const liters = days * parseFloat(entry.liters || 0);
                        const amount = liters * parseFloat(entry.rate || 0);
                        
                        totalLiters += liters;
                        totalDays += days;
                        totalAmount += amount;
                    }
                });
            }

            // Calculate payments for current customer
            const customer = customers.find(c => c.id === currentCustomerId);
            const totalPaid = customer && customer.payments ? customer.payments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0) : 0;
            const remainingAmount = totalAmount - totalPaid;

            document.getElementById('bill-summary').innerHTML = `
                <h3>ğŸ“‹ Ø¨Ù„ Ú©Ø§ Ø®Ù„Ø§ØµÛ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">${totalDays}</div>
                        <div>Ú©Ù„ Ø¯Ù†</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #2196F3; font-weight: bold;">${totalLiters}</div>
                        <div>Ú©Ù„ Ù„ÛŒÙ¹Ø±</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #ff9800; font-weight: bold;">${totalAmount} Ø±ÙˆÙ¾Û’</div>
                        <div>Ú©Ù„ Ø±Ù‚Ù…</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">${totalPaid} Ø±ÙˆÙ¾Û’</div>
                        <div>Ø§Ø¯Ø§ Ø´Ø¯Û</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #f44336; font-weight: bold;">${remainingAmount} Ø±ÙˆÙ¾Û’</div>
                        <div>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…</div>
                    </div>
                </div>
            `;
        }

        function updateDashboard() {
            // Calculate totals for working month
            let totalRevenue = 0;
            let totalPayments = 0;
            let totalCustomers = customers.length;
            
            customers.forEach(customer => {
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        const entryMonth = entry.month || (entry.date ? entry.date.substring(0, 7) : null);
                        if (entryMonth === currentWorkingMonth) {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                const totalLiters = days * entry.liters;
                                totalRevenue += totalLiters * entry.rate;
                            } else if (entry.type === 'payment') {
                                totalPayments += parseFloat(entry.amount);
                            }
                        }
                    });
                }
            });
            
            const pendingAmount = totalRevenue - totalPayments;
            
            // Update dashboard stats
            if (document.getElementById('total-customers-stat')) {
                document.getElementById('total-customers-stat').textContent = totalCustomers;
                document.getElementById('total-revenue-stat').textContent = `${totalRevenue} Ø±ÙˆÙ¾Û’`;
                document.getElementById('total-payments-stat').textContent = `${totalPayments} Ø±ÙˆÙ¾Û’`;
                document.getElementById('pending-amount-stat').textContent = `${pendingAmount} Ø±ÙˆÙ¾Û’`;
            }
            
            // Update reports section
            if (document.getElementById('total-revenue')) {
                document.getElementById('total-revenue').textContent = `${totalRevenue} Ø±ÙˆÙ¾Û’`;
                document.getElementById('total-customers').textContent = totalCustomers;
                document.getElementById('monthly-revenue').textContent = `${totalRevenue} Ø±ÙˆÙ¾Û’`;
                document.getElementById('total-received').textContent = `${totalPayments} Ø±ÙˆÙ¾Û’`;
            }
            
            // Update working month selector
            if (document.getElementById('working-month')) {
                document.getElementById('working-month').value = currentWorkingMonth;
            }
        }

        function updateDataManagementStats() {
            let totalEntries = 0;
            let totalPayments = 0;
            
            customers.forEach(customer => {
                if (customer.entries) totalEntries += customer.entries.length;
                if (customer.payments) totalPayments += customer.payments.length;
            });
            
            const dataSize = new Blob([localStorage.getItem('milkBusinessData') || '']).size;
            const sizeKB = (dataSize / 1024).toFixed(2);
            
            if (document.getElementById('stats-customers')) {
                document.getElementById('stats-customers').textContent = customers.length;
                document.getElementById('stats-entries').textContent = totalEntries;
                document.getElementById('stats-payments').textContent = totalPayments;
                document.getElementById('stats-size').textContent = sizeKB + ' KB';
            }
        }

        function clearAllData() {
            showConfirm('âš ï¸ ÛŒÛ Ø¹Ù…Ù„ ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ø­Ø°Ù Ú©Ø± Ø¯Û’ Ú¯Ø§! Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§Ø±ÛŒ Ø±Ú©Ú¾Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ', () => {
                customers = [];
                nextId = 1;
                currentCustomerId = null;
                
                localStorage.removeItem('milkBusinessData');
                
                loadCustomers();
                updateDashboard();
                showDashboard();
                
                showNotification('ØªÙ…Ø§Ù… ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ØµØ§Ù ÛÙˆ Ú¯ÛŒØ§!', 'success');
            });
        }

        // =================== NAVIGATION ===================
        function showDashboard() {
            setActiveNav(0);
            showSection('dashboard-section');
            updateDashboard();
        }

        function showCustomers() {
            setActiveNav(1);
            showSection('customers-section');
            loadCustomers();
        }

        function showReports() {
            setActiveNav(2);
            showSection('reports-section');
            setupReportFilters();
            updateDashboard();
        }

        function showBackupManagement() {
            setActiveNav(3);
            showSection('backup-management-section');
            updateGitHubStatus();
            updateBackupStats();
        }

        function showDataManagement() {
            setActiveNav(4);
            showSection('data-management-section');
            updateDataManagementStats();
        }

        function setActiveNav(index) {
            document.querySelectorAll('.nav-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function showSection(sectionId) {
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
                modal.classList.remove('show');
            });
            editingEntryId = null;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                font-size: 14px;
                direction: rtl;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function showConfirm(message, callback) {
            // Simple confirmation for non-customer deletion actions
            const confirmDiv = document.createElement('div');
            confirmDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            confirmDiv.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; direction: rtl; text-align: center;">
                    <p style="margin-bottom: 20px; font-size: 16px;">${message}</p>
                    <div>
                        <button id="simple-confirm-yes" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin: 5px; cursor: pointer;">ÛØ§Úº</button>
                        <button id="simple-confirm-no" style="background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin: 5px; cursor: pointer;">Ù†ÛÛŒÚº</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
            
            document.getElementById('simple-confirm-yes').onclick = function() {
                document.body.removeChild(confirmDiv);
                callback();
            };
            
            document.getElementById('simple-confirm-no').onclick = function() {
                document.body.removeChild(confirmDiv);
            };
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        // Initialize auto backup on page load
        window.onload = function() {
            // Auto-enable backup settings
            if (document.getElementById('auto-backup-enabled')) {
                document.getElementById('auto-backup-enabled').checked = true;
                document.getElementById('backup-interval').value = '120000';
            }
            
            updateAutoBackupSettings();
        }
    </script>
</body>
</html>
