<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Enhanced Milk Business App</title>
    
    <!-- Enhanced Urdu Fonts from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&family=Amiri:wght@400;700&family=Scheherazade:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Nastaliq Urdu', 'Amiri', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: auto; /* Added scroll for horizontal layout */
        }

        .container {
            max-width: 1400px; /* Increased max width */
            margin: 0 auto;
            padding: 10px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-top: 20px;
            margin-bottom: 20px;
            overflow-x: auto; /* Added horizontal scroll */
        }

        .backup-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .backup-status.error {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .backup-status.syncing {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="3" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* Month Selection Dashboard */
        .month-dashboard {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3);
        }

        .month-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .month-selector select {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            background: rgba(255,255,255,0.9);
            color: #333;
            min-width: 200px;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
        }

        .month-selector select:hover {
            background: white;
            transform: translateY(-2px);
        }

        .current-month-display {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Enhanced Navigation */
        .main-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 120px;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        }

        /* PDF Download Buttons */
        .pdf-download-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .pdf-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .pdf-download-btn::before {
            content: "ğŸ“„";
            font-size: 14px;
        }

        /* Enhanced Customers Grid */
        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .customer-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .customer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .customer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .customer-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .customer-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .customer-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #f39c12 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
            overflow-y: auto; /* Added scroll for modal */
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #333;
            background: #f0f0f0;
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
            padding-top: 20px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        /* Ledger Styles */
        .ledger-entries {
            max-height: 500px; /* Increased height */
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            background: #f8f9fa;
        }

        .entry-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .entry-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .entry-item.day-off {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fff5f5 0%, #fef1f1 100%);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .entry-type {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .entry-type.day-off {
            background: #e74c3c;
        }

        .entry-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            text-align: center;
            padding: 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
        }

        .detail-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .detail-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 2px;
        }

        /* Stats Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .stat-card:hover::before {
            top: -10%;
            right: -10%;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stat-card p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* GitHub Settings */
        .github-setup {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .github-form {
            display: grid;
            gap: 15px;
        }

        .github-input {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
        }

        .github-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
            transition: all 0.3s ease;
        }

        .github-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        /* Auto Backup Settings */
        .backup-settings {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .backup-interval {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .backup-interval select {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
        }

        .backup-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .backup-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Hidden Elements */
        .hidden {
            display: none !important;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 70px;
            right: 20px;
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(300px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 5px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .customers-grid {
                grid-template-columns: 1fr;
            }
            
            .main-nav {
                gap: 5px;
            }
            
            .nav-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 12px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .month-selector {
                flex-direction: column;
            }

            .customer-stats {
                grid-template-columns: 1fr;
            }

            .customer-actions {
                flex-direction: column;
            }

            .action-btn {
                min-width: 100%;
            }
        }

        /* Print Styles */
        @media print {
            .backup-status,
            .main-nav,
            .pdf-download-btn,
            .action-btn {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Status Bar -->
    <div class="backup-status" id="backup-status">
        <span class="status-indicator"></span>
        Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„ (2 Ù…Ù†Ù¹)
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
            <p>Enhanced Complete Business Solution with Auto GitHub Backup</p>
        </div>

        <!-- Month Selection Dashboard -->
        <div class="month-dashboard">
            <div class="current-month-display" id="current-month-display">
                Ù…ÙˆØ¬ÙˆØ¯Û Ù…Ø§Û: <span id="selected-month-name">Loading...</span>
            </div>
            <p>Ù…Ø§Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº Ø¬Ø³ Ú©Û’ Ø³Ø§ØªÚ¾ Ø¢Ù¾ Ú©Ø§Ù… Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚº</p>
            <div class="month-selector">
                <label for="dashboard-month">Ú©Ø§Ù… Ú©Ø§ Ù…Ø§Û:</label>
                <select id="dashboard-month" onchange="changeWorkingMonth()">
                    <option value="">Ù…Ø§Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>
                </select>
                <button type="button" class="pdf-download-btn" onclick="downloadMonthlyReport()">
                    Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ
                </button>
            </div>
        </div>

        <!-- Reorganized Navigation -->
        <div class="main-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')" id="dashboard-btn">
                ğŸ“Š ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ
            </button>
            <button class="nav-btn" onclick="showSection('customers')" id="customers-btn">
                ğŸ‘¥ Ú¯Ø§ÛÚ©
            </button>
            <button class="nav-btn" onclick="showSection('add-customer')" id="add-customer-btn">
                â• Ù†ÛŒØ§ Ú¯Ø§ÛÚ©
            </button>
            <button class="nav-btn" onclick="showSection('reports')" id="reports-btn">
                ğŸ“‹ Ø±Ù¾ÙˆØ±Ù¹Ø³
            </button>
            <button class="nav-btn" onclick="showSection('settings')" id="settings-btn">
                âš™ï¸ Ø³ÛŒÙ¹Ù†Ú¯Ø²
            </button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="total-customers">0</h3>
                    <p>Ú©Ù„ Ú¯Ø§ÛÚ©</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-revenue">0</h3>
                    <p>Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ (PKR)</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-received">0</h3>
                    <p>ÙˆØµÙˆÙ„ Ø´Ø¯Û (PKR)</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-pending">0</h3>
                    <p>Ø¨Ø§Ù‚ÛŒ (PKR)</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="pdf-download-btn" onclick="downloadBusinessReport()">
                    ğŸ¢ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ
                </button>
                <button class="pdf-download-btn" onclick="downloadCompleteReport()">
                    ğŸ“Š Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ
                </button>
            </div>
        </div>

        <!-- Customers Section -->
        <div id="customers" class="section hidden">
            <div class="customers-grid" id="customers-grid">
                <!-- Customer cards will be dynamically added here -->
            </div>
        </div>

        <!-- Add Customer Section -->
        <div id="add-customer" class="section hidden">
            <div class="modal-content" style="max-width: 500px; margin: 0 auto;">
                <h2 class="section-title">Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
                <form id="customer-form">
                    <div class="form-group">
                        <label>Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù… *</label>
                        <input type="text" id="customer-name" required>
                    </div>
                    <div class="form-group">
                        <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø±</label>
                        <input type="tel" id="customer-phone">
                    </div>
                    <div class="form-group">
                        <label>Ù¾ØªÛ</label>
                        <textarea id="customer-address" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ Ù‚ÛŒÙ…Øª (ÙÛŒ Ù„ÛŒÙ¹Ø±)</label>
                        <input type="number" id="customer-rate" value="200" min="0" step="1">
                    </div>
                    <button type="submit" class="submit-btn">Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                </form>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section hidden">
            <h2 class="section-title">Ø±Ù¾ÙˆØ±Ù¹Ø³ Ø§ÙˆØ± ØªØ¬Ø²ÛŒØ§Øª</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="report-customers">0</h3>
                    <p>Ø§Ø³ Ù…Ø§Û Ú©Û’ Ú¯Ø§ÛÚ©</p>
                </div>
                <div class="stat-card">
                    <h3 id="report-revenue">0</h3>
                    <p>Ø§Ø³ Ù…Ø§Û Ú©ÛŒ Ø¢Ù…Ø¯Ù†ÛŒ</p>
                </div>
                <div class="stat-card">
                    <h3 id="report-payments">0</h3>
                    <p>Ø§Ø³ Ù…Ø§Û Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</p>
                </div>
                <div class="stat-card">
                    <h3 id="report-pending">0</h3>
                    <p>Ø§Ø³ Ù…Ø§Û Ú©Ø§ Ø¨Ø§Ù‚ÛŒ</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="pdf-download-btn" onclick="downloadMonthlyReport()">
                    ğŸ“… Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹
                </button>
                <button class="pdf-download-btn" onclick="downloadBusinessReport()">
                    ğŸ¢ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹
                </button>
                <button class="pdf-download-btn" onclick="downloadCompleteReport()">
                    ğŸ“Š Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹
                </button>
                <button class="pdf-download-btn" onclick="downloadAllCustomersReport()">
                    ğŸ‘¥ ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹
                </button>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section hidden">
            <h2 class="section-title">Ø³ÛŒÙ¹Ù†Ú¯Ø²</h2>
            
            <!-- GitHub Setup -->
            <div class="github-setup">
                <h3>ğŸ”§ GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ø³ÛŒÙ¹ Ø§Ù¾</h3>
                <p>Ø¢Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ø±Ú©Ú¾Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ GitHub Ø³Û’ Ú©Ù†Ú©Ù¹ Ú©Ø±ÛŒÚº</p>
                <div class="github-form">
                    <input type="text" id="github-token" class="github-input" 
                           placeholder="GitHub Personal Access Token" 
                           value="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">
                    <input type="text" id="github-repo" class="github-input" 
                           placeholder="Repository Name (e.g., username/repo-name)" 
                           value="abdul8659/milk-business-app">
                    <button type="button" class="github-btn" onclick="setupGitHubBackup()">
                        GitHub Ú©Ù†Ú©Ù¹ Ú©Ø±ÛŒÚº
                    </button>
                </div>
                <div id="github-status" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;">
                    <span id="github-status-text">Ready</span>
                </div>
            </div>

            <!-- Auto Backup Settings -->
            <div class="backup-settings">
                <h3>â° Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ Ø³ÛŒÙ¹Ù†Ú¯Ø²</h3>
                <p>Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø§ ÙˆÙ‚ÙÛ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</p>
                <div class="backup-interval">
                    <label>Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø§ ÙˆÙ‚ÙÛ:</label>
                    <select id="backup-interval" onchange="updateBackupInterval()">
                        <option value="2">2 Ù…Ù†Ù¹</option>
                        <option value="5">5 Ù…Ù†Ù¹</option>
                        <option value="10">10 Ù…Ù†Ù¹</option>
                        <option value="30">30 Ù…Ù†Ù¹</option>
                        <option value="60">1 Ú¯Ú¾Ù†Ù¹Û</option>
                    </select>
                </div>
                <div class="backup-checkbox">
                    <input type="checkbox" id="auto-backup-enabled" checked onchange="toggleAutoBackup()">
                    <label for="auto-backup-enabled">Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ¹Ø§Ù„ Ú©Ø±ÛŒÚº</label>
                </div>
                <div style="margin-top: 15px;">
                    <button type="button" class="github-btn" onclick="manualBackup()">
                        ÙÙˆØ±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø±ÛŒÚº
                    </button>
                    <button type="button" class="github-btn" onclick="restoreFromGitHub()">
                        GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ
                    </button>
                </div>
            </div>

            <!-- Data Management -->
            <div class="backup-settings">
                <h3>ğŸ’¾ ÚˆÛŒÙ¹Ø§ Ù…Ù†ÛŒØ¬Ù…Ù†Ù¹</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                    <button type="button" class="github-btn" onclick="exportData()">
                        ÚˆÛŒÙ¹Ø§ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹
                    </button>
                    <button type="button" class="github-btn" onclick="document.getElementById('import-file').click()">
                        ÚˆÛŒÙ¹Ø§ Ø§Ù…Ù¾ÙˆØ±Ù¹
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Ledger Modal -->
    <div class="modal" id="ledger-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('ledger-modal')">&times;</span>
            <h2 class="section-title" id="ledger-title">Ú¯Ø§ÛÚ© Ú©Ú¾Ø§ØªØ§</h2>
            
            <div class="month-selector" style="margin-bottom: 20px;">
                <label>Ù…Ø§Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                <select id="ledger-month" onchange="filterLedgerByMonth()">
                    <option value="">ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²</option>
                </select>
                <button type="button" class="pdf-download-btn" onclick="downloadCustomerLedger()">
                    Ù„ÛŒØ¬Ø± ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ
                </button>
            </div>

            <div class="customer-actions" style="margin-bottom: 20px;">
                <button class="action-btn btn-primary" onclick="showAddEntryModal()">
                    Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ
                </button>
                <button class="action-btn btn-warning" onclick="showDayOffModal()">
                    Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†
                </button>
                <button class="action-btn btn-success" onclick="showPaymentModal()">
                    Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ
                </button>
                <button class="action-btn btn-info" onclick="generateCustomerPDF()">
                    PDF Ø±Ù¾ÙˆØ±Ù¹
                </button>
            </div>

            <div class="ledger-entries" id="ledger-entries">
                <!-- Entries will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Entry Modal -->
    <div class="modal" id="add-entry-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('add-entry-modal')">&times;</span>
            <h2 class="section-title">Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
            <form id="entry-form">
                <div class="form-group">
                    <label>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="entry-from-date" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="entry-to-date" required>
                </div>
                <div class="form-group">
                    <label>Ù„ÛŒÙ¹Ø± (Ø±ÙˆØ²Ø§Ù†Û) *</label>
                    <input type="number" id="entry-liters" step="0.5" min="0" required>
                </div>
                <div class="form-group">
                    <label>Ø±ÛŒÙ¹ (ÙÛŒ Ù„ÛŒÙ¹Ø±) *</label>
                    <input type="number" id="entry-rate" min="0" step="1" required>
                </div>
                <button type="submit" class="submit-btn">Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
            </form>
        </div>
    </div>

    <!-- Day Off Modal -->
    <div class="modal" id="day-off-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('day-off-modal')">&times;</span>
            <h2 class="section-title">Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</h2>
            <form id="day-off-form">
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="day-off-date" required>
                </div>
                <div class="form-group">
                    <label>ÙˆØ¬Û</label>
                    <input type="text" id="day-off-reason" placeholder="Ù…Ø«Ø§Ù„: Ø¹ÛŒØ¯ØŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒØŒ ÙˆØºÛŒØ±Û">
                </div>
                <button type="submit" class="submit-btn">Ú†Ú¾Ù¹ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('payment-modal')">&times;</span>
            <h2 class="section-title">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
            <form id="payment-form">
                <div class="form-group">
                    <label>Ø±Ù‚Ù… *</label>
                    <input type="number" id="payment-amount" min="0" step="1" required>
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="payment-date" required>
                </div>
                <div class="form-group">
                    <label>Ø·Ø±ÛŒÙ‚Û Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</label>
                    <select id="payment-method">
                        <option value="Ù†Ù‚Ø¯">Ù†Ù‚Ø¯</option>
                        <option value="Ø¨ÛŒÙ†Ú©">Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±</option>
                        <option value="Ù…ÙˆØ¨Ø§Ø¦Ù„">Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾ÛŒÙ…Ù†Ù¹</option>
                        <option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆÙ¹Ø³</label>
                    <textarea id="payment-notes" rows="2"></textarea>
                </div>
                <button type="submit" class="submit-btn">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
            </form>
        </div>
    </div>

    <!-- Notification Element -->
    <div id="notification" class="notification">
        <span id="notification-text"></span>
    </div>

    <script>
        // Global Variables
        let customers = [];
        let nextId = 1;
        let currentCustomerId = null;
        let currentEditEntryId = null;
        let currentWorkingMonth = new Date().toISOString().slice(0, 7);
        let autoBackupInterval = null;
        let backupIntervalMinutes = 2;

        // GitHub Settings
        let gitHubSettings = {
            token: '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',
            repo: 'abdul8659/milk-business-app',
            username: ''
        };

        // Month Names in Urdu
        const monthNames = {
            '01': 'Ø¬Ù†ÙˆØ±ÛŒ', '02': 'ÙØ±ÙˆØ±ÛŒ', '03': 'Ù…Ø§Ø±Ú†', '04': 'Ø§Ù¾Ø±ÛŒÙ„',
            '05': 'Ù…Ø¦ÛŒ', '06': 'Ø¬ÙˆÙ†', '07': 'Ø¬ÙˆÙ„Ø§Ø¦ÛŒ', '08': 'Ø§Ú¯Ø³Øª',
            '09': 'Ø³ØªÙ…Ø¨Ø±', '10': 'Ø§Ú©ØªÙˆØ¨Ø±', '11': 'Ù†ÙˆÙ…Ø¨Ø±', '12': 'Ø¯Ø³Ù…Ø¨Ø±'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            setupMonthSelectors();
            updateDashboard();
            updateWorkingMonthDisplay();
            setupAutoBackup();
            
            // Try to restore from GitHub if no local data
            if (customers.length === 0) {
                restoreFromGitHub();
            }

            // Setup forms
            setupForms();
            
            // Set default dates
            setDefaultDates();
        });

        // =================== MONTH MANAGEMENT ===================
        function setupMonthSelectors() {
            const selectors = ['dashboard-month', 'ledger-month'];
            const currentDate = new Date();
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                if (!selector) return;
                
                selector.innerHTML = selectorId === 'ledger-month' ? '<option value="">ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²</option>' : '<option value="">Ù…Ø§Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                
                // Add previous 12 months and next 6 months
                for (let i = -12; i <= 6; i++) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() + i, 1);
                    const monthKey = date.toISOString().slice(0, 7);
                    const yearMonth = monthKey.split('-');
                    const monthName = monthNames[yearMonth[1]] + ' ' + yearMonth[0];
                    
                    const option = document.createElement('option');
                    option.value = monthKey;
                    option.textContent = monthName;
                    
                    if (monthKey === currentWorkingMonth) {
                        option.selected = true;
                    }
                    
                    selector.appendChild(option);
                }
            });
        }

        function changeWorkingMonth() {
            const selectedMonth = document.getElementById('dashboard-month').value;
            if (selectedMonth) {
                currentWorkingMonth = selectedMonth;
                updateWorkingMonthDisplay();
                updateDashboard();
                saveToStorage();
                showNotification('Ú©Ø§Ù… Ú©Ø§ Ù…Ø§Û ØªØ¨Ø¯ÛŒÙ„ ÛÙˆ Ú¯ÛŒØ§: ' + getMonthName(selectedMonth), 'success');
            }
        }

        function updateWorkingMonthDisplay() {
            const display = document.getElementById('selected-month-name');
            if (display) {
                display.textContent = getMonthName(currentWorkingMonth);
            }
        }

        function getMonthName(monthKey) {
            if (!monthKey) return 'Ù…Ù†ØªØ®Ø¨ Ù†ÛÛŒÚº';
            const parts = monthKey.split('-');
            return monthNames[parts[1]] + ' ' + parts[0];
        }

        // =================== STORAGE FUNCTIONS ===================
        function saveToStorage() {
            const data = {
                customers: customers,
                nextId: nextId,
                currentWorkingMonth: currentWorkingMonth,
                gitHubSettings: gitHubSettings,
                backupIntervalMinutes: backupIntervalMinutes,
                lastSave: new Date().toISOString()
            };
            localStorage.setItem('milkBusinessData', JSON.stringify(data));
        }

        function loadFromStorage() {
            const data = localStorage.getItem('milkBusinessData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    customers = parsed.customers || [];
                    nextId = parsed.nextId || 1;
                    currentWorkingMonth = parsed.currentWorkingMonth || new Date().toISOString().slice(0, 7);
                    gitHubSettings = { ...gitHubSettings, ...parsed.gitHubSettings };
                    backupIntervalMinutes = parsed.backupIntervalMinutes || 2;
                    
                    // Update UI elements
                    if (gitHubSettings.token) {
                        document.getElementById('github-token').value = gitHubSettings.token;
                    }
                    if (gitHubSettings.repo) {
                        document.getElementById('github-repo').value = gitHubSettings.repo;
                    }
                    document.getElementById('backup-interval').value = backupIntervalMinutes;
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    showNotification('ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                }
            }
        }

        // =================== SECTION MANAGEMENT ===================
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Remove active class from all nav buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName).classList.remove('hidden');
            document.getElementById(sectionName + '-btn').classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'customers') {
                loadCustomers();
            } else if (sectionName === 'dashboard') {
                updateDashboard();
            } else if (sectionName === 'reports') {
                updateReports();
            }
        }

        // =================== CUSTOMER MANAGEMENT ===================
        function setupForms() {
            // Customer form
            document.getElementById('customer-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addCustomer();
            });

            // Entry form
            document.getElementById('entry-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addEntry();
            });

            // Day off form
            document.getElementById('day-off-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addDayOff();
            });

            // Payment form
            document.getElementById('payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addPayment();
            });
        }

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = ['entry-from-date', 'entry-to-date', 'day-off-date', 'payment-date'];
            dateInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = today;
            });
        }

        function addCustomer() {
            const name = document.getElementById('customer-name').value.trim();
            const phone = document.getElementById('customer-phone').value.trim();
            const address = document.getElementById('customer-address').value.trim();
            const rate = parseFloat(document.getElementById('customer-rate').value) || 200;

            if (!name) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }

            const customer = {
                id: nextId++,
                name: name,
                phone: phone,
                address: address,
                rate: rate,
                entries: [],
                payments: [],
                createdAt: new Date().toISOString()
            };

            customers.push(customer);
            saveToStorage();
            
            // Reset form
            document.getElementById('customer-form').reset();
            document.getElementById('customer-rate').value = 200;
            
            showNotification('Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆØ§!', 'success');
            
            // Switch to customers view
            showSection('customers');
        }

        function loadCustomers() {
            const grid = document.getElementById('customers-grid');
            grid.innerHTML = '';

            if (customers.length === 0) {
                grid.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #666;"><h3>Ø§Ø¨Ú¾ÛŒ ØªÚ© Ú©ÙˆØ¦ÛŒ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ù†ÛÛŒÚº ÛÙˆØ§</h3><p>Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ "Ù†ÛŒØ§ Ú¯Ø§ÛÚ©" Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚº</p></div>';
                return;
            }

            customers.forEach(customer => {
                const card = createCustomerCard(customer);
                grid.appendChild(card);
            });
        }

        function createCustomerCard(customer) {
            // Calculate customer statistics
            let totalRevenue = 0;
            let totalPayments = 0;
            let totalLiters = 0;
            let totalDays = 0;

            customer.entries?.forEach(entry => {
                if (entry.type === 'delivery') {
                    const days = calculateDays(entry.fromDate, entry.toDate);
                    totalDays += days;
                    totalLiters += days * entry.liters;
                    totalRevenue += days * entry.liters * entry.rate;
                }
            });

            customer.payments?.forEach(payment => {
                totalPayments += parseFloat(payment.amount);
            });

            const remaining = totalRevenue - totalPayments;

            const card = document.createElement('div');
            card.className = 'customer-card';
            card.innerHTML = `
                <div class="customer-info">
                    <h3>${customer.name}</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        ${customer.phone ? 'ğŸ“ ' + customer.phone : ''}
                        ${customer.address ? ' | ğŸ“ ' + customer.address : ''}
                    </p>
                    
                    <div class="customer-stats">
                        <div class="stat-item">
                            <div class="stat-value">${totalLiters.toFixed(1)}</div>
                            <div class="stat-label">Ú©Ù„ Ù„ÛŒÙ¹Ø±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalRevenue.toLocaleString()}</div>
                            <div class="stat-label">Ú©Ù„ Ø¨Ù„</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalPayments.toLocaleString()}</div>
                            <div class="stat-label">Ø§Ø¯Ø§ Ø´Ø¯Û</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color: ${remaining > 0 ? '#e74c3c' : '#00b894'}">${remaining.toLocaleString()}</div>
                            <div class="stat-label">Ø¨Ø§Ù‚ÛŒ</div>
                        </div>
                    </div>
                    
                    <div class="customer-actions">
                        <button class="action-btn btn-primary" onclick="openLedger(${customer.id})">
                            ğŸ“– Ú©Ú¾Ø§ØªØ§
                        </button>
                        <button class="action-btn btn-success" onclick="generateCustomerPDF(${customer.id})">
                            ğŸ“„ PDF
                        </button>
                        <button class="action-btn btn-warning" onclick="editCustomer(${customer.id})">
                            âœï¸ ØªØ±Ù…ÛŒÙ…
                        </button>
                        <button class="action-btn btn-danger" onclick="deleteCustomer(${customer.id})">
                            ğŸ—‘ï¸ ÚˆÛŒÙ„ÛŒÙ¹
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        // =================== LEDGER MANAGEMENT ===================
        function openLedger(customerId) {
            currentCustomerId = customerId;
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                showNotification('Ú¯Ø§ÛÚ© Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†ÛÛŒÚº Ù…Ù„ÛŒÚº', 'error');
                return;
            }

            document.getElementById('ledger-title').textContent = customer.name + ' - Ú©Ú¾Ø§ØªØ§';
            
            // Set ledger month to current working month
            document.getElementById('ledger-month').value = currentWorkingMonth;
            
            loadLedgerEntries(customerId);
            document.getElementById('ledger-modal').classList.add('show');
        }

        function loadLedgerEntries(customerId) {
            const customer = customers.find(c => c.id === customerId);
            const container = document.getElementById('ledger-entries');
            const selectedMonth = document.getElementById('ledger-month').value;
            
            if (!customer) return;

            container.innerHTML = '';

            let entries = [...(customer.entries || []), ...(customer.payments || [])];
            
            // Filter by month if selected
            if (selectedMonth) {
                entries = entries.filter(entry => {
                    const entryMonth = entry.month || (entry.date ? entry.date.slice(0, 7) : 
                                     entry.fromDate ? entry.fromDate.slice(0, 7) : null);
                    return entryMonth === selectedMonth;
                });
            }

            // Sort by date
            entries.sort((a, b) => {
                const dateA = a.date || a.fromDate || '';
                const dateB = b.date || b.fromDate || '';
                return new Date(dateB) - new Date(dateA);
            });

            if (entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><h3>Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº Ù…Ù„ÛŒ</h3><p>Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø§ÙˆÙ¾Ø± Ú©Û’ Ø¨Ù¹Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº</p></div>';
                return;
            }

            entries.forEach(entry => {
                const entryElement = createEntryElement(entry);
                container.appendChild(entryElement);
            });
        }

        function createEntryElement(entry) {
            const div = document.createElement('div');
            div.className = `entry-item ${entry.type || 'payment'}`;
            
            let content = '';
            
            if (entry.type === 'delivery') {
                const days = calculateDays(entry.fromDate, entry.toDate);
                const total = days * entry.liters * entry.rate;
                
                content = `
                    <div class="entry-header">
                        <span class="entry-type">ÚˆÛŒÙ„ÛŒÙˆØ±ÛŒ</span>
                        <div>
                            <button class="action-btn btn-warning" onclick="editEntry(${entry.id})" style="padding: 5px 10px; font-size: 10px;">ØªØ±Ù…ÛŒÙ…</button>
                            <button class="action-btn btn-danger" onclick="deleteEntry(${entry.id})" style="padding: 5px 10px; font-size: 10px;">ÚˆÛŒÙ„ÛŒÙ¹</button>
                        </div>
                    </div>
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="detail-value">${entry.fromDate}</div>
                            <div class="detail-label">Ø´Ø±ÙˆØ¹</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${entry.toDate}</div>
                            <div class="detail-label">Ø§Ø®ØªØªØ§Ù…</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${days}</div>
                            <div class="detail-label">Ø¯Ù†</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${entry.liters}</div>
                            <div class="detail-label">Ù„ÛŒÙ¹Ø±/Ø¯Ù†</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${entry.rate}</div>
                            <div class="detail-label">Ø±ÛŒÙ¹</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${total.toLocaleString()}</div>
                            <div class="detail-label">Ú©Ù„</div>
                        </div>
                    </div>
                `;
            } else if (entry.type === 'day-off') {
                content = `
                    <div class="entry-header">
                        <span class="entry-type day-off">Ú†Ú¾Ù¹ÛŒ</span>
                        <div>
                            <button class="action-btn btn-danger" onclick="deleteDayOff(${entry.id})" style="padding: 5px 10px; font-size: 10px;">ÚˆÛŒÙ„ÛŒÙ¹</button>
                        </div>
                    </div>
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="detail-value">${entry.date}</div>
                            <div class="detail-label">ØªØ§Ø±ÛŒØ®</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${entry.reason || 'ÙˆØ¬Û Ù†ÛÛŒÚº Ø¯ÛŒ Ú¯Ø¦ÛŒ'}</div>
                            <div class="detail-label">ÙˆØ¬Û</div>
                        </div>
                    </div>
                `;
            } else {
                // Payment entry
                content = `
                    <div class="entry-header">
                        <span class="entry-type" style="background: #00b894;">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</span>
                        <div>
                            <button class="action-btn btn-danger" onclick="deletePayment(${entry.id})" style="padding: 5px 10px; font-size: 10px;">ÚˆÛŒÙ„ÛŒÙ¹</button>
                        </div>
                    </div>
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="detail-value">${entry.date}</div>
                            <div class="detail-label">ØªØ§Ø±ÛŒØ®</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${parseFloat(entry.amount).toLocaleString()}</div>
                            <div class="detail-label">Ø±Ù‚Ù…</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${entry.method || 'Ù†Ù‚Ø¯'}</div>
                            <div class="detail-label">Ø·Ø±ÛŒÙ‚Û</div>
                        </div>
                        ${entry.notes ? `
                        <div class="detail-item">
                            <div class="detail-value">${entry.notes}</div>
                            <div class="detail-label">Ù†ÙˆÙ¹Ø³</div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            div.innerHTML = content;
            return div;
        }

        function filterLedgerByMonth() {
            if (currentCustomerId) {
                loadLedgerEntries(currentCustomerId);
            }
        }

        // =================== ENTRY MANAGEMENT ===================
        function showAddEntryModal() {
            resetEntryModal();
            document.getElementById('add-entry-modal').classList.add('show');
        }

        function showDayOffModal() {
            resetDayOffModal();
            document.getElementById('day-off-modal').classList.add('show');
        }

        function showPaymentModal() {
            document.getElementById('payment-modal').classList.add('show');
        }

        function addEntry() {
            const fromDate = document.getElementById('entry-from-date').value;
            const toDate = document.getElementById('entry-to-date').value;
            const liters = parseFloat(document.getElementById('entry-liters').value);
            const rate = parseFloat(document.getElementById('entry-rate').value);

            if (!fromDate || !toDate || !liters || !rate) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ù¾ÙØ± Ú©Ø±ÛŒÚº', 'error');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                showNotification('Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø³Û’ Ø²ÛŒØ§Ø¯Û Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ', 'error');
                return;
            }

            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer) return;

            const entry = {
                id: Date.now(),
                type: 'delivery',
                fromDate: fromDate,
                toDate: toDate,
                liters: liters,
                rate: rate,
                month: currentWorkingMonth,
                createdAt: new Date().toISOString()
            };

            if (currentEditEntryId) {
                // Update existing entry
                const index = customer.entries.findIndex(e => e.id === currentEditEntryId);
                if (index !== -1) {
                    customer.entries[index] = { ...customer.entries[index], ...entry, id: currentEditEntryId };
                }
                showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆØ¦ÛŒ!', 'success');
            } else {
                // Add new entry
                customer.entries = customer.entries || [];
                customer.entries.push(entry);
                showNotification('Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆØ¦ÛŒ!', 'success');
            }

            saveToStorage();
            loadLedgerEntries(currentCustomerId);
            closeModal('add-entry-modal');
            document.getElementById('entry-form').reset();
            setDefaultDates();
        }

        function addDayOff() {
            const date = document.getElementById('day-off-date').value;
            const reason = document.getElementById('day-off-reason').value.trim();

            if (!date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }

            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer) return;

            const dayOff = {
                id: Date.now(),
                type: 'day-off',
                date: date,
                reason: reason,
                month: currentWorkingMonth,
                createdAt: new Date().toISOString()
            };

            customer.entries = customer.entries || [];
            customer.entries.push(dayOff);

            saveToStorage();
            loadLedgerEntries(currentCustomerId);
            closeModal('day-off-modal');
            document.getElementById('day-off-form').reset();
            setDefaultDates();
            
            showNotification('Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù† Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
        }

        function addPayment() {
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const date = document.getElementById('payment-date').value;
            const method = document.getElementById('payment-method').value;
            const notes = document.getElementById('payment-notes').value.trim();

            if (!amount || !date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù‚Ù… Ø§ÙˆØ± ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }

            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer) return;

            const payment = {
                id: Date.now(),
                type: 'payment',
                amount: amount,
                date: date,
                method: method,
                notes: notes,
                month: currentWorkingMonth,
                createdAt: new Date().toISOString()
            };

            customer.payments = customer.payments || [];
            customer.payments.push(payment);

            saveToStorage();
            loadLedgerEntries(currentCustomerId);
            closeModal('payment-modal');
            document.getElementById('payment-form').reset();
            setDefaultDates();
            
            showNotification('Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆØ¦ÛŒ!', 'success');
        }

        // =================== UTILITY FUNCTIONS ===================
        function calculateDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const timeDiff = end.getTime() - start.getTime();
            return Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function resetEntryModal() {
            currentEditEntryId = null;
            const modal = document.getElementById('add-entry-modal');
            const title = modal.querySelector('.section-title');
            const button = modal.querySelector('.submit-btn');
            
            title.textContent = 'Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            button.textContent = 'Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
        }

        function resetDayOffModal() {
            currentEditEntryId = null;
            const modal = document.getElementById('day-off-modal');
            const title = modal.querySelector('.section-title');
            const button = modal.querySelector('.submit-btn');
            
            title.textContent = 'Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†';
            button.textContent = 'Ú†Ú¾Ù¹ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
        }

        // =================== DASHBOARD UPDATES ===================
        function updateDashboard() {
            let totalCustomers = customers.length;
            let totalRevenue = 0;
            let totalReceived = 0;
            let monthlyRevenue = 0;
            let monthlyReceived = 0;
            let monthlyCustomers = 0;

            customers.forEach(customer => {
                let customerMonthlyActivity = false;
                
                // Calculate total revenue
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        if (entry.type === 'delivery') {
                            const days = calculateDays(entry.fromDate, entry.toDate);
                            const revenue = days * entry.liters * entry.rate;
                            totalRevenue += revenue;
                            
                            // Check if this entry is in current working month
                            const entryMonth = entry.month || entry.fromDate.slice(0, 7);
                            if (entryMonth === currentWorkingMonth) {
                                monthlyRevenue += revenue;
                                customerMonthlyActivity = true;
                            }
                        }
                    });
                }
                
                // Calculate total payments
                if (customer.payments) {
                    customer.payments.forEach(payment => {
                        const amount = parseFloat(payment.amount);
                        totalReceived += amount;
                        
                        // Check if this payment is in current working month
                        const paymentMonth = payment.month || payment.date.slice(0, 7);
                        if (paymentMonth === currentWorkingMonth) {
                            monthlyReceived += amount;
                        }
                    });
                }
                
                if (customerMonthlyActivity) {
                    monthlyCustomers++;
                }
            });

            const totalPending = totalRevenue - totalReceived;
            const monthlyPending = monthlyRevenue - monthlyReceived;

            // Update dashboard stats
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString();
            document.getElementById('total-received').textContent = totalReceived.toLocaleString();
            document.getElementById('total-pending').textContent = totalPending.toLocaleString();

            // Update reports section if visible
            const reportsSection = document.getElementById('reports');
            if (!reportsSection.classList.contains('hidden')) {
                updateReports();
            }
        }

        function updateReports() {
            let monthlyRevenue = 0;
            let monthlyReceived = 0;
            let monthlyCustomers = 0;

            customers.forEach(customer => {
                let customerMonthlyActivity = false;
                
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        if (entry.type === 'delivery') {
                            const entryMonth = entry.month || entry.fromDate.slice(0, 7);
                            if (entryMonth === currentWorkingMonth) {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                monthlyRevenue += days * entry.liters * entry.rate;
                                customerMonthlyActivity = true;
                            }
                        }
                    });
                }
                
                if (customer.payments) {
                    customer.payments.forEach(payment => {
                        const paymentMonth = payment.month || payment.date.slice(0, 7);
                        if (paymentMonth === currentWorkingMonth) {
                            monthlyReceived += parseFloat(payment.amount);
                        }
                    });
                }
                
                if (customerMonthlyActivity) {
                    monthlyCustomers++;
                }
            });

            const monthlyPending = monthlyRevenue - monthlyReceived;

            document.getElementById('report-customers').textContent = monthlyCustomers;
            document.getElementById('report-revenue').textContent = monthlyRevenue.toLocaleString();
            document.getElementById('report-payments').textContent = monthlyReceived.toLocaleString();
            document.getElementById('report-pending').textContent = monthlyPending.toLocaleString();
        }

        // =================== NOTIFICATION SYSTEM ===================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            
            text.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateBackupStatus(message, type = 'success') {
            const statusEl = document.getElementById('backup-status');
            if (statusEl) {
                statusEl.innerHTML = `
                    <span class="status-indicator"></span>
                    ${message}
                `;
                statusEl.className = `backup-status ${type}`;
            }
        }

        // =================== GITHUB BACKUP SYSTEM ===================
        async function setupGitHubBackup() {
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            
            if (!token || !repo) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… GitHub Ù¹ÙˆÚ©Ù† Ø§ÙˆØ± Ø±ÛŒÙ¾ÙˆØ²ÛŒÙ¹Ø±ÛŒ Ú©Ø§ Ù†Ø§Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            updateBackupStatus('GitHub Ø³ÛŒÙ¹ Ø§Ù¾...', 'syncing');
            
            try {
                // Test GitHub connection
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    gitHubSettings.token = token;
                    gitHubSettings.repo = repo;
                    gitHubSettings.username = userData.login;
                    
                    saveToStorage();
                    showNotification('GitHub Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ú©Ù†Ú©Ù¹ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                    updateBackupStatus('GitHub Ready âœ“', 'success');
                    
                    // Start auto backup
                    setupAutoBackup();
                } else {
                    throw new Error('Invalid GitHub token');
                }
            } catch (error) {
                console.error('GitHub setup error:', error);
                showNotification('GitHub Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                updateBackupStatus('GitHub Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function setupAutoBackup() {
            // Clear existing interval
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }
            
            // Check if auto backup is enabled
            const enabled = document.getElementById('auto-backup-enabled').checked;
            if (!enabled || !gitHubSettings.token) {
                updateBackupStatus('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ØºÛŒØ± ÙØ¹Ø§Ù„', 'error');
                return;
            }
            
            // Set up new interval
            const intervalMs = backupIntervalMinutes * 60 * 1000;
            autoBackupInterval = setInterval(async () => {
                await manualBackup(false); // Silent backup
            }, intervalMs);
            
            updateBackupStatus(`Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„ (${backupIntervalMinutes} Ù…Ù†Ù¹)`, 'success');
        }

        function updateBackupInterval() {
            backupIntervalMinutes = parseInt(document.getElementById('backup-interval').value);
            saveToStorage();
            setupAutoBackup();
        }

        function toggleAutoBackup() {
            setupAutoBackup();
        }

        async function manualBackup(showNotifications = true) {
            if (!gitHubSettings.token) {
                if (showNotifications) {
                    showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                }
                return;
            }
            
            updateBackupStatus('GitHub Ø¨ÛŒÚ© Ø§Ù¾...', 'syncing');
            
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const data = {
                    customers: customers,
                    nextId: nextId,
                    currentWorkingMonth: currentWorkingMonth,
                    backupDate: new Date().toISOString(),
                    version: '4.0'
                };
                
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const fileName = `backups/backup_${timestamp}.json`;
                
                // Upload to GitHub
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Auto Backup - ${new Date().toLocaleString('ur-PK')}`,
                        content: content
                    })
                });
                
                if (response.ok) {
                    if (showNotifications) {
                        showNotification('GitHub Ù…ÛŒÚº Ø¨ÛŒÚ© Ø§Ù¾ Ù…Ú©Ù…Ù„!', 'success');
                    }
                    updateBackupStatus(`Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„ (${backupIntervalMinutes} Ù…Ù†Ù¹)`, 'success');
                } else {
                    throw new Error('Backup failed');
                }
                
            } catch (error) {
                console.error('Backup error:', error);
                if (showNotifications) {
                    showNotification('Ø¨ÛŒÚ© Ø§Ù¾ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                }
                updateBackupStatus('Ø¨ÛŒÚ© Ø§Ù¾ Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function restoreFromGitHub() {
            if (!gitHubSettings.token) {
                showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            updateBackupStatus('GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ...', 'syncing');
            
            try {
                // Get list of backup files
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/backups`, {
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const files = await response.json();
                    const backupFiles = files.filter(file => file.name.endsWith('.json'));
                    
                    if (backupFiles.length === 0) {
                        showNotification('Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                        return;
                    }
                    
                    // Get the latest backup file
                    const latestFile = backupFiles.sort((a, b) => b.name.localeCompare(a.name))[0];
                    
                    // Download and restore
                    const fileResponse = await fetch(latestFile.download_url);
                    const backupData = await fileResponse.json();
                    
                    if (backupData.customers) {
                        customers = backupData.customers;
                        nextId = backupData.nextId || 1;
                        currentWorkingMonth = backupData.currentWorkingMonth || new Date().toISOString().slice(0, 7);
                        
                        saveToStorage();
                        updateDashboard();
                        setupMonthSelectors();
                        updateWorkingMonthDisplay();
                        
                        showNotification('GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                        updateBackupStatus(`Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ÙØ¹Ø§Ù„ (${backupIntervalMinutes} Ù…Ù†Ù¹)`, 'success');
                    }
                } else {
                    throw new Error('Failed to fetch backup files');
                }
                
            } catch (error) {
                console.error('Restore error:', error);
                showNotification('Ø¨Ø­Ø§Ù„ÛŒ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                updateBackupStatus('Ø¨Ø­Ø§Ù„ÛŒ Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        // =================== PDF GENERATION WITH URDU FONTS ===================
        async function downloadCustomerLedger() {
            if (!currentCustomerId) return;
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer) return;
            
            const selectedMonth = document.getElementById('ledger-month').value;
            const monthName = selectedMonth ? getMonthName(selectedMonth) : 'ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²';
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Set font for better Urdu support
                doc.setFont("helvetica");
                
                let yPosition = 20;
                
                // Header with colors
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(18);
                doc.text('Customer Ledger / Ú¯Ø§ÛÚ© Ú©Ú¾Ø§ØªØ§', 105, 18, { align: 'center' });
                doc.setFontSize(14);
                doc.text(customer.name, 105, 28, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Month / Ù…Ø§Û: ${monthName}`, 105, 36, { align: 'center' });
                
                yPosition = 50;
                doc.setTextColor(0, 0, 0);
                
                // Customer Info
                doc.setFontSize(12);
                doc.text(`Customer / Ú¯Ø§ÛÚ©: ${customer.name}`, 15, yPosition);
                yPosition += 8;
                if (customer.phone) {
                    doc.text(`Phone / ÙÙˆÙ†: ${customer.phone}`, 15, yPosition);
                    yPosition += 8;
                }
                if (customer.address) {
                    doc.text(`Address / Ù¾ØªÛ: ${customer.address}`, 15, yPosition);
                    yPosition += 8;
                }
                
                yPosition += 10;
                
                // Filter entries by month
                let allEntries = [...(customer.entries || []), ...(customer.payments || [])];
                if (selectedMonth) {
                    allEntries = allEntries.filter(entry => {
                        const entryMonth = entry.month || (entry.date ? entry.date.slice(0, 7) : 
                                         entry.fromDate ? entry.fromDate.slice(0, 7) : null);
                        return entryMonth === selectedMonth;
                    });
                }
                
                // Sort entries by date
                allEntries.sort((a, b) => {
                    const dateA = a.date || a.fromDate || '';
                    const dateB = b.date || b.fromDate || '';
                    return new Date(dateA) - new Date(dateB);
                });
                
                // Entries
                doc.setFontSize(14);
                doc.setTextColor(102, 126, 234);
                doc.text('Entries / Ø§Ù†Ù¹Ø±ÛŒØ²:', 15, yPosition);
                yPosition += 15;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                let totalRevenue = 0;
                let totalPayments = 0;
                
                allEntries.forEach(entry => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const total = days * entry.liters * entry.rate;
                        totalRevenue += total;
                        
                        doc.setFillColor(240, 248, 255);
                        doc.rect(10, yPosition - 5, 190, 25, 'F');
                        
                        doc.text(`Delivery / ÚˆÛŒÙ„ÛŒÙˆØ±ÛŒ: ${entry.fromDate} to ${entry.toDate}`, 15, yPosition);
                        yPosition += 6;
                        doc.text(`Days / Ø¯Ù†: ${days} | Liters/Day / Ù„ÛŒÙ¹Ø± ÙÛŒ Ø¯Ù†: ${entry.liters} | Rate / Ø±ÛŒÙ¹: ${entry.rate}`, 15, yPosition);
                        yPosition += 6;
                        doc.text(`Total Amount / Ú©Ù„ Ø±Ù‚Ù…: ${total.toLocaleString()} PKR`, 15, yPosition);
                        yPosition += 10;
                        
                    } else if (entry.type === 'day-off') {
                        doc.setFillColor(255, 240, 240);
                        doc.rect(10, yPosition - 5, 190, 15, 'F');
                        
                        doc.text(`Day Off / Ú†Ú¾Ù¹ÛŒ: ${entry.date}`, 15, yPosition);
                        yPosition += 6;
                        if (entry.reason) {
                            doc.text(`Reason / ÙˆØ¬Û: ${entry.reason}`, 15, yPosition);
                            yPosition += 6;
                        }
                        yPosition += 5;
                        
                    } else {
                        // Payment
                        const amount = parseFloat(entry.amount);
                        totalPayments += amount;
                        
                        doc.setFillColor(240, 255, 240);
                        doc.rect(10, yPosition - 5, 190, 20, 'F');
                        
                        doc.text(`Payment / Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ: ${entry.date}`, 15, yPosition);
                        yPosition += 6;
                        doc.text(`Amount / Ø±Ù‚Ù…: ${amount.toLocaleString()} PKR | Method / Ø·Ø±ÛŒÙ‚Û: ${entry.method || 'Cash'}`, 15, yPosition);
                        yPosition += 6;
                        if (entry.notes) {
                            doc.text(`Notes / Ù†ÙˆÙ¹Ø³: ${entry.notes}`, 15, yPosition);
                            yPosition += 6;
                        }
                        yPosition += 5;
                    }
                });
                
                // Summary
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                yPosition += 10;
                doc.setFillColor(102, 126, 234);
                doc.rect(10, yPosition - 5, 190, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                
                yPosition += 8;
                doc.text('Summary / Ø®Ù„Ø§ØµÛ', 15, yPosition);
                yPosition += 10;
                doc.text(`Total Revenue / Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ: ${totalRevenue.toLocaleString()} PKR`, 15, yPosition);
                yPosition += 8;
                doc.text(`Total Payments / Ú©Ù„ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ: ${totalPayments.toLocaleString()} PKR`, 15, yPosition);
                yPosition += 8;
                doc.text(`Remaining / Ø¨Ø§Ù‚ÛŒ: ${(totalRevenue - totalPayments).toLocaleString()} PKR`, 15, yPosition);
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 285, 210, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text(`Customer Ledger | ${customer.name} | ${monthName} | Generated: ${new Date().toLocaleDateString('ur-PK')} | Page ${i}/${pageCount}`, 105, 292, { align: 'center' });
                }
                
                const fileName = `${customer.name}_Ledger_${selectedMonth || 'All'}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showNotification('Ú¯Ø§ÛÚ© Ú©Ú¾Ø§ØªØ§ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function downloadMonthlyReport() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                doc.setFont("helvetica");
                
                const monthName = getMonthName(currentWorkingMonth);
                let yPosition = 20;
                
                // Header
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, 210, 45, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text('Monthly Report / Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹', 105, 18, { align: 'center' });
                doc.setFontSize(16);
                doc.text(monthName, 105, 28, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Generated / ØªÛŒØ§Ø± Ú©Ø±Ø¯Û: ${new Date().toLocaleDateString('ur-PK')}`, 105, 38, { align: 'center' });
                
                yPosition = 55;
                doc.setTextColor(0, 0, 0);
                
                // Calculate monthly data
                let monthlyRevenue = 0;
                let monthlyPayments = 0;
                let monthlyCustomers = 0;
                let monthlyLiters = 0;
                let activeCustomers = [];
                
                customers.forEach(customer => {
                    let customerMonthlyRevenue = 0;
                    let customerMonthlyLiters = 0;
                    let hasActivity = false;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const entryMonth = entry.month || entry.fromDate.slice(0, 7);
                                if (entryMonth === currentWorkingMonth) {
                                    const days = calculateDays(entry.fromDate, entry.toDate);
                                    const revenue = days * entry.liters * entry.rate;
                                    customerMonthlyRevenue += revenue;
                                    customerMonthlyLiters += days * entry.liters;
                                    monthlyRevenue += revenue;
                                    monthlyLiters += days * entry.liters;
                                    hasActivity = true;
                                }
                            }
                        });
                    }
                    
                    if (customer.payments) {
                        customer.payments.forEach(payment => {
                            const paymentMonth = payment.month || payment.date.slice(0, 7);
                            if (paymentMonth === currentWorkingMonth) {
                                monthlyPayments += parseFloat(payment.amount);
                            }
                        });
                    }
                    
                    if (hasActivity) {
                        monthlyCustomers++;
                        activeCustomers.push({
                            name: customer.name,
                            revenue: customerMonthlyRevenue,
                            liters: customerMonthlyLiters
                        });
                    }
                });
                
                // Summary Section
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 50, 'F');
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 50, 'S');
                
                yPosition += 12;
                doc.setFontSize(16);
                doc.setTextColor(102, 126, 234);
                doc.text('Monthly Summary / Ù…Ø§ÛØ§Ù†Û Ø®Ù„Ø§ØµÛ', 15, yPosition);
                
                yPosition += 15;
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                doc.text(`Active Customers / ÙØ¹Ø§Ù„ Ú¯Ø§ÛÚ©: ${monthlyCustomers}`, 15, yPosition);
                doc.text(`Total Liters / Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${monthlyLiters.toFixed(1)}`, 110, yPosition);
                yPosition += 8;
                
                doc.setTextColor(76, 175, 80);
                doc.text(`Total Revenue / Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ: ${monthlyRevenue.toLocaleString()} PKR`, 15, yPosition);
                doc.setTextColor(33, 150, 243);
                doc.text(`Total Received / Ú©Ù„ ÙˆØµÙˆÙ„ÛŒ: ${monthlyPayments.toLocaleString()} PKR`, 110, yPosition);
                yPosition += 8;
                
                const monthlyPending = monthlyRevenue - monthlyPayments;
                doc.setTextColor(monthlyPending > 0 ? 244 : 76, monthlyPending > 0 ? 67 : 175, monthlyPending > 0 ? 54 : 80);
                doc.text(`Remaining / Ø¨Ø§Ù‚ÛŒ: ${monthlyPending.toLocaleString()} PKR`, 15, yPosition);
                
                yPosition += 25;
                
                // Customer Details
                if (activeCustomers.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(102, 126, 234);
                    doc.text('Customer Details / Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª:', 15, yPosition);
                    yPosition += 15;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    
                    // Table header
                    doc.setFillColor(102, 126, 234);
                    doc.rect(10, yPosition - 5, 190, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.text('Customer / Ú¯Ø§ÛÚ©', 15, yPosition + 3);
                    doc.text('Liters / Ù„ÛŒÙ¹Ø±', 80, yPosition + 3);
                    doc.text('Revenue / Ø¢Ù…Ø¯Ù†ÛŒ', 130, yPosition + 3);
                    yPosition += 15;
                    
                    doc.setTextColor(0, 0, 0);
                    
                    activeCustomers.forEach((customer, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        if (index % 2 === 0) {
                            doc.setFillColor(248, 249, 250);
                            doc.rect(10, yPosition - 3, 190, 10, 'F');
                        }
                        
                        doc.text(customer.name, 15, yPosition + 2);
                        doc.text(customer.liters.toFixed(1), 80, yPosition + 2);
                        doc.text(`${customer.revenue.toLocaleString()} PKR`, 130, yPosition + 2);
                        yPosition += 10;
                    });
                }
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 285, 210, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text(`Monthly Report | ${monthName} | Generated: ${new Date().toLocaleDateString('ur-PK')} | Page ${i}/${pageCount}`, 105, 292, { align: 'center' });
                }
                
                const fileName = `Monthly_Report_${currentWorkingMonth}_${monthName.replace(/\s/g, '_')}.pdf`;
                doc.save(fileName);
                
                showNotification('Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('Monthly PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function downloadBusinessReport() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                doc.setFont("helvetica");
                
                let yPosition = 20;
                
                // Header
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, 210, 45, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text('Business Report / Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹', 105, 18, { align: 'center' });
                doc.setFontSize(14);
                doc.text('Complete Business Analysis / Ù…Ú©Ù…Ù„ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ ØªØ¬Ø²ÛŒÛ', 105, 28, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Generated / ØªÛŒØ§Ø± Ú©Ø±Ø¯Û: ${new Date().toLocaleDateString('ur-PK')}`, 105, 38, { align: 'center' });
                
                yPosition = 55;
                doc.setTextColor(0, 0, 0);
                
                // Calculate business totals
                let totalRevenue = 0;
                let totalPayments = 0;
                let totalLiters = 0;
                let totalDays = 0;
                
                customers.forEach(customer => {
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                totalDays += days;
                                totalLiters += days * entry.liters;
                                totalRevenue += days * entry.liters * entry.rate;
                            }
                        });
                    }
                    
                    if (customer.payments) {
                        customer.payments.forEach(payment => {
                            totalPayments += parseFloat(payment.amount);
                        });
                    }
                });
                
                const totalPending = totalRevenue - totalPayments;
                
                // Business Summary
                doc.setFillColor(248, 249, 250);
                doc.rect(10, yPosition, 190, 55, 'F');
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(2);
                doc.rect(10, yPosition, 190, 55, 'S');
                
                yPosition += 12;
                doc.setFontSize(16);
                doc.setTextColor(102, 126, 234);
                doc.text('Business Summary / Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ', 15, yPosition);
                
                yPosition += 15;
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                doc.text(`Total Customers / Ú©Ù„ Ú¯Ø§ÛÚ©: ${customers.length}`, 15, yPosition);
                doc.text(`Total Days / Ú©Ù„ Ø¯Ù†: ${totalDays}`, 110, yPosition);
                yPosition += 8;
                
                doc.text(`Total Liters / Ú©Ù„ Ù„ÛŒÙ¹Ø±: ${totalLiters.toFixed(1)}`, 15, yPosition);
                doc.setTextColor(76, 175, 80);
                doc.text(`Total Revenue / Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ: ${totalRevenue.toLocaleString()} PKR`, 110, yPosition);
                yPosition += 8;
                
                doc.setTextColor(33, 150, 243);
                doc.text(`Total Received / Ú©Ù„ ÙˆØµÙˆÙ„ÛŒ: ${totalPayments.toLocaleString()} PKR`, 15, yPosition);
                doc.setTextColor(totalPending > 0 ? 244 : 76, totalPending > 0 ? 67 : 175, totalPending > 0 ? 54 : 80);
                doc.text(`Total Pending / Ú©Ù„ Ø¨Ø§Ù‚ÛŒ: ${totalPending.toLocaleString()} PKR`, 110, yPosition);
                
                yPosition += 20;
                
                // Customer wise breakdown
                doc.setFontSize(14);
                doc.setTextColor(102, 126, 234);
                doc.text('Customer Analysis / Ú¯Ø§ÛÚ©ÙˆÚº Ú©Ø§ ØªØ¬Ø²ÛŒÛ:', 15, yPosition);
                yPosition += 15;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                // Table header
                doc.setFillColor(102, 126, 234);
                doc.rect(10, yPosition - 5, 190, 12, 'F');
                doc.setTextColor(255, 255, 255);
                doc.text('Customer / Ú¯Ø§ÛÚ©', 15, yPosition + 3);
                doc.text('Liters', 70, yPosition + 3);
                doc.text('Revenue', 100, yPosition + 3);
                doc.text('Received', 130, yPosition + 3);
                doc.text('Pending', 165, yPosition + 3);
                yPosition += 15;
                
                doc.setTextColor(0, 0, 0);
                
                customers.forEach((customer, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    let customerRevenue = 0;
                    let customerPayments = 0;
                    let customerLiters = 0;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                customerLiters += days * entry.liters;
                                customerRevenue += days * entry.liters * entry.rate;
                            }
                        });
                    }
                    
                    if (customer.payments) {
                        customer.payments.forEach(payment => {
                            customerPayments += parseFloat(payment.amount);
                        });
                    }
                    
                    const customerPending = customerRevenue - customerPayments;
                    
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(10, yPosition - 3, 190, 10, 'F');
                    }
                    
                    doc.text(customer.name.substring(0, 15), 15, yPosition + 2);
                    doc.text(customerLiters.toFixed(1), 70, yPosition + 2);
                    doc.text(customerRevenue.toLocaleString(), 100, yPosition + 2);
                    doc.text(customerPayments.toLocaleString(), 130, yPosition + 2);
                    doc.setTextColor(customerPending > 0 ? 244 : 76, customerPending > 0 ? 67 : 175, customerPending > 0 ? 54 : 80);
                    doc.text(customerPending.toLocaleString(), 165, yPosition + 2);
                    doc.setTextColor(0, 0, 0);
                    yPosition += 10;
                });
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 285, 210, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text(`Business Report | Generated: ${new Date().toLocaleDateString('ur-PK')} | Page ${i}/${pageCount}`, 105, 292, { align: 'center' });
                }
                
                const fileName = `Business_Report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('Business PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function downloadCompleteReport() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                doc.setFont("helvetica");
                
                let yPosition = 20;
                
                // Header
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, 210, 45, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.text('Complete Report / Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹', 105, 18, { align: 'center' });
                doc.setFontSize(14);
                doc.text('Detailed Business Analysis / ØªÙØµÛŒÙ„ÛŒ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ ØªØ¬Ø²ÛŒÛ', 105, 28, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Generated / ØªÛŒØ§Ø± Ú©Ø±Ø¯Û: ${new Date().toLocaleDateString('ur-PK')} ${new Date().toLocaleTimeString('ur-PK')}`, 105, 38, { align: 'center' });
                
                yPosition = 55;
                doc.setTextColor(0, 0, 0);
                
                // Add each customer's complete details
                customers.forEach((customer, customerIndex) => {
                    if (customerIndex > 0) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Customer Header
                    doc.setFillColor(102, 126, 234);
                    doc.rect(10, yPosition - 5, 190, 15, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14);
                    doc.text(`Customer ${customerIndex + 1}: ${customer.name}`, 15, yPosition + 5);
                    
                    yPosition += 20;
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(10);
                    
                    // Customer Info
                    if (customer.phone) {
                        doc.text(`Phone / ÙÙˆÙ†: ${customer.phone}`, 15, yPosition);
                        yPosition += 6;
                    }
                    if (customer.address) {
                        doc.text(`Address / Ù¾ØªÛ: ${customer.address}`, 15, yPosition);
                        yPosition += 6;
                    }
                    
                    yPosition += 5;
                    
                    // Calculate customer totals
                    let customerRevenue = 0;
                    let customerPayments = 0;
                    let customerLiters = 0;
                    
                    // All entries
                    let allEntries = [...(customer.entries || []), ...(customer.payments || [])];
                    allEntries.sort((a, b) => {
                        const dateA = a.date || a.fromDate || '';
                        const dateB = b.date || b.fromDate || '';
                        return new Date(dateA) - new Date(dateB);
                    });
                    
                    // Entries header
                    doc.setFontSize(12);
                    doc.setTextColor(102, 126, 234);
                    doc.text('All Entries / ØªÙ…Ø§Ù… Ø§Ù†Ù¹Ø±ÛŒØ²:', 15, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    
                    allEntries.forEach(entry => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        if (entry.type === 'delivery') {
                            const days = calculateDays(entry.fromDate, entry.toDate);
                            const total = days * entry.liters * entry.rate;
                            customerRevenue += total;
                            customerLiters += days * entry.liters;
                            
                            doc.setFillColor(240, 248, 255);
                            doc.rect(10, yPosition - 2, 190, 18, 'F');
                            
                            doc.text(`Delivery: ${entry.fromDate} to ${entry.toDate} (${days} days)`, 15, yPosition + 3);
                            yPosition += 6;
                            doc.text(`${entry.liters}L/day Ã— ${days} days Ã— ${entry.rate} PKR = ${total.toLocaleString()} PKR`, 15, yPosition + 3);
                            yPosition += 10;
                            
                        } else if (entry.type === 'day-off') {
                            doc.setFillColor(255, 240, 240);
                            doc.rect(10, yPosition - 2, 190, 12, 'F');
                            
                            doc.text(`Day Off: ${entry.date} - ${entry.reason || 'No reason'}`, 15, yPosition + 3);
                            yPosition += 8;
                            
                        } else {
                            // Payment
                            const amount = parseFloat(entry.amount);
                            customerPayments += amount;
                            
                            doc.setFillColor(240, 255, 240);
                            doc.rect(10, yPosition - 2, 190, 15, 'F');
                            
                            doc.text(`Payment: ${entry.date} - ${amount.toLocaleString()} PKR (${entry.method || 'Cash'})`, 15, yPosition + 3);
                            if (entry.notes) {
                                yPosition += 5;
                                doc.text(`Notes: ${entry.notes}`, 15, yPosition + 3);
                            }
                            yPosition += 10;
                        }
                    });
                    
                    // Customer Summary
                    yPosition += 10;
                    const customerPending = customerRevenue - customerPayments;
                    
                    doc.setFillColor(248, 249, 250);
                    doc.rect(10, yPosition - 5, 190, 25, 'F');
                    doc.setDrawColor(102, 126, 234);
                    doc.rect(10, yPosition - 5, 190, 25, 'S');
                    
                    doc.setFontSize(10);
                    doc.setTextColor(102, 126, 234);
                    doc.text(`${customer.name} - Summary:`, 15, yPosition + 3);
                    yPosition += 8;
                    
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Total Liters: ${customerLiters.toFixed(1)} | Revenue: ${customerRevenue.toLocaleString()} PKR`, 15, yPosition + 3);
                    yPosition += 6;
                    doc.text(`Payments: ${customerPayments.toLocaleString()} PKR | Pending: ${customerPending.toLocaleString()} PKR`, 15, yPosition + 3);
                });
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 285, 210, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text(`Complete Report | Generated: ${new Date().toLocaleDateString('ur-PK')} | Page ${i}/${pageCount}`, 105, 292, { align: 'center' });
                }
                
                const fileName = `Complete_Report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showNotification('Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('Complete PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function downloadAllCustomersReport() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                doc.setFont("helvetica");
                
                let yPosition = 20;
                
                // Header
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, 297, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(18);
                doc.text('All Customers Report / ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹', 148, 18, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Generated / ØªÛŒØ§Ø± Ú©Ø±Ø¯Û: ${new Date().toLocaleDateString('ur-PK')} ${new Date().toLocaleTimeString('ur-PK')}`, 148, 30, { align: 'center' });
                
                yPosition = 50;
                doc.setTextColor(0, 0, 0);
                
                // Table header
                doc.setFillColor(102, 126, 234);
                doc.rect(10, yPosition - 5, 277, 12, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.text('Customer / Ú¯Ø§ÛÚ©', 15, yPosition + 3);
                doc.text('Phone / ÙÙˆÙ†', 80, yPosition + 3);
                doc.text('Total Liters', 130, yPosition + 3);
                doc.text('Total Revenue', 170, yPosition + 3);
                doc.text('Total Received', 220, yPosition + 3);
                doc.text('Pending / Ø¨Ø§Ù‚ÛŒ', 260, yPosition + 3);
                yPosition += 15;
                
                doc.setTextColor(0, 0, 0);
                
                let grandTotalRevenue = 0;
                let grandTotalReceived = 0;
                let grandTotalLiters = 0;
                
                customers.forEach((customer, index) => {
                    if (yPosition > 190) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    let customerRevenue = 0;
                    let customerPayments = 0;
                    let customerLiters = 0;
                    
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            if (entry.type === 'delivery') {
                                const days = calculateDays(entry.fromDate, entry.toDate);
                                customerLiters += days * entry.liters;
                                customerRevenue += days * entry.liters * entry.rate;
                            }
                        });
                    }
                    
                    if (customer.payments) {
                        customer.payments.forEach(payment => {
                            customerPayments += parseFloat(payment.amount);
                        });
                    }
                    
                    const customerPending = customerRevenue - customerPayments;
                    
                    grandTotalRevenue += customerRevenue;
                    grandTotalReceived += customerPayments;
                    grandTotalLiters += customerLiters;
                    
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(10, yPosition - 3, 277, 10, 'F');
                    }
                    
                    doc.setFontSize(9);
                    doc.text(customer.name.substring(0, 20), 15, yPosition + 2);
                    doc.text(customer.phone || '-', 80, yPosition + 2);
                    doc.text(customerLiters.toFixed(1), 130, yPosition + 2);
                    doc.text(customerRevenue.toLocaleString(), 170, yPosition + 2);
                    doc.text(customerPayments.toLocaleString(), 220, yPosition + 2);
                    doc.setTextColor(customerPending > 0 ? 244 : 76, customerPending > 0 ? 67 : 175, customerPending > 0 ? 54 : 80);
                    doc.text(customerPending.toLocaleString(), 260, yPosition + 2);
                    doc.setTextColor(0, 0, 0);
                    yPosition += 10;
                });
                
                // Grand Total
                yPosition += 10;
                doc.setFillColor(102, 126, 234);
                doc.rect(10, yPosition - 5, 277, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.text('TOTAL / Ú©Ù„', 15, yPosition + 3);
                doc.text(grandTotalLiters.toFixed(1), 130, yPosition + 3);
                doc.text(grandTotalRevenue.toLocaleString(), 170, yPosition + 3);
                doc.text(grandTotalReceived.toLocaleString(), 220, yPosition + 3);
                doc.text((grandTotalRevenue - grandTotalReceived).toLocaleString(), 260, yPosition + 3);
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 200, 297, 10, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text(`All Customers Report | Generated: ${new Date().toLocaleDateString('ur-PK')} | Page ${i}/${pageCount}`, 148, 206, { align: 'center' });
                }
                
                const fileName = `All_Customers_Report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showNotification('ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                
            } catch (error) {
                console.error('All customers PDF generation error:', error);
                showNotification('PDF Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function generateCustomerPDF(customerId = null) {
            const targetCustomerId = customerId || currentCustomerId;
            if (!targetCustomerId) return;
            
            const customer = customers.find(c => c.id === targetCustomerId);
            if (!customer) return;
            
            downloadCustomerLedger();
        }

        // =================== EDIT/DELETE FUNCTIONS ===================
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // Fill form with customer data
            document.getElementById('customer-name').value = customer.name;
            document.getElementById('customer-phone').value = customer.phone || '';
            document.getElementById('customer-address').value = customer.address || '';
            document.getElementById('customer-rate').value = customer.rate || 200;
            
            // Switch to add customer section
            showSection('add-customer');
            
            // Change form behavior to update
            const form = document.getElementById('customer-form');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateCustomer(customerId);
            };
            
            // Update button text
            const submitBtn = form.querySelector('.submit-btn');
            submitBtn.textContent = 'Ú¯Ø§ÛÚ© Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
        }

        function updateCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            customer.name = document.getElementById('customer-name').value.trim();
            customer.phone = document.getElementById('customer-phone').value.trim();
            customer.address = document.getElementById('customer-address').value.trim();
            customer.rate = parseFloat(document.getElementById('customer-rate').value) || 200;
            
            saveToStorage();
            
            // Reset form
            document.getElementById('customer-form').reset();
            document.getElementById('customer-rate').value = 200;
            
            // Reset form behavior
            const form = document.getElementById('customer-form');
            form.onsubmit = function(e) {
                e.preventDefault();
                addCustomer();
            };
            
            const submitBtn = form.querySelector('.submit-btn');
            submitBtn.textContent = 'Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            
            showNotification('Ú¯Ø§ÛÚ© Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒÚº!', 'success');
            showSection('customers');
        }

        function deleteCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            if (confirm(`Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ "${customer.name}" Ú©Ùˆ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªØ§Û”`)) {
                customers = customers.filter(c => c.id !== customerId);
                saveToStorage();
                loadCustomers();
                updateDashboard();
                showNotification('Ú¯Ø§ÛÚ© ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§!', 'success');
            }
        }

        function editEntry(entryId) {
            if (!currentCustomerId) return;
            
            const customer = customers.find(c => c.id === currentCustomerId);
            const entry = customer?.entries?.find(e => e.id === entryId);
            
            if (!entry || entry.type !== 'delivery') return;
            
            currentEditEntryId = entryId;
            
            // Fill form with entry data
            document.getElementById('entry-from-date').value = entry.fromDate;
            document.getElementById('entry-to-date').value = entry.toDate;
            document.getElementById('entry-liters').value = entry.liters;
            document.getElementById('entry-rate').value = entry.rate;
            
            // Update modal title and button
            const modal = document.getElementById('add-entry-modal');
            const title = modal.querySelector('.section-title');
            const button = modal.querySelector('.submit-btn');
            
            title.textContent = 'Ø§Ù†Ù¹Ø±ÛŒ Ù…ÛŒÚº ØªØ±Ù…ÛŒÙ…';
            button.textContent = 'Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            
            modal.classList.add('show');
        }

        function deleteEntry(entryId) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø§Ù†Ù¹Ø±ÛŒ Ú©Ùˆ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                const customer = customers.find(c => c.id === currentCustomerId);
                if (customer && customer.entries) {
                    customer.entries = customer.entries.filter(e => e.id !== entryId);
                    saveToStorage();
                    loadLedgerEntries(currentCustomerId);
                    showNotification('Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
                }
            }
        }

        function deleteDayOff(entryId) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ú†Ú¾Ù¹ÛŒ Ú©Ùˆ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                const customer = customers.find(c => c.id === currentCustomerId);
                if (customer && customer.entries) {
                    customer.entries = customer.entries.filter(e => e.id !== entryId);
                    saveToStorage();
                    loadLedgerEntries(currentCustomerId);
                    showNotification('Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù† ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                }
            }
        }

        function deletePayment(paymentId) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ùˆ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                const customer = customers.find(c => c.id === currentCustomerId);
                if (customer && customer.payments) {
                    customer.payments = customer.payments.filter(p => p.id !== paymentId);
                    saveToStorage();
                    loadLedgerEntries(currentCustomerId);
                    showNotification('Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
                }
            }
        }

        // =================== DATA IMPORT/EXPORT ===================
        function exportData() {
            const data = {
                customers: customers,
                nextId: nextId,
                currentWorkingMonth: currentWorkingMonth,
                exportDate: new Date().toISOString(),
                version: '4.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `milk_business_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ÚˆÛŒÙ¹Ø§ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ù…Ú©Ù…Ù„!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.customers) {
                        if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ù†Ø¦Û’ ÚˆÛŒÙ¹Ø§ Ø³Û’ Ø¨Ø¯Ù„Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                            customers = data.customers;
                            nextId = data.nextId || 1;
                            currentWorkingMonth = data.currentWorkingMonth || new Date().toISOString().slice(0, 7);
                            
                            saveToStorage();
                            updateDashboard();
                            setupMonthSelectors();
                            updateWorkingMonthDisplay();
                            
                            showNotification('ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù…Ù¾ÙˆØ±Ù¹ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                        }
                    } else {
                        showNotification('ØºÙ„Ø· ÙØ§Ø¦Ù„ ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification('ÙØ§Ø¦Ù„ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // =================== KEYBOARD SHORTCUTS ===================
        document.addEventListener('keydown', function(e) {
            // Close modal with Escape key
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                modals.forEach(modal => modal.classList.remove('show'));
            }
            
            // Quick navigation with Ctrl+Number
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showSection('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showSection('customers');
                        break;
                    case '3':
                        e.preventDefault();
                        showSection('add-customer');
                        break;
                    case '4':
                        e.preventDefault();
                        showSection('reports');
                        break;
                    case '5':
                        e.preventDefault();
                        showSection('settings');
                        break;
                }
            }
        });

        // =================== CLICK OUTSIDE TO CLOSE MODALS ===================
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // =================== INITIALIZATION ON LOAD ===================
        window.addEventListener('beforeunload', function() {
            // Save data before page unload
            saveToStorage();
        });

        // Auto-save every 30 seconds
        setInterval(saveToStorage, 30000);

        console.log('Enhanced Milk Business App Loaded Successfully! ğŸ¥›');
        console.log('Version: 4.0 - Complete with Auto GitHub Backup & Urdu PDFs');
    </script>
</body>
</html>
