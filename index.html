<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Complete Online Business Solution</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 14px;
            font-weight: 500;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.18);
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .hidden {
            display: none !important;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .dashboard-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            direction: rtl;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-info {
            background: #17a2b8;
        }

        /* Customer List */
        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .customer-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .customer-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .customer-card h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .customer-card p {
            color: #666;
            margin-bottom: 4px;
        }

        .payment-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-paid {
            background: linear-gradient(135deg, #d4edda 0%, #c8e6c9 100%);
            color: #155724;
        }

        .status-pending {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            color: #856404;
        }

        .status-overdue {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* Ledger Styles */
        .ledger-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .entries-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .entries-table th,
        .entries-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .entries-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            color: #333;
        }

        .entries-table tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .bill-summary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .bill-summary h3 {
            margin-bottom: 15px;
        }

        .bill-summary .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .bill-summary .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .bill-summary .summary-item .label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .bill-summary .summary-item .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        /* Payment Status Section */
        .payment-status-section {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .payment-status-section h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .payment-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .payment-item .label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .payment-item .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .action-btn {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .edit-btn {
            color: #007bff;
            background: rgba(0,123,255,0.1);
        }

        .delete-btn {
            color: #dc3545;
            background: rgba(220,53,69,0.1);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-controls label {
            font-weight: 500;
        }

        .filter-controls select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            direction: rtl;
        }

        /* PDF Preview Styles */
        .pdf-preview {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            font-family: 'Arial', sans-serif;
            direction: rtl;
            border: 2px solid #e0e0e0;
        }

        .pdf-header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: -30px -30px 30px -30px;
            position: relative;
            overflow: hidden;
        }

        .pdf-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .pdf-header h1 {
            color: white;
            font-size: 36px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .pdf-header p {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
            position: relative;
            z-index: 1;
        }

        .pdf-customer-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-right: 6px solid #2196f3;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.2);
        }

        .pdf-customer-info h3 {
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pdf-customer-info h3::before {
            content: 'ğŸ‘¤';
            font-size: 24px;
        }

        .pdf-payment-info {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-right: 6px solid #ff9800;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);
        }

        .pdf-payment-info h3 {
            color: #f57c00;
            margin-bottom: 15px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pdf-payment-info h3::before {
            content: 'ğŸ’³';
            font-size: 24px;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .pdf-table th,
        .pdf-table td {
            padding: 18px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            font-size: 16px;
        }

        .pdf-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .pdf-table tr:nth-child(even) {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .pdf-table tr:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .pdf-summary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 25px;
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
        }

        .pdf-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="summaryGrain" width="50" height="50" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="40" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23summaryGrain)"/></svg>');
            opacity: 0.2;
        }

        .pdf-summary h3 {
            margin-bottom: 25px;
            font-size: 28px;
            position: relative;
            z-index: 1;
        }

        .pdf-summary .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .pdf-summary .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pdf-summary .summary-item .value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .pdf-summary .summary-item .label {
            font-size: 16px;
            opacity: 0.9;
        }

        .pdf-footer {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            border-top: 3px solid #667eea;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pdf-footer h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .pdf-footer p {
            color: #666;
            margin-bottom: 8px;
        }

        /* WhatsApp Button Styles */
        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover {
            background: linear-gradient(135deg, #128C7E 0%, #075e54 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-icon::before {
            content: "ğŸ“±";
            font-size: 20px;
        }

        /* Alert/Notification Styles */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 350px;
            backdrop-filter: blur(10px);
        }

        .alert.show {
            transform: translateX(0);
        }

        .alert.error {
            background: #dc3545;
        }

        .alert.warning {
            background: #ffc107;
            color: #333;
        }

        .alert.info {
            background: #17a2b8;
        }

        /* Payment Summary in Ledger */
        .payment-summary-info {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-right: 5px solid #4caf50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }

        .payment-summary-info h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .payment-summary-info p {
            margin-bottom: 8px;
            color: #2e7d32;
            font-size: 16px;
        }

        /* Payment History Styles */
        .payment-history-item {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-right: 5px solid #4caf50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
            transition: transform 0.3s ease;
        }

        .payment-history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        /* GitHub Backup Styles */
        .backup-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .backup-section h3 {
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .nav-buttons {
                gap: 5px;
            }

            .nav-btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .customers-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
                width: 98%;
            }

            .entries-table {
                font-size: 14px;
            }

            .entries-table th,
            .entries-table td {
                padding: 8px 4px;
            }

            .bill-summary .summary-grid {
                grid-template-columns: 1fr;
            }

            .payment-grid {
                grid-template-columns: 1fr;
            }

            .pdf-preview {
                padding: 15px;
            }

            .pdf-header {
                margin: -15px -15px 20px -15px;
                padding: 20px;
            }

            .pdf-header h1 {
                font-size: 24px;
            }

            .pdf-summary .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
            <p>Ù…Ú©Ù…Ù„ Ø¢Ù† Ù„Ø§Ø¦Ù† Ø¨Ø²Ù†Ø³ Ø³Ù„ÙˆØ´Ù† - Ù¾ÛŒÙ…Ù†Ù¹ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ø§ÙˆØ± GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ú©Û’ Ø³Ø§ØªÚ¾</p>
        </div>

        <!-- Navigation -->
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('dashboard')">ğŸ“Š ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</button>
            <button class="nav-btn" onclick="showSection('customers')">ğŸ‘¥ Ú¯Ø§ÛÚ©</button>
            <button class="nav-btn" onclick="showSection('payments')">ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹Ø³</button>
            <button class="nav-btn" onclick="showSection('reports')">ğŸ“ˆ Ø±Ù¾ÙˆØ±Ù¹Ø³</button>
            <button class="nav-btn" onclick="showSection('backup')">â˜ï¸ Ø¨ÛŒÚ© Ø§Ù¾</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <h2 class="section-title">ğŸ“Š ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Ú©Ù„ Ú¯Ø§ÛÚ©</h3>
                    <div class="number" id="total-customers">0</div>
                </div>
                <div class="dashboard-card">
                    <h3>Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©Ù„ Ø¯ÙˆØ¯Ú¾</h3>
                    <div class="number" id="total-milk">0</div>
                    <small>Ù„ÛŒÙ¹Ø±</small>
                </div>
                <div class="dashboard-card">
                    <h3>Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ</h3>
                    <div class="number" id="total-revenue">0</div>
                    <small>Ø±ÙˆÙ¾Û’</small>
                </div>
                <div class="dashboard-card">
                    <h3>Ø¨Ù‚Ø§ÛŒØ§ Ø±Ù‚Ù…</h3>
                    <div class="number" id="pending-amount">0</div>
                    <small>Ø±ÙˆÙ¾Û’</small>
                </div>
            </div>
        </div>

        <!-- Customers Section -->
        <div id="customers-section" class="section hidden">
            <h2 class="section-title">ğŸ‘¥ Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ ÙÛØ±Ø³Øª</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" onclick="openAddCustomerModal()">â• Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
            </div>
            <div id="customers-list" class="customers-grid">
                <!-- Customers will be loaded here -->
            </div>
        </div>

        <!-- Payments Section -->
        <div id="payments-section" class="section hidden">
            <h2 class="section-title">ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹Ø³ Ú©Ø§ Ø¬Ø§Ø¦Ø²Û</h2>
            <div class="filter-controls">
                <label>Ù…ÛÛŒÙ†Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                <select id="payments-month-filter" onchange="loadPaymentsOverview()">
                    <option value="all">ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’</option>
                    <option value="2025-01">Ø¬Ù†ÙˆØ±ÛŒ 2025</option>
                    <option value="2025-02">ÙØ±ÙˆØ±ÛŒ 2025</option>
                    <option value="2025-03">Ù…Ø§Ø±Ú† 2025</option>
                    <option value="2025-04">Ø§Ù¾Ø±ÛŒÙ„ 2025</option>
                    <option value="2025-05">Ù…Ø¦ÛŒ 2025</option>
                    <option value="2025-06">Ø¬ÙˆÙ† 2025</option>
                    <option value="2025-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025</option>
                    <option value="2025-08">Ø§Ú¯Ø³Øª 2025</option>
                    <option value="2025-09">Ø³ØªÙ…Ø¨Ø± 2025</option>
                    <option value="2025-10">Ø§Ú©ØªÙˆØ¨Ø± 2025</option>
                    <option value="2025-11">Ù†ÙˆÙ…Ø¨Ø± 2025</option>
                    <option value="2025-12">Ø¯Ø³Ù…Ø¨Ø± 2025</option>
                </select>
            </div>
            <div id="payments-overview">
                <!-- Payment overview will be loaded here -->
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="section hidden">
            <h2 class="section-title">ğŸ“ˆ Ø±Ù¾ÙˆØ±Ù¹Ø³</h2>
            <div style="text-align: center;">
                <button class="btn" onclick="generateMonthlyReport()">ğŸ“… Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹</button>
                <button class="btn btn-secondary" onclick="generateCustomerReport()">ğŸ‘¥ Ú¯Ø§ÛÚ© ÙˆØ§Ø± Ø±Ù¾ÙˆØ±Ù¹</button>
                <button class="btn btn-info" onclick="generatePaymentReport()">ğŸ’³ Ù¾ÛŒÙ…Ù†Ù¹ Ø±Ù¾ÙˆØ±Ù¹</button>
            </div>
        </div>

        <!-- Backup Section -->
        <div id="backup-section" class="section hidden">
            <h2 class="section-title">â˜ï¸ ÚˆÛŒÙ¹Ø§ Ø¨ÛŒÚ© Ø§Ù¾ Ø§ÙˆØ± Ø¨Ø­Ø§Ù„ÛŒ</h2>
            
            <!-- Local Backup -->
            <div class="backup-section">
                <h3 style="color: #4CAF50;">ğŸ’¾ Ù…Ù‚Ø§Ù…ÛŒ Ø¨ÛŒÚ© Ø§Ù¾</h3>
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="exportData()">ğŸ“¤ ÚˆÛŒÙ¹Ø§ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹</button>
                    <button class="btn btn-warning" onclick="importData()">ğŸ“¥ ÚˆÛŒÙ¹Ø§ Ø§Ù…Ù¾ÙˆØ±Ù¹</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                </div>
            </div>

            <!-- GitHub Backup -->
            <div class="backup-section">
                <h3 style="color: #2196F3;">ğŸ™ GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ø³Ø³Ù¹Ù…</h3>
                <div class="form-group">
                    <label>GitHub Personal Access Token:</label>
                    <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <small style="display: block; margin-top: 5px; color: #666;">
                        GitHub Settings > Developer settings > Personal access tokens Ø³Û’ Ù¹ÙˆÚ©Ù† Ø¨Ù†Ø§Ø¦ÛŒÚº
                    </small>
                </div>
                <div class="form-group">
                    <label>Repository Name:</label>
                    <input type="text" id="github-repo" placeholder="milk-business-backup" value="milk-business-backup">
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-success" onclick="setupGitHubBackup()">ğŸ”§ GitHub Ø³ÛŒÙ¹ Ø§Ù¾</button>
                    <button class="btn btn-info" onclick="backupToGitHub()">â˜ï¸ ÙÙˆØ±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾</button>
                    <button class="btn btn-warning" onclick="restoreFromGitHub()">â¬‡ï¸ Ø¨Ø­Ø§Ù„ÛŒ</button>
                    <button class="btn" onclick="testGitHubConnection()" style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">ğŸ”— Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹</button>
                </div>
            </div>

            <!-- Backup Statistics -->
            <div class="backup-section">
                <h3 style="color: #FF9800;">ğŸ“Š Ø¨ÛŒÚ© Ø§Ù¾ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="last-backup-time">Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº</div>
                        <div>Ø¢Ø®Ø±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="backup-size">0 KB</div>
                        <div>ÚˆÛŒÙ¹Ø§ Ø³Ø§Ø¦Ø²</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="github-status">âŒ</div>
                        <div>GitHub Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="backup-status">Ø¢Ù…Ø§Ø¯Û</div>
                        <div>Ø³Ø³Ù¹Ù… Ú©ÛŒ Ø­Ø§Ù„Øª</div>
                    </div>
                </div>
            </div>

            <!-- Auto Backup Settings -->
            <div class="backup-section">
                <h3 style="color: #607D8B;">âš™ï¸ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾ ØªØ±ØªÛŒØ¨Ø§Øª</h3>
                <div class="form-group">
                    <label>Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾:</label>
                    <select id="auto-backup-frequency" onchange="updateAutoBackupSettings()">
                        <option value="0">Ø¨Ù†Ø¯</option>
                        <option value="5">ÛØ± 5 Ù…Ù†Ù¹</option>
                        <option value="15">ÛØ± 15 Ù…Ù†Ù¹</option>
                        <option value="30">ÛØ± 30 Ù…Ù†Ù¹</option>
                        <option value="60">ÛØ± Ú¯Ú¾Ù†Ù¹Û’</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Ledger Section -->
        <div id="ledger-section" class="section hidden">
            <div class="ledger-header">
                <h2 id="ledger-customer-name">Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù…</h2>
                <p id="ledger-customer-phone">ÙÙˆÙ† Ù†Ù…Ø¨Ø±</p>
                <button class="btn btn-secondary" onclick="showSection('customers')" style="margin-top: 10px;">â¬…ï¸ ÙˆØ§Ù¾Ø³</button>
            </div>

            <!-- Filter Controls -->
            <div class="filter-controls">
                <label>Ù…ÛÛŒÙ†Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                <select id="month-filter" onchange="filterByMonth()">
                    <option value="all">ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’</option>
                    <option value="2025-01">Ø¬Ù†ÙˆØ±ÛŒ 2025</option>
                    <option value="2025-02">ÙØ±ÙˆØ±ÛŒ 2025</option>
                    <option value="2025-03">Ù…Ø§Ø±Ú† 2025</option>
                    <option value="2025-04">Ø§Ù¾Ø±ÛŒÙ„ 2025</option>
                    <option value="2025-05">Ù…Ø¦ÛŒ 2025</option>
                    <option value="2025-06">Ø¬ÙˆÙ† 2025</option>
                    <option value="2025-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025</option>
                    <option value="2025-08">Ø§Ú¯Ø³Øª 2025</option>
                    <option value="2025-09">Ø³ØªÙ…Ø¨Ø± 2025</option>
                    <option value="2025-10">Ø§Ú©ØªÙˆØ¨Ø± 2025</option>
                    <option value="2025-11">Ù†ÙˆÙ…Ø¨Ø± 2025</option>
                    <option value="2025-12">Ø¯Ø³Ù…Ø¨Ø± 2025</option>
                </select>
                <button class="btn" onclick="openAddEntryModal()">â• Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ</button>
                <button class="btn btn-warning" onclick="openPaymentModal()">ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹ Ù„ÛŒÚº</button>
                <button class="btn btn-success" onclick="generateBill()">ğŸ“„ Ø¨Ù„ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
            </div>

            <!-- Payment Status Section -->
            <div class="payment-status-section" id="payment-status-section">
                <h3>ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒ ØµÙˆØ±ØªØ­Ø§Ù„ - <span id="payment-month-name">Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÛŒ</span></h3>
                <div class="payment-grid">
                    <div class="payment-item">
                        <div class="label">Ú©Ù„ Ø¨Ù„</div>
                        <div class="value" id="month-total-amount">0</div>
                        <small>Ø±ÙˆÙ¾Û’</small>
                    </div>
                    <div class="payment-item">
                        <div class="label">Ø§Ø¯Ø§ Ø´Ø¯Û</div>
                        <div class="value" id="month-paid-amount">0</div>
                        <small>Ø±ÙˆÙ¾Û’</small>
                    </div>
                    <div class="payment-item">
                        <div class="label">Ø¨Ø§Ù‚ÛŒ</div>
                        <div class="value" id="month-remaining-amount">0</div>
                        <small>Ø±ÙˆÙ¾Û’</small>
                    </div>
                    <div class="payment-item">
                        <div class="label">ÙÛŒØµØ¯</div>
                        <div class="value" id="payment-percentage">0%</div>
                        <small>Ù…Ú©Ù…Ù„</small>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-warning" id="pay-remaining-btn" onclick="openPaymentModal()">ğŸ’° Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù… Ø§Ø¯Ø§ Ú©Ø±ÛŒÚº</button>
                </div>
            </div>

            <!-- Bill Summary -->
            <div class="bill-summary" id="bill-summary">
                <h3>ğŸ§¾ Ø¨Ù„ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="label">Ú©Ù„ Ø¯ÙˆØ¯Ú¾</div>
                        <div class="value" id="summary-total-liters">0</div>
                        <small>Ù„ÛŒÙ¹Ø±</small>
                    </div>
                    <div class="summary-item">
                        <div class="label">Ú©Ù„ Ø¯Ù†</div>
                        <div class="value" id="summary-total-days">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Ú©Ù„ Ø±Ù‚Ù…</div>
                        <div class="value" id="summary-total-amount">0</div>
                        <small>Ø±ÙˆÙ¾Û’</small>
                    </div>
                </div>
            </div>

            <!-- Entries Table -->
            <table class="entries-table" id="entries-table">
                <thead>
                    <tr>
                        <th>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</th>
                        <th>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ®</th>
                        <th>Ø¯ÙˆØ¯Ú¾ (Ù„ÛŒÙ¹Ø±)</th>
                        <th>Ø±ÛŒÙ¹ (ÙÛŒ Ù„ÛŒÙ¹Ø±)</th>
                        <th>Ú©Ù„ Ø±Ù‚Ù…</th>
                        <th>Ø¹Ù…Ù„</th>
                    </tr>
                </thead>
                <tbody id="entries-tbody">
                    <!-- Entries will be loaded here -->
                </tbody>
            </table>

            <!-- Payment History -->
            <div id="payment-history-section" style="margin-top: 30px;">
                <h3 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ’³ Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</h3>
                <div id="payment-history-list">
                    <!-- Payment history will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h2 class="section-title">â• Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
            <form onsubmit="addCustomer(event)">
                <div class="form-group">
                    <label>Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù… *</label>
                    <input type="text" id="customer-name" required>
                </div>
                <div class="form-group">
                    <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø±</label>
                    <input type="tel" id="customer-phone">
                </div>
                <div class="form-group">
                    <label>Ù¾ØªÛ</label>
                    <textarea id="customer-address" rows="3"></textarea>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Ù…Ù†Ø³ÙˆØ®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Entry Modal -->
    <div id="add-entry-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h2 class="section-title" id="entry-modal-title">â• Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h2>
            <form onsubmit="submitEntry(event)">
                <div class="form-group">
                    <label>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="entry-from-date" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="entry-to-date" required>
                </div>
                <div class="form-group">
                    <label>Ø¯ÙˆØ¯Ú¾ (Ù„ÛŒÙ¹Ø±) *</label>
                    <input type="number" id="entry-liters" step="0.1" min="0" required>
                </div>
                <div class="form-group">
                    <label>Ø±ÛŒÙ¹ (ÙÛŒ Ù„ÛŒÙ¹Ø±) *</label>
                    <input type="number" id="entry-rate" step="1" min="0" required>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" id="entry-submit-btn">Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Ù…Ù†Ø³ÙˆØ®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h2 class="section-title">ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹ Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø±ÛŒÚº</h2>
            <form onsubmit="addPayment(event)">
                <div class="form-group">
                    <label>Ù…ÛÛŒÙ†Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
                    <select id="payment-month" onchange="updatePaymentSummary()" required>
                        <option value="">Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>
                        <option value="2025-01">Ø¬Ù†ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-02">ÙØ±ÙˆØ±ÛŒ 2025</option>
                        <option value="2025-03">Ù…Ø§Ø±Ú† 2025</option>
                        <option value="2025-04">Ø§Ù¾Ø±ÛŒÙ„ 2025</option>
                        <option value="2025-05">Ù…Ø¦ÛŒ 2025</option>
                        <option value="2025-06">Ø¬ÙˆÙ† 2025</option>
                        <option value="2025-07">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025</option>
                        <option value="2025-08">Ø§Ú¯Ø³Øª 2025</option>
                        <option value="2025-09">Ø³ØªÙ…Ø¨Ø± 2025</option>
                        <option value="2025-10">Ø§Ú©ØªÙˆØ¨Ø± 2025</option>
                        <option value="2025-11">Ù†ÙˆÙ…Ø¨Ø± 2025</option>
                        <option value="2025-12">Ø¯Ø³Ù…Ø¨Ø± 2025</option>
                    </select>
                </div>
                <div id="payment-summary-info" class="payment-summary-info" style="display: none;">
                    <h4>ğŸ“Š Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h4>
                    <p><strong>ğŸ’° Ú©Ù„ Ø¨Ù„:</strong> <span id="bill-total-info">0</span> Ø±ÙˆÙ¾Û’</p>
                    <p><strong>âœ… Ù¾ÛÙ„Û’ Ø³Û’ Ø§Ø¯Ø§:</strong> <span id="already-paid-info">0</span> Ø±ÙˆÙ¾Û’</p>
                    <p><strong>â— Ø¨Ø§Ù‚ÛŒ:</strong> <span id="remaining-info">0</span> Ø±ÙˆÙ¾Û’</p>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… *</label>
                    <input type="number" id="payment-amount" step="1" min="0" required>
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® *</label>
                    <input type="date" id="payment-date" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û:</label>
                    <select id="payment-method">
                        <option value="cash">ğŸ’µ Ù†Ù‚Ø¯</option>
                        <option value="bank">ğŸ¦ Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±</option>
                        <option value="check">ğŸ“ Ú†ÛŒÚ©</option>
                        <option value="mobile">ğŸ“± Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾ÛŒÙ…Ù†Ù¹</option>
                        <option value="other">ğŸ”„ Ø¯ÛŒÚ¯Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆÙ¹Ø³:</label>
                    <textarea id="payment-notes" rows="3" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ ØªØ¨ØµØ±Û..."></textarea>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn btn-warning">ğŸ’° Ù¾ÛŒÙ…Ù†Ù¹ Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø±ÛŒÚº</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Ù…Ù†Ø³ÙˆØ®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdf-preview-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h2 class="section-title">ğŸ“„ Ø¨Ù„ Ú©Ø§ Ù¾ÛŒØ´ Ù…Ù†Ø¸Ø±</h2>
            
            <div id="pdf-preview-content" class="pdf-preview">
                <!-- PDF content will be generated here -->
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px;">
                <button class="btn" onclick="downloadPDF()" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);">ğŸ“¥ PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</button>
                <button class="whatsapp-btn" onclick="shareViaWhatsApp()">
                    <span class="whatsapp-icon"></span>
                    ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ù¾Ø± Ø´ÛŒØ¦Ø± Ú©Ø±ÛŒÚº
                </button>
                <button class="btn btn-secondary" onclick="closeModal()">âŒ Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let customers = [];
        let nextId = 1;
        let currentCustomerId = null;
        let currentEditEntryId = null;
        let currentBillData = null;
        let gitHubSettings = { token: '', repo: 'milk-business-backup', username: '' };
        let autoBackupInterval = null;

        // Month names in Urdu
        const monthNames = {
            '2025-01': 'Ø¬Ù†ÙˆØ±ÛŒ 2025',
            '2025-02': 'ÙØ±ÙˆØ±ÛŒ 2025',
            '2025-03': 'Ù…Ø§Ø±Ú† 2025',
            '2025-04': 'Ø§Ù¾Ø±ÛŒÙ„ 2025',
            '2025-05': 'Ù…Ø¦ÛŒ 2025',
            '2025-06': 'Ø¬ÙˆÙ† 2025',
            '2025-07': 'Ø¬ÙˆÙ„Ø§Ø¦ÛŒ 2025',
            '2025-08': 'Ø§Ú¯Ø³Øª 2025',
            '2025-09': 'Ø³ØªÙ…Ø¨Ø± 2025',
            '2025-10': 'Ø§Ú©ØªÙˆØ¨Ø± 2025',
            '2025-11': 'Ù†ÙˆÙ…Ø¨Ø± 2025',
            '2025-12': 'Ø¯Ø³Ù…Ø¨Ø± 2025'
        };

        // Payment method names in Urdu
        const paymentMethodNames = {
            'cash': 'ğŸ’µ Ù†Ù‚Ø¯',
            'bank': 'ğŸ¦ Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±',
            'check': 'ğŸ“ Ú†ÛŒÚ©',
            'mobile': 'ğŸ“± Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾ÛŒÙ…Ù†Ù¹',
            'other': 'ğŸ”„ Ø¯ÛŒÚ¯Ø±'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Enhanced Milk Business App initializing...');
            
            try {
                loadFromStorage();
                loadCustomers();
                updateDashboard();
                showSection('dashboard');
                
                // Set today's date as default for payment
                const today = new Date().toISOString().split('T')[0];
                const paymentDateInput = document.getElementById('payment-date');
                if (paymentDateInput) {
                    paymentDateInput.value = today;
                }
                
                // Update GitHub UI
                updateGitHubUI();
                updateBackupStats();
                
                console.log('âœ… App initialized successfully!');
                showAlert('ğŸš€ Enhanced Milk Business App Ø¢Ù…Ø§Ø¯Û!');
            } catch (error) {
                console.error('âŒ Error during initialization:', error);
                showAlert('Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        });

        // Navigation Functions
        function showSection(sectionName) {
            try {
                // Remove active class from all nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show selected section
                const targetSection = document.getElementById(sectionName + '-section');
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    
                    // Add active class to clicked nav button
                    if (event && event.target && event.target.classList && event.target.classList.contains('nav-btn')) {
                        event.target.classList.add('active');
                    }
                    
                    // Load section-specific data
                    if (sectionName === 'dashboard') {
                        updateDashboard();
                    } else if (sectionName === 'payments') {
                        loadPaymentsOverview();
                    }
                } else {
                    console.error('Section not found:', sectionName + '-section');
                }
            } catch (error) {
                console.error('Error in showSection:', error);
                showAlert('Ø³ÛŒÚ©Ø´Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        // Storage Functions
        function saveToStorage() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    gitHubSettings: gitHubSettings,
                    lastBackup: new Date().toISOString(),
                    version: '5.0'
                };
                
                localStorage.setItem('milkBusinessData', JSON.stringify(data));
                console.log('âœ… Data saved to storage');
                
                // Update backup status
                updateBackupStats();
            } catch (error) {
                console.error('âŒ Error saving data:', error);
                showAlert('ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function loadFromStorage() {
            try {
                const data = localStorage.getItem('milkBusinessData');
                if (data) {
                    const parsed = JSON.parse(data);
                    customers = parsed.customers || [];
                    nextId = parsed.nextId || 1;
                    gitHubSettings = parsed.gitHubSettings || { token: '', repo: 'milk-business-backup', username: '' };
                    console.log('âœ… Data loaded from storage');
                    return true;
                }
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                showAlert('ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
            return false;
        }

        // Customer Management Functions
        function addCustomer(event) {
            event.preventDefault();
            
            try {
                const name = document.getElementById('customer-name').value.trim();
                const phone = document.getElementById('customer-phone').value.trim();
                const address = document.getElementById('customer-address').value.trim();
                
                if (!name) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                const customer = {
                    id: nextId++,
                    name: name,
                    phone: phone,
                    address: address,
                    entries: [],
                    payments: [],
                    createdAt: new Date().toISOString()
                };
                
                customers.push(customer);
                saveToStorage();
                loadCustomers();
                updateDashboard();
                closeModal();
                
                showAlert('Ú¯Ø§ÛÚ© Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!');
            } catch (error) {
                console.error('Error adding customer:', error);
                showAlert('Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function loadCustomers() {
            try {
                const customersList = document.getElementById('customers-list');
                if (!customersList) return;
                
                customersList.innerHTML = '';
                
                customers.forEach(customer => {
                    const totalEntries = customer.entries ? customer.entries.length : 0;
                    const totalAmount = customer.entries ? customer.entries.reduce((sum, entry) => sum + (entry.liters * entry.rate), 0) : 0;
                    
                    // Calculate payment status for current month
                    const currentMonth = new Date().toISOString().substring(0, 7);
                    const monthlyEntries = customer.entries ? customer.entries.filter(entry => 
                        entry.fromDate && entry.fromDate.startsWith(currentMonth)
                    ) : [];
                    
                    let monthlyBill = 0;
                    monthlyEntries.forEach(entry => {
                        monthlyBill += entry.liters * entry.rate;
                    });
                    
                    let monthlyPaid = 0;
                    if (customer.payments) {
                        customer.payments.filter(payment => payment.month === currentMonth).forEach(payment => {
                            monthlyPaid += parseFloat(payment.amount);
                        });
                    }
                    
                    const paymentStatus = monthlyBill === 0 ? 'paid' : (monthlyPaid >= monthlyBill ? 'paid' : (monthlyPaid > 0 ? 'pending' : 'overdue'));
                    const paymentText = monthlyBill === 0 ? 'Ú©ÙˆØ¦ÛŒ Ø¨Ù„ Ù†ÛÛŒÚº' : (monthlyPaid >= monthlyBill ? 'Ø§Ø¯Ø§ Ø´Ø¯Û' : (monthlyPaid > 0 ? 'Ø¬Ø²ÙˆÛŒ Ø§Ø¯Ø§' : 'Ø¨Ø§Ù‚ÛŒ'));
                    
                    const customerCard = document.createElement('div');
                    customerCard.className = 'customer-card';
                    customerCard.onclick = () => showLedger(customer.id);
                    
                    customerCard.innerHTML = `
                        <div class="payment-status status-${paymentStatus}">${paymentText}</div>
                        <h3>ğŸ‘¤ ${customer.name}</h3>
                        <p><strong>ğŸ“ ÙÙˆÙ†:</strong> ${customer.phone || 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                        <p><strong>ğŸ“ Ù¾ØªÛ:</strong> ${customer.address || 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                        <p><strong>ğŸ“Š Ú©Ù„ Ø§Ù†Ù¹Ø±ÛŒØ²:</strong> ${totalEntries}</p>
                        <p><strong>ğŸ’° Ú©Ù„ Ø±Ù‚Ù…:</strong> ${totalAmount.toFixed(0)} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>ğŸ’³ Ø§Ø³ Ù…ÛÛŒÙ†Û’:</strong> ${monthlyBill.toFixed(0)} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>âœ… Ø§Ø¯Ø§ Ø´Ø¯Û:</strong> ${monthlyPaid.toFixed(0)} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>â— Ø¨Ø§Ù‚ÛŒ:</strong> ${(monthlyBill - monthlyPaid).toFixed(0)} Ø±ÙˆÙ¾Û’</p>
                    `;
                    
                    customersList.appendChild(customerCard);
                });
            } catch (error) {
                console.error('Error loading customers:', error);
                showAlert('Ú¯Ø§ÛÚ© Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // Ledger Functions
        function showLedger(customerId) {
            try {
                currentCustomerId = customerId;
                const customer = customers.find(c => c.id === customerId);
                
                if (!customer) {
                    showAlert('Ú¯Ø§ÛÚ© Ù†ÛÛŒÚº Ù…Ù„Ø§', 'error');
                    return;
                }
                
                // Initialize payments array if not exists
                if (!customer.payments) {
                    customer.payments = [];
                }
                
                // Hide other sections and show ledger
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                const ledgerSection = document.getElementById('ledger-section');
                if (ledgerSection) {
                    ledgerSection.classList.remove('hidden');
                }
                
                // Update customer info
                const nameEl = document.getElementById('ledger-customer-name');
                const phoneEl = document.getElementById('ledger-customer-phone');
                
                if (nameEl) nameEl.textContent = `ğŸ‘¤ ${customer.name}`;
                if (phoneEl) phoneEl.textContent = `ğŸ“ ${customer.phone || 'ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}`;
                
                // Reset month filter
                const monthFilter = document.getElementById('month-filter');
                if (monthFilter) {
                    monthFilter.value = 'all';
                }
                
                loadLedgerEntries(customerId);
                updateBillSummary();
                updatePaymentStatus();
                loadPaymentHistory();
            } catch (error) {
                console.error('Error showing ledger:', error);
                showAlert('Ù„ÛŒØ¬Ø± Ø¯Ú©Ú¾Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function loadLedgerEntries(customerId) {
            try {
                const customer = customers.find(c => c.id === customerId);
                const tbody = document.getElementById('entries-tbody');
                if (!tbody || !customer) return;
                
                tbody.innerHTML = '';
                
                if (!customer.entries || !customer.entries.length) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</td></tr>';
                    return;
                }
                
                // Filter entries by selected month
                const selectedMonth = document.getElementById('month-filter').value;
                let filteredEntries = customer.entries;
                
                if (selectedMonth !== 'all') {
                    filteredEntries = customer.entries.filter(entry => {
                        return entry.fromDate && entry.fromDate.startsWith(selectedMonth);
                    });
                }
                
                filteredEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    const totalAmount = entry.liters * entry.rate;
                    
                    row.innerHTML = `
                        <td>${formatDate(entry.fromDate)}</td>
                        <td>${formatDate(entry.toDate)}</td>
                        <td>${entry.liters}</td>
                        <td>${entry.rate}</td>
                        <td>${totalAmount.toFixed(0)}</td>
                        <td class="action-buttons">
                            <button class="action-btn edit-btn" onclick="editEntry(${entry.id})" title="Ø§ÛŒÚˆÙ¹">âœï¸</button>
                            <button class="action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="ÚˆÛŒÙ„ÛŒÙ¹">ğŸ—‘ï¸</button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                updateBillSummary();
                updatePaymentStatus();
            } catch (error) {
                console.error('Error loading ledger entries:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒØ² Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function filterByMonth() {
            try {
                loadLedgerEntries(currentCustomerId);
                updatePaymentStatus();
            } catch (error) {
                console.error('Error filtering by month:', error);
                showAlert('Ù…ÛÛŒÙ†Û ÙÙ„Ù¹Ø± Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // Entry Management Functions
        function openAddEntryModal() {
            try {
                if (!currentCustomerId) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                // Reset form for new entry
                currentEditEntryId = null;
                const titleEl = document.getElementById('entry-modal-title');
                const btnEl = document.getElementById('entry-submit-btn');
                
                if (titleEl) titleEl.textContent = 'â• Ù†Ø¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
                if (btnEl) btnEl.textContent = 'Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
                
                const form = document.querySelector('#add-entry-modal form');
                if (form) form.reset();
                
                const modal = document.getElementById('add-entry-modal');
                if (modal && modal.classList) {
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Error opening add entry modal:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ ÙØ§Ø±Ù… Ú©Ú¾ÙˆÙ„Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function submitEntry(event) {
            event.preventDefault();
            
            try {
                if (currentEditEntryId) {
                    updateEntry();
                } else {
                    addEntry();
                }
            } catch (error) {
                console.error('Error submitting entry:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function addEntry() {
            try {
                const fromDate = document.getElementById('entry-from-date').value;
                const toDate = document.getElementById('entry-to-date').value;
                const liters = parseFloat(document.getElementById('entry-liters').value);
                const rate = parseFloat(document.getElementById('entry-rate').value);
                
                if (!fromDate || !toDate || !liters || !rate) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ø¨Ú¾Ø±ÛŒÚº', 'error');
                    return;
                }
                
                if (new Date(fromDate) > new Date(toDate)) {
                    showAlert('Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø³Û’ Ù¾ÛÙ„Û’ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ', 'error');
                    return;
                }
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) {
                    showAlert('Ú¯Ø§ÛÚ© Ù†ÛÛŒÚº Ù…Ù„Ø§', 'error');
                    return;
                }
                
                const entry = {
                    id: nextId++,
                    fromDate: fromDate,
                    toDate: toDate,
                    liters: liters,
                    rate: rate,
                    createdAt: new Date().toISOString()
                };
                
                customer.entries.push(entry);
                saveToStorage();
                loadLedgerEntries(currentCustomerId);
                updateDashboard();
                closeModal();
                
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                console.error('Error adding entry:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function editEntry(entryId) {
            try {
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                const entry = customer.entries.find(e => e.id === entryId);
                if (!entry) {
                    showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                    return;
                }
                
                currentEditEntryId = entryId;
                
                // Fill form with existing data
                document.getElementById('entry-from-date').value = entry.fromDate;
                document.getElementById('entry-to-date').value = entry.toDate;
                document.getElementById('entry-liters').value = entry.liters;
                document.getElementById('entry-rate').value = entry.rate;
                
                // Update modal title and button text
                const titleEl = document.getElementById('entry-modal-title');
                const btnEl = document.getElementById('entry-submit-btn');
                
                if (titleEl) titleEl.textContent = 'âœï¸ Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹ Ú©Ø±ÛŒÚº';
                if (btnEl) btnEl.textContent = 'Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
                
                const modal = document.getElementById('add-entry-modal');
                if (modal && modal.classList) {
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Error editing entry:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ø§ÛŒÚˆÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function updateEntry() {
            try {
                const fromDate = document.getElementById('entry-from-date').value;
                const toDate = document.getElementById('entry-to-date').value;
                const liters = parseFloat(document.getElementById('entry-liters').value);
                const rate = parseFloat(document.getElementById('entry-rate').value);
                
                if (!fromDate || !toDate || !liters || !rate) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ø¨Ú¾Ø±ÛŒÚº', 'error');
                    return;
                }
                
                if (new Date(fromDate) > new Date(toDate)) {
                    showAlert('Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø³Û’ Ù¾ÛÙ„Û’ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ', 'error');
                    return;
                }
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                const entryIndex = customer.entries.findIndex(e => e.id === currentEditEntryId);
                
                if (entryIndex !== -1) {
                    customer.entries[entryIndex] = {
                        ...customer.entries[entryIndex],
                        fromDate: fromDate,
                        toDate: toDate,
                        liters: liters,
                        rate: rate,
                        updatedAt: new Date().toISOString()
                    };
                    
                    saveToStorage();
                    loadLedgerEntries(currentCustomerId);
                    updateDashboard();
                    closeModal();
                    
                    showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!');
                }
            } catch (error) {
                console.error('Error updating entry:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function deleteEntry(entryId) {
            try {
                if (!confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø§Ù†Ù¹Ø±ÛŒ Ú©Ùˆ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                    return;
                }
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                customer.entries = customer.entries.filter(e => e.id !== entryId);
                
                saveToStorage();
                loadLedgerEntries(currentCustomerId);
                updateDashboard();
                
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!');
            } catch (error) {
                console.error('Error deleting entry:', error);
                showAlert('Ø§Ù†Ù¹Ø±ÛŒ ÚˆÛŒÙ„ÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // Bill Summary Functions
        function updateBillSummary() {
            try {
                if (!currentCustomerId) return;
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                // Filter entries by selected month
                const selectedMonth = document.getElementById('month-filter').value;
                let filteredEntries = customer.entries || [];
                
                if (selectedMonth !== 'all') {
                    filteredEntries = filteredEntries.filter(entry => {
                        return entry.fromDate && entry.fromDate.startsWith(selectedMonth);
                    });
                }
                
                let totalLiters = 0;
                let totalDays = 0;
                let totalAmount = 0;
                
                filteredEntries.forEach(entry => {
                    totalLiters += entry.liters;
                    totalAmount += entry.liters * entry.rate;
                    
                    // Calculate days between dates
                    const fromDate = new Date(entry.fromDate);
                    const toDate = new Date(entry.toDate);
                    const diffTime = Math.abs(toDate - fromDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    totalDays += diffDays;
                });
                
                // Update summary display
                const litersEl = document.getElementById('summary-total-liters');
                const daysEl = document.getElementById('summary-total-days');
                const amountEl = document.getElementById('summary-total-amount');
                
                if (litersEl) litersEl.textContent = totalLiters.toFixed(1);
                if (daysEl) daysEl.textContent = totalDays;
                if (amountEl) amountEl.textContent = totalAmount.toFixed(0);
            } catch (error) {
                console.error('Error updating bill summary:', error);
            }
        }

        // Payment Management Functions
        function updatePaymentStatus() {
            try {
                if (!currentCustomerId) return;
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                const selectedMonth = document.getElementById('month-filter').value;
                let monthToCheck = selectedMonth;
                
                if (selectedMonth === 'all') {
                    monthToCheck = new Date().toISOString().substring(0, 7);
                }
                
                // Update payment month name
                const monthNameEl = document.getElementById('payment-month-name');
                if (monthNameEl) {
                    monthNameEl.textContent = selectedMonth === 'all' ? 'Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÛŒ' : monthNames[monthToCheck] + ' Ú©ÛŒ';
                }
                
                // Calculate monthly bill
                let monthlyBill = 0;
                const monthlyEntries = customer.entries ? customer.entries.filter(entry => 
                    entry.fromDate && entry.fromDate.startsWith(monthToCheck)
                ) : [];
                
                monthlyEntries.forEach(entry => {
                    monthlyBill += entry.liters * entry.rate;
                });
                
                // Calculate paid amount
                let paidAmount = 0;
                if (customer.payments) {
                    customer.payments.filter(payment => payment.month === monthToCheck).forEach(payment => {
                        paidAmount += parseFloat(payment.amount);
                    });
                }
                
                const remainingAmount = monthlyBill - paidAmount;
                const percentage = monthlyBill > 0 ? ((paidAmount / monthlyBill) * 100) : 0;
                
                // Update payment status display
                const totalEl = document.getElementById('month-total-amount');
                const paidEl = document.getElementById('month-paid-amount');
                const remainingEl = document.getElementById('month-remaining-amount');
                const percentageEl = document.getElementById('payment-percentage');
                const payBtn = document.getElementById('pay-remaining-btn');
                
                if (totalEl) totalEl.textContent = monthlyBill.toFixed(0);
                if (paidEl) paidEl.textContent = paidAmount.toFixed(0);
                if (remainingEl) remainingEl.textContent = remainingAmount.toFixed(0);
                if (percentageEl) percentageEl.textContent = percentage.toFixed(1) + '%';
                
                if (payBtn) {
                    if (remainingAmount > 0) {
                        payBtn.textContent = `ğŸ’° ${remainingAmount.toFixed(0)} Ø±ÙˆÙ¾Û’ Ø§Ø¯Ø§ Ú©Ø±ÛŒÚº`;
                        payBtn.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff8f00 100%)';
                        payBtn.disabled = false;
                    } else {
                        payBtn.textContent = 'âœ… Ù…Ú©Ù…Ù„ Ø§Ø¯Ø§ Ø´Ø¯Û';
                        payBtn.style.background = '#4CAF50';
                        payBtn.disabled = true;
                    }
                }
            } catch (error) {
                console.error('Error updating payment status:', error);
            }
        }

        function openPaymentModal() {
            try {
                if (!currentCustomerId) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                const modal = document.getElementById('payment-modal');
                if (!modal) return;
                
                const selectedMonth = document.getElementById('month-filter').value;
                
                if (selectedMonth && selectedMonth !== 'all') {
                    const paymentMonthEl = document.getElementById('payment-month');
                    if (paymentMonthEl) {
                        paymentMonthEl.value = selectedMonth;
                        updatePaymentSummary();
                    }
                }
                
                const today = new Date().toISOString().split('T')[0];
                const paymentDateEl = document.getElementById('payment-date');
                if (paymentDateEl) {
                    paymentDateEl.value = today;
                }
                
                if (modal.classList) {
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Error opening payment modal:', error);
                showAlert('Ù¾ÛŒÙ…Ù†Ù¹ ÙØ§Ø±Ù… Ú©Ú¾ÙˆÙ„Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function updatePaymentSummary() {
            try {
                const selectedMonth = document.getElementById('payment-month').value;
                if (!selectedMonth || !currentCustomerId) return;
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                // Calculate monthly bill
                let monthlyTotal = 0;
                const monthlyEntries = customer.entries ? customer.entries.filter(entry => 
                    entry.fromDate && entry.fromDate.startsWith(selectedMonth)
                ) : [];
                
                monthlyEntries.forEach(entry => {
                    monthlyTotal += entry.liters * entry.rate;
                });
                
                // Calculate already paid
                let alreadyPaid = 0;
                if (customer.payments) {
                    customer.payments.filter(p => p.month === selectedMonth).forEach(payment => {
                        alreadyPaid += parseFloat(payment.amount);
                    });
                }
                
                const remaining = monthlyTotal - alreadyPaid;
                
                // Show summary
                const summaryDiv = document.getElementById('payment-summary-info');
                if (summaryDiv) {
                    summaryDiv.style.display = 'block';
                }
                
                const billTotalEl = document.getElementById('bill-total-info');
                const alreadyPaidEl = document.getElementById('already-paid-info');
                const remainingEl = document.getElementById('remaining-info');
                
                if (billTotalEl) billTotalEl.textContent = monthlyTotal.toFixed(0);
                if (alreadyPaidEl) alreadyPaidEl.textContent = alreadyPaid.toFixed(0);
                if (remainingEl) remainingEl.textContent = remaining.toFixed(0);
                
                // Set suggested amount
                const amountInput = document.getElementById('payment-amount');
                if (amountInput) {
                    amountInput.value = remaining > 0 ? remaining.toFixed(0) : '';
                }
            } catch (error) {
                console.error('Error updating payment summary:', error);
            }
        }

        function addPayment(event) {
            event.preventDefault();
            
            try {
                const month = document.getElementById('payment-month').value;
                const amount = parseFloat(document.getElementById('payment-amount').value);
                const date = document.getElementById('payment-date').value;
                const method = document.getElementById('payment-method').value;
                const notes = document.getElementById('payment-notes').value;
                
                if (!month || !amount || !date) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¶Ø±ÙˆØ±ÛŒ ÙÛŒÙ„ÚˆØ² Ø¨Ú¾Ø±ÛŒÚº', 'error');
                    return;
                }
                
                if (amount <= 0) {
                    showAlert('Ø±Ù‚Ù… ØµÙØ± Ø³Û’ Ø²ÛŒØ§Ø¯Û ÛÙˆÙ†ÛŒ Ú†Ø§ÛÛŒÛ’', 'error');
                    return;
                }
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer) return;
                
                // Initialize payments array if not exists
                if (!customer.payments) {
                    customer.payments = [];
                }
                
                const payment = {
                    id: nextId++,
                    month: month,
                    amount: amount,
                    date: date,
                    method: method,
                    notes: notes,
                    createdAt: new Date().toISOString()
                };
                
                customer.payments.push(payment);
                saveToStorage();
                
                // Update UI
                updatePaymentStatus();
                loadPaymentHistory();
                loadCustomers();
                updateDashboard();
                closeModal();
                
                showAlert(`ğŸ’° ${amount} Ø±ÙˆÙ¾Û’ Ú©ÛŒ Ù¾ÛŒÙ…Ù†Ù¹ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø±ÛŒÚ©Ø§Ø±Úˆ ÛÙˆ Ú¯Ø¦ÛŒ!`);
            } catch (error) {
                console.error('Error adding payment:', error);
                showAlert('Ù¾ÛŒÙ…Ù†Ù¹ Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function loadPaymentHistory() {
            try {
                if (!currentCustomerId) return;
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer || !customer.payments) return;
                
                const historyList = document.getElementById('payment-history-list');
                if (!historyList) return;
                
                historyList.innerHTML = '';
                
                if (!customer.payments.length) {
                    historyList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ú©ÙˆØ¦ÛŒ Ù¾ÛŒÙ…Ù†Ù¹ Ø±ÛŒÚ©Ø§Ø±Úˆ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</p>';
                    return;
                }
                
                // Sort payments by date (newest first)
                const sortedPayments = [...customer.payments].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedPayments.forEach(payment => {
                    const paymentDiv = document.createElement('div');
                    paymentDiv.className = 'payment-history-item';
                    
                    paymentDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #2e7d32; font-size: 20px;">ğŸ’° ${payment.amount} Ø±ÙˆÙ¾Û’</strong>
                            <span style="background: #4caf50; color: white; padding: 6px 12px; border-radius: 15px; font-size: 12px;">
                                ${monthNames[payment.month] || payment.month}
                            </span>
                        </div>
                        <p style="color: #2e7d32; margin-bottom: 5px;">ğŸ“… ØªØ§Ø±ÛŒØ®: ${formatDate(payment.date)}</p>
                        <p style="color: #2e7d32; margin-bottom: 5px;">ğŸ’³ Ø·Ø±ÛŒÙ‚Û: ${paymentMethodNames[payment.method] || payment.method}</p>
                        ${payment.notes ? `<p style="color: #2e7d32; margin-bottom: 0;">ğŸ“ Ù†ÙˆÙ¹Ø³: ${payment.notes}</p>` : ''}
                    `;
                    
                    historyList.appendChild(paymentDiv);
                });
            } catch (error) {
                console.error('Error loading payment history:', error);
            }
        }

        function loadPaymentsOverview() {
            try {
                const overviewDiv = document.getElementById('payments-overview');
                if (!overviewDiv) return;
                
                const selectedMonth = document.getElementById('payments-month-filter').value;
                
                overviewDiv.innerHTML = '';
                
                if (selectedMonth === 'all') {
                    loadAllMonthsPayments();
                } else {
                    loadSpecificMonthPayments(selectedMonth);
                }
            } catch (error) {
                console.error('Error loading payments overview:', error);
                showAlert('Ù¾ÛŒÙ…Ù†Ù¹Ø³ Ú©Ø§ Ø¬Ø§Ø¦Ø²Û Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function loadAllMonthsPayments() {
            try {
                const overviewDiv = document.getElementById('payments-overview');
                
                let totalBill = 0;
                let totalPaid = 0;
                let totalCustomers = 0;
                
                const monthlyData = {};
                
                customers.forEach(customer => {
                    let customerHasData = false;
                    
                    // Process each month
                    Object.keys(monthNames).forEach(month => {
                        let monthBill = 0;
                        let monthPaid = 0;
                        
                        // Calculate monthly bill
                        const monthlyEntries = customer.entries ? customer.entries.filter(entry => 
                            entry.fromDate && entry.fromDate.startsWith(month)
                        ) : [];
                        
                        monthlyEntries.forEach(entry => {
                            monthBill += entry.liters * entry.rate;
                        });
                        
                        // Calculate monthly payments
                        if (customer.payments) {
                            customer.payments.filter(p => p.month === month).forEach(payment => {
                                monthPaid += parseFloat(payment.amount);
                            });
                        }
                        
                        if (monthBill > 0) {
                            customerHasData = true;
                            totalBill += monthBill;
                            totalPaid += monthPaid;
                            
                            if (!monthlyData[month]) {
                                monthlyData[month] = { bill: 0, paid: 0, customers: 0 };
                            }
                            monthlyData[month].bill += monthBill;
                            monthlyData[month].paid += monthPaid;
                            monthlyData[month].customers++;
                        }
                    });
                    
                    if (customerHasData) {
                        totalCustomers++;
                    }
                });
                
                // Create overview cards
                const summaryHTML = `
                    <div class="dashboard-grid" style="margin-bottom: 30px;">
                        <div class="dashboard-card">
                            <h3>Ú©Ù„ Ú¯Ø§ÛÚ©</h3>
                            <div class="number">${totalCustomers}</div>
                        </div>
                        <div class="dashboard-card">
                            <h3>Ú©Ù„ Ø¨Ù„</h3>
                            <div class="number">${totalBill.toFixed(0)}</div>
                            <small>Ø±ÙˆÙ¾Û’</small>
                        </div>
                        <div class="dashboard-card">
                            <h3>Ú©Ù„ Ø§Ø¯Ø§ Ø´Ø¯Û</h3>
                            <div class="number">${totalPaid.toFixed(0)}</div>
                            <small>Ø±ÙˆÙ¾Û’</small>
                        </div>
                        <div class="dashboard-card">
                            <h3>Ú©Ù„ Ø¨Ø§Ù‚ÛŒ</h3>
                            <div class="number">${(totalBill - totalPaid).toFixed(0)}</div>
                            <small>Ø±ÙˆÙ¾Û’</small>
                        </div>
                    </div>
                `;
                
                // Create monthly breakdown
                let monthlyHTML = '<h3 style="margin-bottom: 20px; text-align: center;">ğŸ“Š Ù…Ø§ÛØ§Ù†Û ØªÙØµÛŒÙ„Ø§Øª</h3>';
                
                Object.keys(monthlyData).sort().reverse().forEach(month => {
                    const data = monthlyData[month];
                    const remaining = data.bill - data.paid;
                    const percentage = data.bill > 0 ? ((data.paid / data.bill) * 100) : 0;
                    
                    monthlyHTML += `
                        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid ${percentage >= 100 ? '#28a745' : (percentage > 50 ? '#ffc107' : '#dc3545')};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="color: #333;">${monthNames[month]}</h4>
                                <span style="background: ${percentage >= 100 ? '#28a745' : (percentage > 50 ? '#ffc107' : '#dc3545')}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 14px;">
                                    ${percentage.toFixed(1)}% Ù…Ú©Ù…Ù„
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: bold; color: #2196f3;">${data.customers}</div>
                                    <small>Ú¯Ø§ÛÚ©</small>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: bold; color: #ff9800;">${data.bill.toFixed(0)}</div>
                                    <small>Ú©Ù„ Ø¨Ù„</small>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: bold; color: #4caf50;">${data.paid.toFixed(0)}</div>
                                    <small>Ø§Ø¯Ø§ Ø´Ø¯Û</small>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: bold; color: #f44336;">${remaining.toFixed(0)}</div>
                                    <small>Ø¨Ø§Ù‚ÛŒ</small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                overviewDiv.innerHTML = summaryHTML + monthlyHTML;
            } catch (error) {
                console.error('Error loading all months payments:', error);
            }
        }

        function loadSpecificMonthPayments(month) {
            try {
                const overviewDiv = document.getElementById('payments-overview');
                
                let monthBill = 0;
                let monthPaid = 0;
                const customerPayments = [];
                
                customers.forEach(customer => {
                    let customerBill = 0;
                    let customerPaid = 0;
                    
                    // Calculate customer's monthly bill
                    const monthlyEntries = customer.entries ? customer.entries.filter(entry => 
                        entry.fromDate && entry.fromDate.startsWith(month)
                    ) : [];
                    
                    monthlyEntries.forEach(entry => {
                        customerBill += entry.liters * entry.rate;
                    });
                    
                    // Calculate customer's monthly payments
                    if (customer.payments) {
                        customer.payments.filter(p => p.month === month).forEach(payment => {
                            customerPaid += parseFloat(payment.amount);
                        });
                    }
                    
                    if (customerBill > 0) {
                        monthBill += customerBill;
                        monthPaid += customerPaid;
                        
                        customerPayments.push({
                            customer: customer,
                            bill: customerBill,
                            paid: customerPaid,
                            remaining: customerBill - customerPaid
                        });
                    }
                });
                
                // Sort by remaining amount (highest first)
                customerPayments.sort((a, b) => b.remaining - a.remaining);
                
                const summaryHTML = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center;">
                        <h2>${monthNames[month]} Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">${customerPayments.length}</div>
                                <div>Ú¯Ø§ÛÚ©</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">${monthBill.toFixed(0)}</div>
                                <div>Ú©Ù„ Ø¨Ù„</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">${monthPaid.toFixed(0)}</div>
                                <div>Ø§Ø¯Ø§ Ø´Ø¯Û</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold;">${(monthBill - monthPaid).toFixed(0)}</div>
                                <div>Ø¨Ø§Ù‚ÛŒ</div>
                            </div>
                        </div>
                    </div>
                `;
                
                let customersHTML = '<h3 style="margin-bottom: 20px; text-align: center;">ğŸ‘¥ Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>';
                
                customerPayments.forEach(data => {
                    const percentage = data.bill > 0 ? ((data.paid / data.bill) * 100) : 0;
                    
                    customersHTML += `
                        <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-right: 5px solid ${percentage >= 100 ? '#28a745' : (percentage > 50 ? '#ffc107' : '#dc3545')}; cursor: pointer;" onclick="showLedger(${data.customer.id})">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="color: #333; margin: 0;">ğŸ‘¤ ${data.customer.name}</h4>
                                <span style="background: ${percentage >= 100 ? '#28a745' : (percentage > 50 ? '#ffc107' : '#dc3545')}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">
                                    ${percentage >= 100 ? 'Ù…Ú©Ù…Ù„' : (percentage > 0 ? 'Ø¬Ø²ÙˆÛŒ' : 'Ø¨Ø§Ù‚ÛŒ')}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #ff9800;">ğŸ’° ${data.bill.toFixed(0)}</div>
                                    <small>Ú©Ù„ Ø¨Ù„</small>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #4caf50;">âœ… ${data.paid.toFixed(0)}</div>
                                    <small>Ø§Ø¯Ø§ Ø´Ø¯Û</small>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #f44336;">â— ${data.remaining.toFixed(0)}</div>
                                    <small>Ø¨Ø§Ù‚ÛŒ</small>
                                </div>
                            </div>
                            <p style="margin-top: 10px; color: #666; font-size: 14px;">ğŸ“ ${data.customer.phone || 'ÙÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                        </div>
                    `;
                });
                
                if (customerPayments.length === 0) {
                    customersHTML += '<p style="text-align: center; color: #666; padding: 40px;">Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÙˆØ¦ÛŒ Ø¨Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</p>';
                }
                
                overviewDiv.innerHTML = summaryHTML + customersHTML;
            } catch (error) {
                console.error('Error loading specific month payments:', error);
            }
        }

        // PDF Generation Functions
        function generateBill() {
            try {
                if (!currentCustomerId) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                const customer = customers.find(c => c.id === currentCustomerId);
                if (!customer || !customer.entries || !customer.entries.length) {
                    showAlert('Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº', 'error');
                    return;
                }
                
                // Filter entries by selected month
                const selectedMonth = document.getElementById('month-filter').value;
                let filteredEntries = customer.entries;
                
                if (selectedMonth !== 'all') {
                    filteredEntries = customer.entries.filter(entry => {
                        return entry.fromDate && entry.fromDate.startsWith(selectedMonth);
                    });
                }
                
                if (!filteredEntries.length) {
                    showAlert('Ù…Ù†ØªØ®Ø¨ Ú©Ø±Ø¯Û Ù…ÛÛŒÙ†Û’ Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº', 'error');
                    return;
                }
                
                // Prepare bill data
                currentBillData = {
                    customer: customer,
                    entries: filteredEntries,
                    selectedMonth: selectedMonth
                };
                
                generatePDFPreview();
                const modal = document.getElementById('pdf-preview-modal');
                if (modal && modal.classList) {
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Error generating bill:', error);
                showAlert('Ø¨Ù„ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function generatePDFPreview() {
            try {
                if (!currentBillData) return;
                
                const { customer, entries, selectedMonth } = currentBillData;
                const previewContent = document.getElementById('pdf-preview-content');
                if (!previewContent) return;
                
                let totalLiters = 0;
                let totalDays = 0;
                let totalAmount = 0;
                
                // Calculate totals
                entries.forEach(entry => {
                    totalLiters += entry.liters;
                    totalAmount += entry.liters * entry.rate;
                    
                    const fromDate = new Date(entry.fromDate);
                    const toDate = new Date(entry.toDate);
                    const diffTime = Math.abs(toDate - fromDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    totalDays += diffDays;
                });
                
                // Calculate payment information
                let paidAmount = 0;
                const payments = [];
                
                if (customer.payments) {
                    const monthToCheck = selectedMonth === 'all' ? new Date().toISOString().substring(0, 7) : selectedMonth;
                    customer.payments.filter(payment => payment.month === monthToCheck).forEach(payment => {
                        paidAmount += parseFloat(payment.amount);
                        payments.push(payment);
                    });
                }
                
                const remainingAmount = totalAmount - paidAmount;
                
                const monthName = selectedMonth === 'all' ? 'ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’' : monthNames[selectedMonth];
                const currentDate = new Date().toLocaleDateString('ur-PK');
                
                // Generate beautiful colorful Urdu PDF preview
                previewContent.innerHTML = `
                    <div class="pdf-header">
                        <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
                        <p>Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø±Ø§Ø¦Ø²Úˆ Ø¨Ù„ Ø³Ø³Ù¹Ù… - Ù¾ÛŒÙ…Ù†Ù¹ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ú©Û’ Ø³Ø§ØªÚ¾</p>
                        <p style="font-size: 16px; margin-top: 10px;">ğŸ“… ØªØ§Ø±ÛŒØ®: ${currentDate}</p>
                    </div>
                    
                    <div class="pdf-customer-info">
                        <h3>Ú¯Ø§ÛÚ© Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                        <p style="font-size: 18px;"><strong>ğŸ‘¤ Ù†Ø§Ù…:</strong> ${customer.name}</p>
                        <p style="font-size: 16px;"><strong>ğŸ“ ÙÙˆÙ†:</strong> ${customer.phone || 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                        <p style="font-size: 16px;"><strong>ğŸ“ Ù¾ØªÛ:</strong> ${customer.address || 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                        <p style="font-size: 16px;"><strong>ğŸ“Š Ù…ÛÛŒÙ†Û:</strong> ${monthName}</p>
                    </div>
                    
                    <table class="pdf-table">
                        <thead>
                            <tr>
                                <th>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¯ÙˆØ¯Ú¾ (Ù„ÛŒÙ¹Ø±)</th>
                                <th>Ø±ÛŒÙ¹ (ÙÛŒ Ù„ÛŒÙ¹Ø±)</th>
                                <th>Ú©Ù„ Ø±Ù‚Ù…</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${entries.map(entry => `
                                <tr>
                                    <td>${formatDate(entry.fromDate)}</td>
                                    <td>${formatDate(entry.toDate)}</td>
                                    <td>${entry.liters}</td>
                                    <td>${entry.rate} Ø±ÙˆÙ¾Û’</td>
                                    <td>${(entry.liters * entry.rate).toFixed(0)} Ø±ÙˆÙ¾Û’</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    ${payments.length > 0 ? `
                    <div class="pdf-payment-info">
                        <h3>Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</h3>
                        ${payments.map(payment => `
                            <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-right: 4px solid #4caf50;">
                                <p style="font-size: 16px;"><strong>ğŸ’° Ø±Ù‚Ù…:</strong> ${payment.amount} Ø±ÙˆÙ¾Û’</p>
                                <p style="font-size: 14px;"><strong>ğŸ“… ØªØ§Ø±ÛŒØ®:</strong> ${formatDate(payment.date)}</p>
                                <p style="font-size: 14px;"><strong>ğŸ’³ Ø·Ø±ÛŒÙ‚Û:</strong> ${paymentMethodNames[payment.method] || payment.method}</p>
                                ${payment.notes ? `<p style="font-size: 14px;"><strong>ğŸ“ Ù†ÙˆÙ¹Ø³:</strong> ${payment.notes}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div class="pdf-summary">
                        <h3 style="margin-bottom: 25px;">ğŸ“Š Ú©Ù„ Ø­Ø³Ø§Ø¨ Ú©ØªØ§Ø¨</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="value">${totalLiters.toFixed(1)}</div>
                                <div class="label">ğŸ¥› Ú©Ù„ Ø¯ÙˆØ¯Ú¾ (Ù„ÛŒÙ¹Ø±)</div>
                            </div>
                            <div class="summary-item">
                                <div class="value">${totalDays}</div>
                                <div class="label">ğŸ“… Ú©Ù„ Ø¯Ù†</div>
                            </div>
                            <div class="summary-item">
                                <div class="value">${totalAmount.toFixed(0)}</div>
                                <div class="label">ğŸ’° Ú©Ù„ Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)</div>
                            </div>
                            <div class="summary-item">
                                <div class="value">${paidAmount.toFixed(0)}</div>
                                <div class="label">âœ… Ø§Ø¯Ø§ Ø´Ø¯Û (Ø±ÙˆÙ¾Û’)</div>
                            </div>
                            <div class="summary-item">
                                <div class="value" style="color: ${remainingAmount > 0 ? '#ffeb3b' : '#4caf50'};">${remainingAmount.toFixed(0)}</div>
                                <div class="label">ğŸ’¸ ${remainingAmount > 0 ? 'Ø¨Ø§Ù‚ÛŒ' : 'Ù…Ú©Ù…Ù„'} (Ø±ÙˆÙ¾Û’)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pdf-footer">
                        <h4>ğŸ™ Ø´Ú©Ø±ÛŒÛ Ø¢Ù¾ Ú©Û’ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± Ú©Û’ Ù„ÛŒÛ’!</h4>
                        <p>ÛŒÛ Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø± Ø³Û’ ØªÛŒØ§Ø± Ú©Ø±Ø¯Û Ø¨Ù„ ÛÛ’ - Ù¾ÛŒÙ…Ù†Ù¹ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ú©Û’ Ø³Ø§ØªÚ¾</p>
                        <p style="margin-top: 15px; font-size: 14px;">
                            ğŸ“± Ù…ÙˆØ¨Ø§Ø¦Ù„: Ø¢Ù¾ Ú©Ø§ ÙÙˆÙ† Ù†Ù…Ø¨Ø± | ğŸ“§ Ø§ÛŒ Ù…ÛŒÙ„: Ø¢Ù¾ Ú©Ø§ Ø§ÛŒ Ù…ÛŒÙ„<br>
                            ğŸŒ ÙˆÛŒØ¨ Ø³Ø§Ø¦Ù¹: Ø¢Ù¾ Ú©Ø§ ÙˆÛŒØ¨ Ø³Ø§Ø¦Ù¹ | ğŸ“ Ù¾ØªÛ: Ø¢Ù¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ù¾ØªÛ
                        </p>
                        <p style="margin-top: 10px; font-size: 12px; color: #888;">
                            Enhanced Milk Business App v5.0 - ØªÛŒØ§Ø± Ú©Ø±Ø¯Û ${new Date().toLocaleDateString('ur-PK')}
                        </p>
                    </div>
                `;
            } catch (error) {
                console.error('Error generating PDF preview:', error);
                showAlert('PDF Ù¾ÛŒØ´ Ù…Ù†Ø¸Ø± Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function downloadPDF() {
            try {
                if (!currentBillData) {
                    showAlert('Ø¨Ù„ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set font (Note: jsPDF has limited Urdu support, but we'll create a readable document)
                doc.setFont('times', 'normal');
                doc.setFontSize(16);
                
                const { customer, entries, selectedMonth } = currentBillData;
                
                // Calculate totals
                let totalLiters = 0;
                let totalAmount = 0;
                let totalDays = 0;
                
                entries.forEach(entry => {
                    totalLiters += entry.liters;
                    totalAmount += entry.liters * entry.rate;
                    
                    const fromDate = new Date(entry.fromDate);
                    const toDate = new Date(entry.toDate);
                    const diffTime = Math.abs(toDate - fromDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    totalDays += diffDays;
                });
                
                // Calculate payment info
                let paidAmount = 0;
                if (customer.payments) {
                    const monthToCheck = selectedMonth === 'all' ? new Date().toISOString().substring(0, 7) : selectedMonth;
                    customer.payments.filter(payment => payment.month === monthToCheck).forEach(payment => {
                        paidAmount += parseFloat(payment.amount);
                    });
                }
                
                const remainingAmount = totalAmount - paidAmount;
                
                // Header
                doc.setFontSize(20);
                doc.text('Milk Business - Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±', 105, 20, { align: 'center' });
                
                doc.setFontSize(14);
                doc.text('Computerized Bill System with Payment Tracking', 105, 30, { align: 'center' });
                
                // Customer info
                doc.setFontSize(12);
                const currentDate = new Date().toLocaleDateString();
                doc.text(`Date: ${currentDate}`, 20, 50);
                
                doc.text(`Customer Name: ${customer.name}`, 20, 60);
                doc.text(`Phone: ${customer.phone || 'N/A'}`, 20, 70);
                doc.text(`Address: ${customer.address || 'N/A'}`, 20, 80);
                doc.text(`Month: ${selectedMonth === 'all' ? 'All Months' : monthNames[selectedMonth]}`, 20, 90);
                
                // Table header
                let yPosition = 110;
                doc.setFontSize(10);
                doc.text('From Date', 20, yPosition);
                doc.text('To Date', 50, yPosition);
                doc.text('Liters', 80, yPosition);
                doc.text('Rate', 105, yPosition);
                doc.text('Amount', 130, yPosition);
                
                // Draw line under header
                doc.line(20, yPosition + 2, 150, yPosition + 2);
                
                // Table content
                yPosition += 10;
                entries.forEach(entry => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(formatDate(entry.fromDate), 20, yPosition);
                    doc.text(formatDate(entry.toDate), 50, yPosition);
                    doc.text(entry.liters.toString(), 80, yPosition);
                    doc.text(entry.rate.toString(), 105, yPosition);
                    doc.text((entry.liters * entry.rate).toFixed(0), 130, yPosition);
                    yPosition += 8;
                });
                
                // Summary
                yPosition += 10;
                doc.line(20, yPosition, 150, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Total Liters: ${totalLiters.toFixed(1)}`, 20, yPosition);
                yPosition += 10;
                doc.text(`Total Days: ${totalDays}`, 20, yPosition);
                yPosition += 10;
                doc.text(`Total Amount: ${totalAmount.toFixed(0)} Rs`, 20, yPosition);
                yPosition += 10;
                doc.text(`Paid Amount: ${paidAmount.toFixed(0)} Rs`, 20, yPosition);
                yPosition += 10;
                doc.text(`Remaining: ${remainingAmount.toFixed(0)} Rs`, 20, yPosition);
                
                // Footer
                yPosition += 20;
                doc.setFontSize(10);
                doc.text('Thank you for your business!', 105, yPosition, { align: 'center' });
                doc.text('This is a computer generated bill with payment tracking', 105, yPosition + 10, { align: 'center' });
                
                // Download
                const fileName = `${customer.name}_Bill_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showAlert('ğŸ“¥ PDF Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ ÛÙˆ Ú¯ÛŒØ§!');
            } catch (error) {
                console.error('Error downloading PDF:', error);
                showAlert('PDF ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function shareViaWhatsApp() {
            try {
                if (!currentBillData) {
                    showAlert('Ø¨Ù„ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº', 'error');
                    return;
                }
                
                const { customer, entries, selectedMonth } = currentBillData;
                
                // Calculate totals
                let totalLiters = 0;
                let totalAmount = 0;
                let totalDays = 0;
                
                entries.forEach(entry => {
                    totalLiters += entry.liters;
                    totalAmount += entry.liters * entry.rate;
                    
                    const fromDate = new Date(entry.fromDate);
                    const toDate = new Date(entry.toDate);
                    const diffTime = Math.abs(toDate - fromDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    totalDays += diffDays;
                });
                
                // Calculate payment info
                let paidAmount = 0;
                const payments = [];
                
                if (customer.payments) {
                    const monthToCheck = selectedMonth === 'all' ? new Date().toISOString().substring(0, 7) : selectedMonth;
                    customer.payments.filter(payment => payment.month === monthToCheck).forEach(payment => {
                        paidAmount += parseFloat(payment.amount);
                        payments.push(payment);
                    });
                }
                
                const remainingAmount = totalAmount - paidAmount;
                const monthName = selectedMonth === 'all' ? 'ØªÙ…Ø§Ù… Ù…ÛÛŒÙ†Û’' : monthNames[selectedMonth];
                
                // Create WhatsApp message
                let message = `ğŸ¥› *Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Ø¨Ù„*\n\n`;
                message += `*ğŸ‘¤ Ú¯Ø§ÛÚ© Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª:*\n`;
                message += `Ù†Ø§Ù…: ${customer.name}\n`;
                message += `ğŸ“ ÙÙˆÙ†: ${customer.phone || 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}\n`;
                message += `ğŸ“Š Ù…ÛÛŒÙ†Û: ${monthName}\n\n`;
                
                message += `*ğŸ“‹ Ø¨Ù„ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª:*\n`;
                entries.forEach((entry, index) => {
                    message += `${index + 1}. ${formatDate(entry.fromDate)} Ø³Û’ ${formatDate(entry.toDate)}\n`;
                    message += `ğŸ¥› Ø¯ÙˆØ¯Ú¾: ${entry.liters} Ù„ÛŒÙ¹Ø±\n`;
                    message += `ğŸ’° Ø±ÛŒÙ¹: ${entry.rate} Ø±ÙˆÙ¾Û’ ÙÛŒ Ù„ÛŒÙ¹Ø±\n`;
                    message += `ğŸ’µ Ø±Ù‚Ù…: ${(entry.liters * entry.rate).toFixed(0)} Ø±ÙˆÙ¾Û’\n\n`;
                });
                
                if (payments.length > 0) {
                    message += `*ğŸ’³ Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª:*\n`;
                    payments.forEach((payment, index) => {
                        message += `${index + 1}. ${formatDate(payment.date)} - ${payment.amount} Ø±ÙˆÙ¾Û’`;
                        message += ` (${paymentMethodNames[payment.method] || payment.method})`;
                        if (payment.notes) message += ` - ${payment.notes}`;
                        message += `\n`;
                    });
                    message += `\n`;
                }
                
                message += `*ğŸ“Š Ú©Ù„ Ø­Ø³Ø§Ø¨:*\n`;
                message += `ğŸ¥› Ú©Ù„ Ø¯ÙˆØ¯Ú¾: ${totalLiters.toFixed(1)} Ù„ÛŒÙ¹Ø±\n`;
                message += `ğŸ“… Ú©Ù„ Ø¯Ù†: ${totalDays}\n`;
                message += `ğŸ’° Ú©Ù„ Ø±Ù‚Ù…: ${totalAmount.toFixed(0)} Ø±ÙˆÙ¾Û’\n`;
                message += `âœ… Ø§Ø¯Ø§ Ø´Ø¯Û: ${paidAmount.toFixed(0)} Ø±ÙˆÙ¾Û’\n`;
                message += `â— Ø¨Ø§Ù‚ÛŒ: ${remainingAmount.toFixed(0)} Ø±ÙˆÙ¾Û’\n\n`;
                
                message += `*ğŸ™ Ø´Ú©Ø±ÛŒÛ Ø¢Ù¾ Ú©Û’ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± Ú©Û’ Ù„ÛŒÛ’!*\n`;
                message += `ğŸ“… ${new Date().toLocaleDateString('ur-PK')}`;
                
                // Encode message for WhatsApp URL
                const encodedMessage = encodeURIComponent(message.trim());
                const whatsappURL = `https://wa.me/?text=${encodedMessage}`;
                
                // Open WhatsApp
                window.open(whatsappURL, '_blank');
                
                showAlert('ğŸ“± WhatsApp Ù¾Ø± Ø´ÛŒØ¦Ø± Ú©Û’ Ù„ÛŒÛ’ ØªÛŒØ§Ø±!');
            } catch (error) {
                console.error('Error sharing via WhatsApp:', error);
                showAlert('WhatsApp Ø´ÛŒØ¦Ø± Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            try {
                const totalCustomers = customers.length;
                const currentMonth = new Date().toISOString().substring(0, 7);
                
                let totalMilkThisMonth = 0;
                let totalRevenueThisMonth = 0;
                let pendingAmount = 0;
                
                customers.forEach(customer => {
                    // Current month entries
                    const currentMonthEntries = customer.entries ? customer.entries.filter(entry => 
                        entry.fromDate && entry.fromDate.startsWith(currentMonth)
                    ) : [];
                    
                    currentMonthEntries.forEach(entry => {
                        totalMilkThisMonth += entry.liters;
                        totalRevenueThisMonth += entry.liters * entry.rate;
                    });
                    
                    // Calculate pending amount for all months
                    if (customer.entries) {
                        customer.entries.forEach(entry => {
                            const entryAmount = entry.liters * entry.rate;
                            const entryMonth = entry.fromDate ? entry.fromDate.substring(0, 7) : currentMonth;
                            
                            // Calculate how much was paid for this month
                            let paidForMonth = 0;
                            if (customer.payments) {
                                customer.payments.filter(p => p.month === entryMonth).forEach(payment => {
                                    paidForMonth += parseFloat(payment.amount);
                                });
                            }
                            
                            // Calculate monthly bill
                            const monthlyEntries = customer.entries.filter(e => 
                                e.fromDate && e.fromDate.startsWith(entryMonth)
                            );
                            const monthlyBill = monthlyEntries.reduce((sum, e) => sum + (e.liters * e.rate), 0);
                            
                            // Add to pending if not fully paid
                            if (paidForMonth < monthlyBill && entry === monthlyEntries[0]) {
                                // Only count once per month
                                pendingAmount += (monthlyBill - paidForMonth);
                            }
                        });
                    }
                });
                
                // Update dashboard cards
                const totalCustomersEl = document.getElementById('total-customers');
                const totalMilkEl = document.getElementById('total-milk');
                const totalRevenueEl = document.getElementById('total-revenue');
                const pendingAmountEl = document.getElementById('pending-amount');
                
                if (totalCustomersEl) totalCustomersEl.textContent = totalCustomers;
                if (totalMilkEl) totalMilkEl.textContent = totalMilkThisMonth.toFixed(1);
                if (totalRevenueEl) totalRevenueEl.textContent = totalRevenueThisMonth.toFixed(0);
                if (pendingAmountEl) pendingAmountEl.textContent = pendingAmount.toFixed(0);
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        // Modal Functions
        function openAddCustomerModal() {
            try {
                const modal = document.getElementById('add-customer-modal');
                if (modal && modal.classList) {
                    modal.classList.add('show');
                }
            } catch (error) {
                console.error('Error opening customer modal:', error);
                showAlert('Ú¯Ø§ÛÚ© ÙØ§Ø±Ù… Ú©Ú¾ÙˆÙ„Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function closeModal() {
            try {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.classList) {
                        modal.classList.remove('show');
                    }
                });
                
                // Reset forms
                document.querySelectorAll('form').forEach(form => {
                    if (form.reset) form.reset();
                });
                
                currentEditEntryId = null;
                
                // Hide payment summary
                const summaryDiv = document.getElementById('payment-summary-info');
                if (summaryDiv) {
                    summaryDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }

        // Backup Functions
        function exportData() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    exportDate: new Date().toISOString(),
                    version: '5.0'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `milk-business-backup-${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
                
                showAlert('ğŸ“¤ ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ ÛÙˆ Ú¯ÛŒØ§!');
            } catch (error) {
                console.error('Error exporting data:', error);
                showAlert('ÚˆÛŒÙ¹Ø§ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function importData() {
            try {
                const fileInput = document.getElementById('import-file');
                if (fileInput) {
                    fileInput.click();
                }
            } catch (error) {
                console.error('Error triggering import:', error);
                showAlert('Ø§Ù…Ù¾ÙˆØ±Ù¹ Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        function handleImportFile(event) {
            try {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.name.endsWith('.json')) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØµØ­ÛŒØ­ JSON ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (!data.customers || !Array.isArray(data.customers)) {
                            showAlert('ØºÙ„Ø· ÙØ§Ø¦Ù„ ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                            return;
                        }
                        
                        if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÚˆÛŒÙ¹Ø§ Ø§Ù…Ù¾ÙˆØ±Ù¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”')) {
                            customers = data.customers || [];
                            nextId = data.nextId || 1;
                            
                            saveToStorage();
                            loadCustomers();
                            updateDashboard();
                            
                            showAlert('ğŸ“¥ ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù…Ù¾ÙˆØ±Ù¹ ÛÙˆ Ú¯ÛŒØ§!');
                        }
                    } catch (error) {
                        console.error('Error parsing import file:', error);
                        showAlert('ÙØ§Ø¦Ù„ Ù¾Ú‘Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                    }
                };
                
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            } catch (error) {
                console.error('Error handling import file:', error);
                showAlert('ÙØ§Ø¦Ù„ ÛÛŒÙ†ÚˆÙ„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // GitHub Backup Functions
        function updateGitHubUI() {
            try {
                const tokenEl = document.getElementById('github-token');
                const repoEl = document.getElementById('github-repo');
                
                if (tokenEl && gitHubSettings.token) {
                    tokenEl.value = gitHubSettings.token;
                }
                if (repoEl && gitHubSettings.repo) {
                    repoEl.value = gitHubSettings.repo;
                }
                
                updateGitHubStatus();
            } catch (error) {
                console.error('Error updating GitHub UI:', error);
            }
        }

        function updateGitHubStatus() {
            try {
                const statusEl = document.getElementById('github-status');
                if (statusEl) {
                    statusEl.textContent = gitHubSettings.token ? 'âœ… Ú©Ù†Ú©Ù¹Úˆ' : 'âŒ ØºÛŒØ± Ú©Ù†Ú©Ù¹Úˆ';
                }
            } catch (error) {
                console.error('Error updating GitHub status:', error);
            }
        }

        function updateBackupStats() {
            try {
                const now = new Date();
                const backupTimeEl = document.getElementById('last-backup-time');
                if (backupTimeEl) {
                    backupTimeEl.textContent = now.toLocaleString('ur-PK');
                }
                
                const dataSize = new Blob([JSON.stringify(customers)]).size;
                const sizeEl = document.getElementById('backup-size');
                if (sizeEl) {
                    sizeEl.textContent = `${(dataSize / 1024).toFixed(2)} KB`;
                }
            } catch (error) {
                console.error('Error updating backup stats:', error);
            }
        }

        async function setupGitHubBackup() {
            try {
                const token = document.getElementById('github-token').value.trim();
                const repo = document.getElementById('github-repo').value.trim();
                
                if (!token || !repo) {
                    showAlert('Ø¨Ø±Ø§Û Ú©Ø±Ù… GitHub Ù¹ÙˆÚ©Ù† Ø§ÙˆØ± Ø±ÛŒÙ¾ÙˆØ²ÛŒÙ¹Ø±ÛŒ Ú©Ø§ Ù†Ø§Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                updateBackupStatus('GitHub Ø³ÛŒÙ¹ Ø§Ù¾...', 'syncing');
                
                // Test GitHub connection
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    gitHubSettings.token = token;
                    gitHubSettings.repo = repo;
                    gitHubSettings.username = userData.login;
                    
                    saveToStorage();
                    showAlert('âœ… GitHub Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ú©Ù†Ú©Ù¹ ÛÙˆ Ú¯ÛŒØ§!');
                    updateBackupStatus('GitHub Ready', 'success');
                    updateGitHubStatus();
                } else {
                    throw new Error('Invalid GitHub token');
                }
            } catch (error) {
                console.error('GitHub setup error:', error);
                showAlert('GitHub Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                updateBackupStatus('GitHub Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function backupToGitHub() {
            try {
                if (!gitHubSettings.token) {
                    showAlert('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                updateBackupStatus('GitHub Ø¨ÛŒÚ© Ø§Ù¾...', 'syncing');
                
                const data = {
                    customers: customers,
                    nextId: nextId,
                    backupDate: new Date().toISOString(),
                    version: '5.0'
                };
                
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const fileName = `backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                
                // Create or update file in GitHub repository
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.username}/${gitHubSettings.repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Milk Business Backup - ${new Date().toLocaleString('ur-PK')}`,
                        content: content
                    })
                });
                
                if (response.ok) {
                    showAlert('â˜ï¸ GitHub Ù…ÛŒÚº Ø¨ÛŒÚ© Ø§Ù¾ Ù…Ú©Ù…Ù„!');
                    updateBackupStatus('Ø¨ÛŒÚ© Ø§Ù¾ Ù…Ú©Ù…Ù„', 'success');
                    updateBackupStats();
                } else {
                    throw new Error('GitHub backup failed');
                }
            } catch (error) {
                console.error('GitHub backup error:', error);
                showAlert('GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                updateBackupStatus('Ø¨ÛŒÚ© Ø§Ù¾ Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function restoreFromGitHub() {
            try {
                if (!gitHubSettings.token) {
                    showAlert('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                updateBackupStatus('GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ...', 'syncing');
                
                // Get list of backup files
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.username}/${gitHubSettings.repo}/contents`, {
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`
                    }
                });
                
                if (response.ok) {
                    const files = await response.json();
                    const backupFiles = files.filter(file => file.name.startsWith('backup_') && file.name.endsWith('.json'));
                    
                    if (backupFiles.length === 0) {
                        showAlert('Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                        updateBackupStatus('Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ Ù†ÛÛŒÚº', 'error');
                        return;
                    }
                    
                    // Get the latest backup file
                    const latestBackup = backupFiles.sort((a, b) => b.name.localeCompare(a.name))[0];
                    
                    // Download and restore
                    const fileResponse = await fetch(latestBackup.download_url);
                    const backupData = await fileResponse.json();
                    
                    if (confirm(`Ú©ÛŒØ§ Ø¢Ù¾ GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ restore Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ\nØ¢Ø®Ø±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾: ${latestBackup.name}\nÙ…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ ÚˆÛŒÙ„ÛŒÙ¹ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”`)) {
                        customers = backupData.customers || [];
                        nextId = backupData.nextId || 1;
                        
                        saveToStorage();
                        loadCustomers();
                        updateDashboard();
                        
                        showAlert('â¬‡ï¸ GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ ÛÙˆ Ú¯ÛŒØ§!');
                        updateBackupStatus('Ø¨Ø­Ø§Ù„ÛŒ Ù…Ú©Ù…Ù„', 'success');
                    }
                } else {
                    throw new Error('GitHub access failed');
                }
            } catch (error) {
                console.error('GitHub restore error:', error);
                showAlert('GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                updateBackupStatus('Ø¨Ø­Ø§Ù„ÛŒ Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        async function testGitHubConnection() {
            try {
                const token = document.getElementById('github-token').value.trim();
                
                if (!token) {
                    showAlert('Ù¾ÛÙ„Û’ GitHub Ù¹ÙˆÚ©Ù† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                
                updateBackupStatus('Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹...', 'syncing');
                
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    showAlert(`âœ… Ú©Ù†Ú©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨! ØµØ§Ø±Ù: ${userData.login}`);
                    updateBackupStatus('Ú©Ù†Ú©Ø´Ù† OK', 'success');
                } else {
                    throw new Error('Invalid token');
                }
            } catch (error) {
                console.error('GitHub connection test failed:', error);
                showAlert('âŒ Ú©Ù†Ú©Ø´Ù† Ù†Ø§Ú©Ø§Ù…: ' + error.message, 'error');
                updateBackupStatus('Ú©Ù†Ú©Ø´Ù† Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function updateBackupStatus(message, type = 'info') {
            try {
                const statusEl = document.getElementById('backup-status');
                if (statusEl) {
                    statusEl.textContent = message;
                }
            } catch (error) {
                console.error('Error updating backup status:', error);
            }
        }

        function updateAutoBackupSettings() {
            try {
                const frequency = parseInt(document.getElementById('auto-backup-frequency').value);
                
                if (autoBackupInterval) {
                    clearInterval(autoBackupInterval);
                    autoBackupInterval = null;
                }
                
                if (frequency > 0 && gitHubSettings.token) {
                    autoBackupInterval = setInterval(() => {
                        backupToGitHub();
                    }, frequency * 60 * 1000);
                    
                    showAlert(`âš™ï¸ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾ ÛØ± ${frequency} Ù…Ù†Ù¹ Ù…ÛŒÚº Ø´Ø±ÙˆØ¹`);
                } else {
                    showAlert('âš™ï¸ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ù†Ø¯');
                }
            } catch (error) {
                console.error('Error updating auto backup settings:', error);
                showAlert('Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÚ© Ø§Ù¾ Ø³ÛŒÙ¹Ù†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
            }
        }

        // Report Functions
        function generateMonthlyReport() {
            showAlert('ğŸ“… Ù…Ø§ÛØ§Ù†Û Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ø®ØµÙˆØµÛŒØª Ø¬Ù„Ø¯ ÛÛŒ Ø¢Ø¦Û’ Ú¯ÛŒ!', 'info');
        }

        function generateCustomerReport() {
            showAlert('ğŸ‘¥ Ú¯Ø§ÛÚ© ÙˆØ§Ø± Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ø®ØµÙˆØµÛŒØª Ø¬Ù„Ø¯ ÛÛŒ Ø¢Ø¦Û’ Ú¯ÛŒ!', 'info');
        }

        function generatePaymentReport() {
            showAlert('ğŸ’³ Ù¾ÛŒÙ…Ù†Ù¹ Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ø®ØµÙˆØµÛŒØª Ø¬Ù„Ø¯ ÛÛŒ Ø¢Ø¦Û’ Ú¯ÛŒ!', 'info');
        }

        // Utility Functions
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ur-PK');
            } catch (error) {
                return dateString;
            }
        }

        function showAlert(message, type = 'success') {
            try {
                const alert = document.createElement('div');
                alert.className = `alert ${type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'info' ? 'info' : ''}`;
                alert.textContent = message;
                
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    if (alert.classList) alert.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    if (alert.classList) alert.classList.remove('show');
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 300);
                }, 3000);
            } catch (error) {
                console.error('Error showing alert:', error);
                // Fallback to console log
                console.log(`${type.toUpperCase()}: ${message}`);
            }
        }

        // Auto-save functionality
        setInterval(() => {
            try {
                if (customers.length > 0) {
                    saveToStorage();
                    console.log('ğŸ’¾ Auto-saved data');
                }
            } catch (error) {
                console.error('Auto-save failed:', error);
            }
        }, 30000); // 30 seconds

        // Auto-backup functionality (if GitHub is configured)
        setInterval(() => {
            try {
                if (gitHubSettings.token && customers.length > 0) {
                    const autoFreq = document.getElementById('auto-backup-frequency');
                    if (autoFreq && parseInt(autoFreq.value) > 0) {
                        console.log('ğŸ”„ Performing auto backup to GitHub...');
                        // Auto backup is handled by updateAutoBackupSettings
                    }
                }
            } catch (error) {
                console.error('Auto-backup check failed:', error);
            }
        }, 60000); // 1 minute

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            try {
                if (e.target && e.target.classList && e.target.classList.contains('modal')) {
                    closeModal();
                }
            } catch (error) {
                console.error('Error handling modal click:', error);
            }
        });

        // Handle beforeunload to save data
        window.addEventListener('beforeunload', function() {
            try {
                saveToStorage();
            } catch (error) {
                console.error('Error saving on beforeunload:', error);
            }
        });

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            try {
                if (event.key === 'Escape') {
                    closeModal();
                } else if (event.ctrlKey && event.key === 's') {
                    event.preventDefault();
                    saveToStorage();
                    showAlert('ğŸ’¾ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§!');
                }
            } catch (error) {
                console.error('Error handling keyboard shortcut:', error);
            }
        });

    </script>
</body>
</html>
