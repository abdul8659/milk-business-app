<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Optimized Version</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Arabic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            overflow-x: auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .backup-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .backup-status.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .backup-status.syncing {
            background: rgba(255, 152, 0, 0.9);
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            overflow-x: auto;
            min-width: 800px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.9);
            border-color: white;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        .content-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 500px;
            overflow-x: auto;
        }

        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .customer-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            transition: transform 0.3s ease;
            position: relative;
        }

        .customer-card:hover {
            transform: translateY(-5px);
        }

        .add-customer-card {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: white;
            text-align: center;
            cursor: pointer;
        }

        .controls-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.success { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); }
        .btn.warning { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); }
        .btn.info { background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); }
        .btn.danger { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .hidden {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .ledger-entries {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .entry-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-right: 4px solid #667eea;
            position: relative;
        }

        .entry-item.delivery {
            border-right-color: #4CAF50;
            background: #f1f8e9;
        }

        .entry-item.payment {
            border-right-color: #2196F3;
            background: #e3f2fd;
        }

        .entry-item.day-off {
            border-right-color: #ff416c;
            background: #fff5f5;
        }

        .entry-actions {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
        }

        .entry-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
            color: white;
            font-weight: bold;
        }

        .edit-btn {
            background: #2196F3;
        }

        .edit-btn:hover {
            background: #1976D2;
            transform: scale(1.1);
        }

        .delete-btn {
            background: #f44336;
        }

        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .entry-content {
            margin-left: 90px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-right: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1976D2;
        }

        .alert-success {
            background: #e8f5e8;
            border-color: #4CAF50;
            color: #2e7d32;
        }

        .github-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .github-form {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .github-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }

        .github-btn {
            background: linear-gradient(135deg, #24292e 0%, #586069 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .github-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Legal Size Print Styles - 8.5" x 14" (215.9mm x 355.6mm) */
        @media print {
            @page {
                size: legal;
                margin: 0.5in;
            }
            
            body {
                background: white !important;
                color: black !important;
                font-size: 11px;
                line-height: 1.3;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-header {
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
                margin-bottom: 15px;
                text-align: center;
            }
            
            .print-header h1 {
                font-size: 18px;
                margin-bottom: 5px;
            }
            
            .print-header h2 {
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .print-customer-info {
                background: #f5f5f5;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 15px;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .print-summary {
                background: #e8f4f8;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 15px;
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                text-align: center;
            }
            
            .print-entries-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 10px;
            }
            
            .print-entries-table th,
            .print-entries-table td {
                border: 1px solid #ccc;
                padding: 5px;
                text-align: right;
            }
            
            .print-entries-table th {
                background: #f0f0f0;
                font-weight: bold;
            }
            
            .print-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 30px;
                background: #f0f0f0;
                border-top: 1px solid #ccc;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .customers-grid {
                grid-template-columns: 1fr;
            }
            
            .main-nav {
                gap: 5px;
                min-width: 100%;
                overflow-x: auto;
            }
            
            .nav-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 12px;
            }

            .entry-content {
                margin-left: 70px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="backup-status" id="backup-status">
        âœ… Ø³Ø³Ù¹Ù… ØªÛŒØ§Ø±
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
            <p>Legal Size Printing + GitHub Backup</p>
        </div>

        <nav class="main-nav">
            <button class="nav-btn active" onclick="showDashboard()">
                ğŸ“ˆ ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ
            </button>
            <button class="nav-btn" onclick="showCustomers()">
                ğŸ‘¥ Ú¯Ø§ÛÚ©
            </button>
            <button class="nav-btn" onclick="showLedger()">
                ğŸ“ Ú©Ú¾Ø§ØªÛ
            </button>
            <button class="nav-btn" onclick="showReports()">
                ğŸ–¨ï¸ Ù¾Ø±Ù†Ù¹ Ø±Ù¾ÙˆØ±Ù¹Ø³
            </button>
            <button class="nav-btn" onclick="showBackup()">
                â˜ï¸ Ø¨ÛŒÚ© Ø§Ù¾
            </button>
        </nav>

        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard-section">
                <h2 class="section-title">ğŸ“ˆ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="total-customers-stat">0</h3>
                        <p>Ú©Ù„ Ú¯Ø§ÛÚ©</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-revenue-stat">0</h3>
                        <p>Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ (Ø±ÙˆÙ¾Û’)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-payments-stat">0</h3>
                        <p>ÙˆØµÙˆÙ„ Ø´Ø¯Û (Ø±ÙˆÙ¾Û’)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="pending-amount-stat">0</h3>
                        <p>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)</p>
                    </div>
                </div>

                <div class="alert alert-success">
                    <h3>ğŸ–¨ï¸ Legal Size Printing + GitHub Backup</h3>
                    <p><strong>Ù†Ø¦Û’ ÙÛŒÚ†Ø±Ø²:</strong></p>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li><strong>Legal Size Printing:</strong> 8.5" x 14" optimized layouts</li>
                        <li><strong>GitHub Auto Backup:</strong> Ø¢Ù¹ÙˆÙ…ÛŒÙ¹Ú© Ú©Ù„Ø§Ø¤Úˆ Ø¨ÛŒÚ© Ø§Ù¾</li>
                        <li><strong>Local Backup:</strong> ÙØ§Ø¦Ù„ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</li>
                        <li><strong>Enhanced Print:</strong> Professional customer ledgers</li>
                        <li><strong>Restore Function:</strong> GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ</li>
                    </ul>
                    <div style="margin-top: 15px;">
                        <button class="btn success" onclick="addSampleData()">ğŸ“ Sample Data Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                        <button class="btn info" onclick="generateLegalSizeLedger()">ğŸ–¨ï¸ Legal Size Test</button>
                    </div>
                </div>
            </div>

            <!-- Customers Section -->
            <div id="customers-section" class="hidden">
                <div class="controls-section">
                    <input type="text" class="search-box" id="customer-search" placeholder="Ú¯Ø§ÛÚ© ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº..." onkeyup="searchCustomers()">
                    <button class="btn success" onclick="showAddCustomerModal()">â• Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                    <button class="btn info" onclick="generateAllCustomersLegalSize()">ğŸ–¨ï¸ ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ù¾Ø±Ù†Ù¹ ÙØ§Ø¦Ù„</button>
                </div>
                <div class="customers-grid" id="customers-grid">
                    <!-- Customers will be loaded here -->
                </div>
            </div>

            <!-- Ledger Section -->
            <div id="ledger-section" class="hidden">
                <div class="controls-section">
                    <h2 id="ledger-title">Ú¯Ø§ÛÚ© Ú©Ø§ Ú©Ú¾Ø§ØªÛ</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn success" onclick="showAddDeliveryModal()">ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                        <button class="btn info" onclick="showAddPaymentModal()">ğŸ’° Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                        <button class="btn warning" onclick="showAddDayOffModal()">ğŸš« Ú†Ú¾Ù¹ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                        <button class="btn" onclick="generateCurrentCustomerLegalSize()">ğŸ–¨ï¸ Legal Size Print</button>
                        <button class="btn" onclick="showCustomers()">â¬…ï¸ ÙˆØ§Ù¾Ø³</button>
                    </div>
                </div>
                
                <div id="ledger-entries" class="ledger-entries">
                    <!-- Entries will be loaded here -->
                </div>

                <div id="bill-summary" style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <!-- Bill summary will be shown here -->
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="hidden">
                <h2 class="section-title">ğŸ–¨ï¸ Legal Size Print Reports</h2>
                
                <div class="alert alert-info">
                    <h3>ğŸ“„ Available Legal Size Reports (8.5" x 14")</h3>
                    <p>All reports optimized for legal size paper with perfect Urdu fonts.</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border: 2px solid #4CAF50;">
                        <h3 style="color: #4CAF50;">ğŸ‘¥ ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹</h3>
                        <p>Complete business overview with all customers</p>
                        <button class="btn success" onclick="generateAllCustomersLegalSize()" style="margin-top: 15px;">ğŸ–¨ï¸ Generate Report</button>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border: 2px solid #2196F3;">
                        <h3 style="color: #2196F3;">ğŸ“‹ Individual Customer Reports</h3>
                        <p>Legal size customer ledgers</p>
                        <button class="btn info" onclick="showCustomers()" style="margin-top: 15px;">ğŸ‘¥ Select Customer</button>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border: 2px solid #ff9800;">
                        <h3 style="color: #ff9800;">ğŸ“Š Business Summary</h3>
                        <p>Monthly and yearly business analysis</p>
                        <button class="btn warning" onclick="generateBusinessSummaryLegalSize()" style="margin-top: 15px;">ğŸ“Š Generate Summary</button>
                    </div>
                </div>
            </div>

            <!-- Backup Section -->
            <div id="backup-section" class="hidden">
                <h2 class="section-title">â˜ï¸ Ø¨ÛŒÚ© Ø§Ù¾ Ø§ÙˆØ± Ø¨Ø­Ø§Ù„ÛŒ</h2>
                
                <!-- GitHub Integration -->
                <div class="github-section">
                    <h3 style="color: #24292e; margin-bottom: 15px;">ğŸ”§ GitHub Integration Setup</h3>
                    <p>Ø¢Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ø±Ú©Ú¾Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ GitHub Ø³Û’ Ú©Ù†Ú©Ù¹ Ú©Ø±ÛŒÚº</p>
                    
                    <div class="alert alert-info" style="margin: 15px 0;">
                        <h4>ğŸ“‹ Ù¾ÛÙ„Û’ ÛŒÛ Ú©Ø§Ù… Ú©Ø±ÛŒÚº:</h4>
                        <ol style="text-align: right; padding-right: 20px; margin: 10px 0;">
                            <li><strong>GitHub Repository Ø¨Ù†Ø§Ø¦ÛŒÚº:</strong> GitHub.com Ù¾Ø± Ø¬Ø§ Ú©Ø± "abdul8659/milk-business-app" Ù†Ø§Ù… Ø³Û’ repository Ø¨Ù†Ø§Ø¦ÛŒÚº</li>
                            <li><strong>Valid GitHub Token Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº:</strong> GitHub Settings > Developer settings > Personal access tokens Ø³Û’ Ù†ÛŒØ§ token Ø¨Ù†Ø§Ø¦ÛŒÚº</li>
                            <li><strong>Repository Public Ø±Ú©Ú¾ÛŒÚº</strong> ÛŒØ§ Ø§Ù¾Ù†Û’ token Ú©Ùˆ proper permissions Ø¯ÛŒÚº</li>
                            <li><strong>Ù†ÛŒÚ†Û’ token Ø§ÙˆØ± repo name Ø¯Ø§Ø®Ù„ Ú©Ø± Ú©Û’ Ú©Ù†Ú©Ù¹ Ú©Ø±ÛŒÚº</strong></li>
                        </ol>
                        <p><strong>âš ï¸ Ù†ÙˆÙ¹:</strong> Ù¾Ø±Ø§Ù†Ø§ token expire ÛÙˆ Ú¯ÛŒØ§ ÛÛ’ØŒ Ù†ÛŒØ§ token Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</p>
                        <p><strong>ğŸ“ Directory Structure:</strong> <code>backups/</code>, <code>reports/customers/</code>, <code>reports/all_customers/</code>, <code>reports/business_summary/</code></p>
                    </div>
                    
                    <div class="github-form">
                        <input type="password" id="github-token" class="github-input" 
                               placeholder="GitHub Personal Access Token (ghp_...)" 
                               value="">
                        <input type="text" id="github-repo" class="github-input" 
                               placeholder="Repository Name (username/repo-name)" 
                               value="abdul8659/milk-business-app">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <button type="button" class="github-btn" onclick="setupGitHubBackup()">
                                ğŸ”§ GitHub Ú©Ù†Ú©Ù¹ Ú©Ø±ÛŒÚº
                            </button>
                            <button type="button" class="github-btn" onclick="manualBackup()">
                                â˜ï¸ ÙÙˆØ±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾
                            </button>
                            <button type="button" class="github-btn" onclick="restoreFromGitHub()">
                                â¬‡ï¸ GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ
                            </button>
                            <button type="button" class="github-btn" onclick="testGitHubConnection()">
                                ğŸ”— Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Auto Backup Settings -->
                <div class="github-section">
                    <h3 style="color: #2196F3; margin-bottom: 15px;">â° Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ Ø³ÛŒÙ¹Ù†Ú¯Ø²</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: end;">
                        <div>
                            <label>Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø§ ÙˆÙ‚ÙÛ:</label>
                            <select id="backup-interval" onchange="updateBackupInterval()" class="github-input">
                                <option value="0">Ø¨Ù†Ø¯</option>
                                <option value="5" selected>5 Ù…Ù†Ù¹</option>
                                <option value="10">10 Ù…Ù†Ù¹</option>
                                <option value="30">30 Ù…Ù†Ù¹</option>
                                <option value="60">1 Ú¯Ú¾Ù†Ù¹Û</option>
                            </select>
                        </div>
                        <div>
                            <label>Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾:</label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="auto-backup-enabled" checked onchange="toggleAutoBackup()">
                                <span>ÙØ¹Ø§Ù„ Ú©Ø±ÛŒÚº</span>
                            </label>
                        </div>
                        <div>
                            <button type="button" class="btn info" onclick="downloadLocalBackup()" style="width: 100%;">
                                ğŸ’¾ Local Backup
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Backup Status -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="last-backup-time">Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº</h3>
                        <p>Ø¢Ø®Ø±ÛŒ Ø¨ÛŒÚ© Ø§Ù¾</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="backup-size">0 KB</h3>
                        <p>ÚˆÛŒÙ¹Ø§ Ø³Ø§Ø¦Ø²</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="github-status">âŒ</h3>
                        <p>GitHub Status</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="backup-count">0</h3>
                        <p>Ú©Ù„ Ø¨ÛŒÚ© Ø§Ù¾Ø³</p>
                    </div>
                </div>

                <!-- Manual Restore -->
                <div class="github-section">
                    <h3 style="color: #ff9800; margin-bottom: 15px;">ğŸ“‚ Manual Restore</h3>
                    <p>Local backup file Ø³Û’ data restore Ú©Ø±ÛŒÚº</p>
                    <div style="display: flex; gap: 15px; align-items: end; margin-top: 15px;">
                        <input type="file" id="restore-file" accept=".json" class="github-input" style="flex: 1;">
                        <button type="button" class="btn warning" onclick="restoreFromFile()">
                            ğŸ“‚ File Ø³Û’ Restore
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Customer Modal -->
    <div id="add-customer-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h3>
            <div class="form-group">
                <label>Ù†Ø§Ù…:</label>
                <input type="text" id="customer-name" placeholder="Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù…">
            </div>
            <div class="form-group">
                <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø±:</label>
                <input type="tel" id="customer-phone" placeholder="03xxxxxxxxx">
            </div>
            <div class="form-group">
                <label>Ù¾ØªÛ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                <textarea id="customer-address" placeholder="Ú¯Ø§ÛÚ© Ú©Ø§ Ù¾ØªÛ"></textarea>
            </div>
            <button class="btn success" onclick="addCustomer()">Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Add Delivery Modal -->
    <div id="add-delivery-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="delivery-modal-title">Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</h3>
            <div class="form-group">
                <label>Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="delivery-from-date">
            </div>
            <div class="form-group">
                <label>Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="delivery-to-date">
            </div>
            <div class="form-group">
                <label>Ø±ÙˆØ²Ø§Ù†Û Ù„ÛŒÙ¹Ø±:</label>
                <input type="number" id="delivery-liters" placeholder="Ø¬ÛŒØ³Û’ 2" step="0.1">
            </div>
            <div class="form-group">
                <label>ÙÛŒ Ù„ÛŒÙ¹Ø± Ø±ÛŒÙ¹:</label>
                <input type="number" id="delivery-rate" placeholder="Ø¬ÛŒØ³Û’ 120" step="0.1">
            </div>
            <div class="form-group">
                <label>ØªØ¨ØµØ±Û (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                <textarea id="delivery-note" placeholder="Ú©ÙˆØ¦ÛŒ Ø®Ø§Øµ Ø¨Ø§Øª"></textarea>
            </div>
            <button class="btn success" id="delivery-submit-btn" onclick="addDelivery()">Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div id="add-payment-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ø±Ù‚Ù… Ú©ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</h3>
            <div class="form-group">
                <label>Ø±Ù‚Ù…:</label>
                <input type="number" id="payment-amount" placeholder="Ø§Ø¯Ø§ Ø´Ø¯Û Ø±Ù‚Ù…">
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="payment-date">
            </div>
            <div class="form-group">
                <label>ØªØ¨ØµØ±Û:</label>
                <textarea id="payment-note" placeholder="Ú©ÙˆØ¦ÛŒ Ø®Ø§Øµ Ø¨Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>
            </div>
            <button class="btn success" onclick="addPayment()">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <!-- Add Day Off Modal -->
    <div id="add-day-off-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</h3>
            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="day-off-date">
            </div>
            <div class="form-group">
                <label>ÙˆØ¬Û:</label>
                <textarea id="day-off-reason" placeholder="Ú†Ú¾Ù¹ÛŒ Ú©ÛŒ ÙˆØ¬Û"></textarea>
            </div>
            <button class="btn warning" onclick="addDayOff()">Ú†Ú¾Ù¹ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <script>
        // Global variables
        let customers = [];
        let currentCustomerId = null;
        let nextId = 1;
        let editingEntryId = null;
        let backupInterval = null;
        let gitHubSettings = {
            token: '',
            repo: '',
            username: ''
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadFromStorage();
            showDashboard();
            updateDashboard();
            loadCustomers();
            initializeBackupSettings();
        }

        // =================== STORAGE FUNCTIONS ===================
        
        function saveToStorage() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    gitHubSettings: gitHubSettings,
                    lastSaved: new Date().toISOString(),
                    version: '6.0'
                };
                
                localStorage.setItem('milkBusinessData', JSON.stringify(data));
                updateBackupStatus('âœ… ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ø´Ø¯Û');
                updateBackupSize();
                
            } catch (error) {
                console.error('Storage save error:', error);
                updateBackupStatus('âŒ Ù…Ø­ÙÙˆØ¸ÛŒØª Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function loadFromStorage() {
            try {
                const data = localStorage.getItem('milkBusinessData');
                if (data) {
                    const parsed = JSON.parse(data);
                    customers = parsed.customers || [];
                    nextId = parsed.nextId || 1;
                    gitHubSettings = parsed.gitHubSettings || { token: '', repo: '', username: '' };
                    
                    // Load GitHub settings to form
                    if (gitHubSettings.token) {
                        document.getElementById('github-token').value = gitHubSettings.token;
                    }
                    if (gitHubSettings.repo) {
                        document.getElementById('github-repo').value = gitHubSettings.repo;
                    }
                }
            } catch (error) {
                console.error('Storage load error:', error);
                customers = [];
                nextId = 1;
                gitHubSettings = { token: '', repo: '', username: '' };
            }
        }

        // =================== GITHUB BACKUP FUNCTIONS ===================
        
        async function setupGitHubBackup() {
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            
            if (!token || !repo) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… GitHub Ù¹ÙˆÚ©Ù† Ø§ÙˆØ± Ø±ÛŒÙ¾ÙˆØ²ÛŒÙ¹Ø±ÛŒ Ú©Ø§ Ù†Ø§Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            updateBackupStatus('ğŸ”§ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                // Test GitHub user authentication
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'Milk-Business-App/1.0'
                    }
                });
                
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    
                    // Test repository access
                    const repoResponse = await fetch(`https://api.github.com/repos/${repo}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                            'User-Agent': 'Milk-Business-App/1.0'
                        }
                    });
                    
                    let repoExists = false;
                    let repoData = null;
                    
                    if (repoResponse.ok) {
                        repoData = await repoResponse.json();
                        repoExists = true;
                    } else if (repoResponse.status === 404) {
                        // Repository doesn't exist, we can still save settings
                        console.log('Repository not found, but user is valid');
                    } else {
                        throw new Error(`Repository access error: ${repoResponse.status}`);
                    }
                    
                    // Save GitHub settings
                    gitHubSettings.token = token;
                    gitHubSettings.repo = repo;
                    gitHubSettings.username = userData.login;
                    
                    saveToStorage();
                    updateGitHubStatus('âœ… Connected');
                    
                    if (repoExists) {
                        // Create initial directory structure
                        await initializeGitHubStructure();
                        
                        showNotification(`âœ… GitHub Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ú©Ù†Ú©Ù¹!\nUser: ${userData.login}\nRepo: ${repoData.full_name}\nAccess: ${repoData.permissions?.push ? 'Full' : 'Read'}`, 'success');
                        updateBackupStatus('âœ… GitHub ØªÛŒØ§Ø± - Structure initialized');
                    } else {
                        showNotification(`âš ï¸ GitHub User OK!\nUser: ${userData.login}\nRepo: ${repo} (Ù†ÛÛŒÚº Ù…Ù„ÛŒ)\nÙ¾ÛÙ„Û’ GitHub Ù¾Ø± "${repo}" repository Ø¨Ù†Ø§Ø¦ÛŒÚº`, 'warning');
                        updateBackupStatus('âš ï¸ GitHub OK - Create repository first');
                    }
                    
                    // Start auto backup if enabled
                    if (document.getElementById('auto-backup-enabled').checked) {
                        startAutoBackup();
                        showNotification('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ Ø´Ø±ÙˆØ¹ ÛÙˆ Ú¯ÛŒØ§!', 'info');
                    }
                } else {
                    const errorData = await userResponse.json();
                    throw new Error(`Invalid GitHub token: ${errorData.message || userResponse.status}`);
                }
            } catch (error) {
                console.error('GitHub setup error:', error);
                showNotification('âŒ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                updateBackupStatus('âŒ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ ÙÛŒÙ„', 'error');
                updateGitHubStatus('âŒ Error');
            }
        }

        async function initializeGitHubStructure() {
            if (!gitHubSettings.token || !gitHubSettings.repo) {
                return;
            }
            
            try {
                // Create main README for the repository
                const mainReadme = `# ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Milk Business Data

## Directory Structure

- **ğŸ“ backups/** - JSON backup files
- **ğŸ“ reports/customers/** - Individual customer HTML reports  
- **ğŸ“ reports/all_customers/** - Combined customer reports
- **ğŸ“ reports/business_summary/** - Business analysis reports

## App Info
- Generated by: Milk Business Management App
- Version: 6.0
- Created: ${new Date().toLocaleString('ur-PK')}
- Total Customers: ${customers.length}

## Usage
All files are automatically generated and organized by the app.
Each customer gets their own folder for reports.
`;
                
                await saveHTMLToGitHub(mainReadme, 'README.md', '');
                
                // Create directory structure
                await createGitHubDirectory('backups');
                await createGitHubDirectory('reports');
                await createGitHubDirectory('reports/customers'); 
                await createGitHubDirectory('reports/all_customers');
                await createGitHubDirectory('reports/business_summary');
                
                console.log('GitHub repository structure initialized');
            } catch (error) {
                console.error('Structure initialization error:', error);
            }
        }

        async function testGitHubConnection() {
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            
            if (!token) {
                showNotification('Ù¾ÛÙ„Û’ GitHub Ù¹ÙˆÚ©Ù† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            updateBackupStatus('ğŸ”— Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                // Test user authentication
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'Milk-Business-App/1.0'
                    }
                });
                
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    
                    // Test repository access if repo is provided
                    if (repo) {
                        try {
                            const repoResponse = await fetch(`https://api.github.com/repos/${repo}`, {
                                headers: {
                                    'Authorization': `token ${token}`,
                                    'Content-Type': 'application/json',
                                    'User-Agent': 'Milk-Business-App/1.0'
                                }
                            });
                            
                            if (repoResponse.ok) {
                                const repoData = await repoResponse.json();
                                showNotification(`âœ… Ù…Ú©Ù…Ù„ Ú©Ù†Ú©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨!\nUser: ${userData.login}\nRepo: ${repoData.full_name}\nPermissions: ${repoData.permissions?.push ? 'Write âœ“' : 'Read Only'}`, 'success');
                                updateBackupStatus('âœ… GitHub ØªÛŒØ§Ø± - User: ' + userData.login);
                                updateGitHubStatus('âœ… Connected');
                            } else if (repoResponse.status === 404) {
                                showNotification(`âš ï¸ User Ú©Ù†Ú©Ø´Ù† OK Ù„ÛŒÚ©Ù† Repository Ù†ÛÛŒÚº Ù…Ù„ÛŒ!\nUser: ${userData.login}\nRepo: ${repo}\nÚ©ÛŒØ§ Ø¢Ù¾ Ù†Û’ repository Ø¨Ù†Ø§Ø¦ÛŒ ÛÛ’?`, 'warning');
                                updateBackupStatus('âš ï¸ Repository Ù†ÛÛŒÚº Ù…Ù„ÛŒ');
                            } else {
                                throw new Error(`Repository access failed: ${repoResponse.status}`);
                            }
                        } catch (repoError) {
                            showNotification(`âš ï¸ User OKØŒ Repository Error!\nUser: ${userData.login}\nRepo Error: ${repoError.message}`, 'warning');
                            updateBackupStatus('âš ï¸ Repository error');
                        }
                    } else {
                        showNotification(`âœ… Token Ú©Ù†Ú©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨!\nUser: ${userData.login}\nRepository Ù†Ø§Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº`, 'success');
                        updateBackupStatus('âœ… Token OK - Repository needed');
                    }
                } else {
                    throw new Error(`Invalid token: ${userResponse.status}`);
                }
            } catch (error) {
                console.error('Connection test error:', error);
                showNotification('âŒ Ú©Ù†Ú©Ø´Ù† ÙÛŒÙ„: ' + error.message, 'error');
                updateBackupStatus('âŒ Ú©Ù†Ú©Ø´Ù† Ù¹ÛŒØ³Ù¹ ÙÛŒÙ„', 'error');
                updateGitHubStatus('âŒ Error');
            }
        }

        // =================== GITHUB HTML STORAGE FUNCTIONS ===================
        
        async function saveHTMLToGitHub(htmlContent, fileName, folderPath = '') {
            if (!gitHubSettings.token || !gitHubSettings.repo) {
                showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                return false;
            }
            
            try {
                const fullPath = folderPath ? `${folderPath}/${fileName}` : fileName;
                const content = btoa(unescape(encodeURIComponent(htmlContent)));
                
                // Check if file exists (for updates)
                let sha = null;
                try {
                    const checkResponse = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/${fullPath}`, {
                        headers: {
                            'Authorization': `token ${gitHubSettings.token}`,
                            'User-Agent': 'Milk-Business-App/1.0'
                        }
                    });
                    if (checkResponse.ok) {
                        const fileData = await checkResponse.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // File doesn't exist, which is fine
                }
                
                const body = {
                    message: `ğŸ“„ HTML Report: ${fileName} - ${new Date().toLocaleString('ur-PK')}`,
                    content: content,
                    committer: {
                        name: "Milk Business App",
                        email: "reports@milkbusiness.app"
                    }
                };
                
                if (sha) {
                    body.sha = sha;
                }
                
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/${fullPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'Milk-Business-App/1.0'
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const responseData = await response.json();
                    console.log('HTML saved to GitHub:', responseData.content.html_url);
                    return responseData.content.html_url;
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'HTML save failed');
                }
                
            } catch (error) {
                console.error('HTML save error:', error);
                showNotification('âŒ HTML GitHub save Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                return false;
            }
        }

        async function createGitHubDirectory(dirPath) {
            if (!gitHubSettings.token || !gitHubSettings.repo) {
                return false;
            }
            
            try {
                // Create a README file in the directory to ensure it exists
                const readmeContent = `# ${dirPath}\n\nGenerated by Milk Business App\nCreated: ${new Date().toLocaleString('ur-PK')}`;
                const content = btoa(unescape(encodeURIComponent(readmeContent)));
                
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/${dirPath}/README.md`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'Milk-Business-App/1.0'
                    },
                    body: JSON.stringify({
                        message: `ğŸ“ Create directory: ${dirPath}`,
                        content: content,
                        committer: {
                            name: "Milk Business App",
                            email: "setup@milkbusiness.app"
                        }
                    })
                });
                
                return response.ok;
            } catch (error) {
                console.error('Directory creation error:', error);
                return false;
            }
        }

        // =================== ENHANCED BACKUP WITH DIRECTORY STRUCTURE ===================
        
        async function manualBackup() {
            if (!gitHubSettings.token || !gitHubSettings.repo) {
                showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            updateBackupStatus('â˜ï¸ GitHub Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...', 'syncing');
            
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    backupDate: new Date().toISOString(),
                    version: '6.0',
                    metadata: {
                        totalCustomers: customers.length,
                        totalEntries: customers.reduce((sum, c) => sum + (c.entries ? c.entries.length : 0), 0),
                        appName: 'Milk Business Management',
                        backupType: 'manual'
                    }
                };
                
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const fileName = `backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                const backupPath = `backups/${fileName}`;
                
                // Ensure backups directory exists
                await createGitHubDirectory('backups');
                
                const body = {
                    message: `ğŸ’¾ Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø± - Backup ${new Date().toLocaleString('ur-PK')} - ${customers.length} customers`,
                    content: content,
                    committer: {
                        name: "Milk Business App",
                        email: "backup@milkbusiness.app"
                    }
                };
                
                const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/${backupPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubSettings.token}`,
                        'Content-Type': 'application/json',
                        'User-Agent': 'Milk-Business-App/1.0'
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const responseData = await response.json();
                    showNotification('âœ… GitHub Ù…ÛŒÚº Ø¨ÛŒÚ© Ø§Ù¾ Ù…Ú©Ù…Ù„!', 'success');
                    updateBackupStatus('âœ… Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø§Ù…ÛŒØ§Ø¨ - Ø¢Ø®Ø±ÛŒ: ' + new Date().toLocaleTimeString('ur-PK'));
                    updateLastBackupTime();
                    updateBackupCount();
                    console.log('Backup successful:', responseData.content.html_url);
                } else {
                    const errorData = await response.json();
                    console.error('GitHub API Error:', errorData);
                    throw new Error(errorData.message || 'Backup failed');
                }
                
            } catch (error) {
                console.error('Backup error:', error);
                showNotification('âŒ Ø¨ÛŒÚ© Ø§Ù¾ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                updateBackupStatus('âŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙÛŒÙ„', 'error');
            }
        }

        async function restoreFromGitHub() {
            if (!gitHubSettings.token || !gitHubSettings.repo) {
                showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ GitHub Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ø®ØªÙ… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”', async () => {
                updateBackupStatus('â¬‡ï¸ GitHub Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ...', 'syncing');
                
                try {
                    // Get list of backup files from the backups directory
                    const response = await fetch(`https://api.github.com/repos/${gitHubSettings.repo}/contents/backups`, {
                        headers: {
                            'Authorization': `token ${gitHubSettings.token}`,
                            'Content-Type': 'application/json',
                            'User-Agent': 'Milk-Business-App/1.0'
                        }
                    });
                    
                    if (response.ok) {
                        const files = await response.json();
                        const backupFiles = files.filter(file => 
                            file.name.startsWith('backup_') && 
                            file.name.endsWith('.json') &&
                            file.type === 'file'
                        );
                        
                        if (backupFiles.length === 0) {
                            throw new Error('Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù†ÛÛŒÚº Ù…Ù„ÛŒ');
                        }
                        
                        // Get the latest backup file (sort by name - newest first)
                        const latestBackup = backupFiles.sort((a, b) => b.name.localeCompare(a.name))[0];
                        console.log('Latest backup found:', latestBackup.name);
                        
                        // Fetch the backup file content
                        const fileResponse = await fetch(latestBackup.download_url, {
                            headers: {
                                'Authorization': `token ${gitHubSettings.token}`,
                                'User-Agent': 'Milk-Business-App/1.0'
                            }
                        });
                        
                        if (fileResponse.ok) {
                            const backupData = await fileResponse.json();
                            
                            // Validate backup data structure
                            if (!backupData.customers || !Array.isArray(backupData.customers)) {
                                throw new Error('Invalid backup file format');
                            }
                            
                            // Restore data
                            customers = backupData.customers;
                            nextId = backupData.nextId || 1;
                            
                            saveToStorage();
                            loadCustomers();
                            updateDashboard();
                            
                            showNotification(`âœ… Ø¨Ø­Ø§Ù„ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨! ${latestBackup.name} Ø³Û’ ${customers.length} Ú¯Ø§ÛÚ© Ø¨Ø­Ø§Ù„ ÛÙˆØ¦Û’`, 'success');
                            updateBackupStatus('âœ… Ø¨Ø­Ø§Ù„ÛŒ Ù…Ú©Ù…Ù„ - ' + new Date().toLocaleTimeString('ur-PK'));
                            
                            console.log('Restore successful from:', latestBackup.name);
                            console.log('Restored customers:', customers.length);
                        } else {
                            throw new Error('ÙØ§Ø¦Ù„ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ÛŒ: ' + fileResponse.status);
                        }
                    } else {
                        const errorData = await response.json();
                        throw new Error('Ø¨ÛŒÚ© Ø§Ù¾ ÙÙˆÙ„ÚˆØ± ØªÚ© Ø±Ø³Ø§Ø¦ÛŒ Ù†ÛÛŒÚº: ' + errorData.message);
                    }
                    
                } catch (error) {
                    console.error('Restore error:', error);
                    showNotification('âŒ Ø¨Ø­Ø§Ù„ÛŒ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message, 'error');
                    updateBackupStatus('âŒ Ø¨Ø­Ø§Ù„ÛŒ ÙÛŒÙ„', 'error');
                }
            });
        }

        // =================== AUTO BACKUP FUNCTIONS ===================
        
        function initializeBackupSettings() {
            const autoBackupEnabled = document.getElementById('auto-backup-enabled').checked;
            if (autoBackupEnabled && gitHubSettings.token && gitHubSettings.repo) {
                startAutoBackup();
            }
            updateBackupSize();
            updateGitHubStatus(gitHubSettings.token ? 'âœ… Ready' : 'âŒ Not Setup');
        }

        function toggleAutoBackup() {
            const enabled = document.getElementById('auto-backup-enabled').checked;
            if (enabled) {
                if (gitHubSettings.token && gitHubSettings.repo) {
                    startAutoBackup();
                    showNotification('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ¹Ø§Ù„', 'success');
                } else {
                    showNotification('Ù¾ÛÙ„Û’ GitHub Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº', 'error');
                    document.getElementById('auto-backup-enabled').checked = false;
                }
            } else {
                stopAutoBackup();
                showNotification('Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ù†Ø¯', 'info');
            }
        }

        function updateBackupInterval() {
            const interval = parseInt(document.getElementById('backup-interval').value);
            if (interval > 0 && document.getElementById('auto-backup-enabled').checked) {
                stopAutoBackup();
                startAutoBackup();
                showNotification(`Ø¨ÛŒÚ© Ø§Ù¾ ÙˆÙ‚ÙÛ: ${interval} Ù…Ù†Ù¹`, 'info');
            }
        }

        function startAutoBackup() {
            stopAutoBackup(); // Clear any existing interval
            
            const interval = parseInt(document.getElementById('backup-interval').value);
            if (interval > 0) {
                backupInterval = setInterval(() => {
                    manualBackup();
                }, interval * 60 * 1000);
                
                updateBackupStatus(`â° Ø¢Ù¹Ùˆ Ø¨ÛŒÚ© Ø§Ù¾: ${interval} Ù…Ù†Ù¹`);
            }
        }

        function stopAutoBackup() {
            if (backupInterval) {
                clearInterval(backupInterval);
                backupInterval = null;
            }
        }

        // =================== LOCAL BACKUP FUNCTIONS ===================
        
        function downloadLocalBackup() {
            try {
                const data = {
                    customers: customers,
                    nextId: nextId,
                    backupDate: new Date().toISOString(),
                    version: '6.0',
                    metadata: {
                        totalCustomers: customers.length,
                        totalEntries: customers.reduce((sum, c) => sum + (c.entries ? c.entries.length : 0), 0)
                    }
                };
                
                const content = JSON.stringify(data, null, 2);
                const blob = new Blob([content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `milk_business_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('ğŸ“¥ Local backup ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ù…Ú©Ù…Ù„!', 'success');
                updateBackupStatus('ğŸ“¥ Local backup ØªÛŒØ§Ø±');
                
            } catch (error) {
                console.error('Local backup error:', error);
                showNotification('âŒ Local backup Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ', 'error');
            }
        }

        function restoreFromFile() {
            const fileInput = document.getElementById('restore-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Ù¾ÛÙ„Û’ ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÙØ§Ø¦Ù„ Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ø®ØªÙ… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”', () => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Validate backup data
                        if (!backupData.customers || !Array.isArray(backupData.customers)) {
                            throw new Error('Invalid backup file format');
                        }
                        
                        // Restore data
                        customers = backupData.customers;
                        nextId = backupData.nextId || 1;
                        
                        saveToStorage();
                        loadCustomers();
                        updateDashboard();
                        
                        showNotification('âœ… ÙØ§Ø¦Ù„ Ø³Û’ Ø¨Ø­Ø§Ù„ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨!', 'success');
                        updateBackupStatus('âœ… ÙØ§Ø¦Ù„ Ø¨Ø­Ø§Ù„ÛŒ Ù…Ú©Ù…Ù„');
                        
                        // Clear file input
                        fileInput.value = '';
                        
                    } catch (error) {
                        console.error('File restore error:', error);
                        showNotification('âŒ ÙØ§Ø¦Ù„ Ø¨Ø­Ø§Ù„ÛŒ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: Invalid format', 'error');
                    }
                };
                reader.readAsText(file);
            });
        }

        // =================== BACKUP STATUS FUNCTIONS ===================
        
        function updateBackupStatus(message, type = 'success') {
            const statusEl = document.getElementById('backup-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = 'backup-status';
                if (type === 'error') statusEl.classList.add('error');
                if (type === 'syncing') statusEl.classList.add('syncing');
            }
        }

        function updateBackupSize() {
            const data = JSON.stringify({ customers, nextId });
            const sizeKB = Math.round(new Blob([data]).size / 1024);
            const sizeEl = document.getElementById('backup-size');
            if (sizeEl) {
                sizeEl.textContent = `${sizeKB} KB`;
            }
        }

        function updateLastBackupTime() {
            const timeEl = document.getElementById('last-backup-time');
            if (timeEl) {
                timeEl.textContent = new Date().toLocaleString('ur-PK');
            }
        }

        function updateGitHubStatus(status) {
            const statusEl = document.getElementById('github-status');
            if (statusEl) {
                statusEl.textContent = status;
            }
        }

        function updateBackupCount() {
            const countEl = document.getElementById('backup-count');
            if (countEl) {
                let count = parseInt(localStorage.getItem('backupCount') || '0');
                count++;
                localStorage.setItem('backupCount', count.toString());
                countEl.textContent = count.toString();
            }
        }

        // =================== LEGAL SIZE PRINT FUNCTIONS ===================
        
        async function generateCurrentCustomerLegalSize() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            await generateCustomerLegalSize(currentCustomerId);
        }

        async function generateCustomerLegalSize(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) {
                showNotification('Ú¯Ø§ÛÚ© Ù†ÛÛŒÚº Ù…Ù„Ø§', 'error');
                return;
            }
            
            const htmlContent = createCustomerLegalSizeHTML(customer);
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = `${customer.name.replace(/[^a-zA-Z0-9\u0600-\u06FF]/g, '_')}_LegalSize_${dateStr}.html`;
            
            // Download locally
            downloadHTMLFile(htmlContent, fileName);
            
            // Also save to GitHub if connected
            if (gitHubSettings.token && gitHubSettings.repo) {
                try {
                    const customerFolderName = customer.name.replace(/[^a-zA-Z0-9\u0600-\u06FF]/g, '_');
                    const folderPath = `reports/customers/${customerFolderName}`;
                    
                    // Ensure customer directory exists
                    await createGitHubDirectory(folderPath);
                    
                    const githubUrl = await saveHTMLToGitHub(htmlContent, fileName, folderPath);
                    if (githubUrl) {
                        showNotification(`${customer.name} Ú©ÛŒ Legal Size Ù¾Ø±Ù†Ù¹ ÙØ§Ø¦Ù„ ØªÛŒØ§Ø± Ø§ÙˆØ± GitHub Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸!`, 'success');
                        console.log('Customer report saved to GitHub:', githubUrl);
                    } else {
                        showNotification(`${customer.name} Ú©ÛŒ Legal Size Ù¾Ø±Ù†Ù¹ ÙØ§Ø¦Ù„ ØªÛŒØ§Ø±! (GitHub save ÙÛŒÙ„)`, 'warning');
                    }
                } catch (error) {
                    console.error('GitHub save error:', error);
                    showNotification(`${customer.name} Ú©ÛŒ Legal Size Ù¾Ø±Ù†Ù¹ ÙØ§Ø¦Ù„ ØªÛŒØ§Ø±! (Local only)`, 'success');
                }
            } else {
                showNotification(`${customer.name} Ú©ÛŒ Legal Size Ù¾Ø±Ù†Ù¹ ÙØ§Ø¦Ù„ ØªÛŒØ§Ø±!`, 'success');
            }
        }

        async function generateAllCustomersLegalSize() {
            if (customers.length === 0) {
                showNotification('Ú©ÙˆØ¦ÛŒ Ú¯Ø§ÛÚ© Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº', 'warning');
                return;
            }
            
            const htmlContent = createAllCustomersLegalSizeHTML();
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = `All_Customers_LegalSize_${dateStr}.html`;
            
            // Download locally
            downloadHTMLFile(htmlContent, fileName);
            
            // Also save to GitHub if connected
            if (gitHubSettings.token && gitHubSettings.repo) {
                try {
                    const folderPath = 'reports/all_customers';
                    
                    // Ensure directory exists
                    await createGitHubDirectory(folderPath);
                    
                    const githubUrl = await saveHTMLToGitHub(htmlContent, fileName, folderPath);
                    if (githubUrl) {
                        showNotification('ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± Ø§ÙˆØ± GitHub Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸!', 'success');
                        console.log('All customers report saved to GitHub:', githubUrl);
                    } else {
                        showNotification('ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±! (GitHub save ÙÛŒÙ„)', 'warning');
                    }
                } catch (error) {
                    console.error('GitHub save error:', error);
                    showNotification('ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±! (Local only)', 'success');
                }
            } else {
                showNotification('ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±!', 'success');
            }
        }

        async function generateBusinessSummaryLegalSize() {
            const htmlContent = createBusinessSummaryLegalSizeHTML();
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = `Business_Summary_LegalSize_${dateStr}.html`;
            
            // Download locally
            downloadHTMLFile(htmlContent, fileName);
            
            // Also save to GitHub if connected
            if (gitHubSettings.token && gitHubSettings.repo) {
                try {
                    const folderPath = 'reports/business_summary';
                    
                    // Ensure directory exists
                    await createGitHubDirectory(folderPath);
                    
                    const githubUrl = await saveHTMLToGitHub(htmlContent, fileName, folderPath);
                    if (githubUrl) {
                        showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± Ø§ÙˆØ± GitHub Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸!', 'success');
                        console.log('Business summary saved to GitHub:', githubUrl);
                    } else {
                        showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±! (GitHub save ÙÛŒÙ„)', 'warning');
                    }
                } catch (error) {
                    console.error('GitHub save error:', error);
                    showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±! (Local only)', 'success');
                }
            } else {
                showNotification('Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ Legal Size Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø±!', 'success');
            }
        }

        async function generateLegalSizeLedger() {
            if (customers.length === 0) {
                showNotification('Ù¾ÛÙ„Û’ sample data Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº', 'warning');
                return;
            }
            
            // Generate for first customer as test
            await generateCustomerLegalSize(customers[0].id);
        }

        function createCustomerLegalSizeHTML(customer) {
            // Calculate totals
            let totalRevenue = 0;
            let totalPayments = 0;
            let deliveryEntries = [];
            let paymentEntries = [];
            let dayOffEntries = [];
            
            if (customer.entries) {
                customer.entries.forEach(entry => {
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const totalLiters = days * entry.liters;
                        const amount = totalLiters * entry.rate;
                        totalRevenue += amount;
                        
                        deliveryEntries.push({
                            ...entry,
                            days: days,
                            totalLiters: totalLiters,
                            amount: amount
                        });
                    } else if (entry.type === 'payment') {
                        totalPayments += parseFloat(entry.amount);
                        paymentEntries.push(entry);
                    } else if (entry.type === 'day-off') {
                        dayOffEntries.push(entry);
                    }
                });
            }
            
            const remaining = totalRevenue - totalPayments;
            
            // Sort entries by date (newest first)
            deliveryEntries.sort((a, b) => new Date(b.fromDate) - new Date(a.fromDate));
            paymentEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            dayOffEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const html = `<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${customer.name} - Legal Size Ledger</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans Arabic', 'Segoe UI', Tahoma, sans-serif;
            direction: rtl;
            line-height: 1.4;
            color: #333;
            background: #fff;
            padding: 20px;
        }
        
        @page {
            size: legal; /* 8.5" x 14" */
            margin: 0.5in;
        }
        
        .print-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .print-header h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .print-header h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .print-header p {
            color: #666;
            font-size: 12px;
        }
        
        .print-customer-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-right: 4px solid #667eea;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .info-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .info-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .info-item span {
            font-size: 11px;
        }
        
        .print-summary {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .summary-item {
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #2196F3;
        }
        
        .summary-item h3 {
            color: #2196F3;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .summary-item p {
            font-size: 10px;
            color: #666;
        }
        
        .print-entries-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
            margin-bottom: 15px;
        }
        
        .print-entries-table th,
        .print-entries-table td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: right;
            vertical-align: top;
        }
        
        .print-entries-table th {
            background: #f0f0f0;
            font-weight: bold;
            font-size: 10px;
        }
        
        .print-entries-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .section-title {
            color: #333;
            font-size: 14px;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        
        .amount-positive { color: #4CAF50; font-weight: bold; }
        .amount-negative { color: #f44336; font-weight: bold; }
        .amount-neutral { color: #2196F3; font-weight: bold; }
        
        .final-summary {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }
        
        .final-summary h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .final-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .final-item {
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #4CAF50;
        }
        
        .final-item h4 {
            color: #2e7d32;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .final-item .value {
            font-size: 16px;
            font-weight: 700;
            color: #1b5e20;
        }
        
        .print-footer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
            font-size: 10px;
        }
        
        @media print {
            body { 
                padding: 0; 
                background: white;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="print-header">
        <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
        <h2>${customer.name} - Ù…Ú©Ù…Ù„ Ú©Ú¾Ø§ØªÛ (Legal Size)</h2>
        <p>ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('ur-PK')} | ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ur-PK')}</p>
    </div>

    <div class="print-customer-info">
        <div class="info-item">
            <strong>Ù†Ø§Ù…:</strong>
            <span>${customer.name}</span>
        </div>
        <div class="info-item">
            <strong>ÙÙˆÙ† Ù†Ù…Ø¨Ø±:</strong>
            <span>${customer.phone || 'ÙØ±Ø§ÛÙ… Ù†ÛÛŒÚº'}</span>
        </div>
        ${customer.address ? `
        <div class="info-item">
            <strong>Ù¾ØªÛ:</strong>
            <span>${customer.address}</span>
        </div>
        ` : ''}
        <div class="info-item">
            <strong>Ú©Ù„ Ø§Ù†Ù¹Ø±ÛŒØ²:</strong>
            <span>${customer.entries ? customer.entries.length : 0}</span>
        </div>
    </div>

    <div class="print-summary">
        <div class="summary-item">
            <h3>${totalRevenue}</h3>
            <p>Ú©Ù„ Ø¨Ù„ (Ø±ÙˆÙ¾Û’)</p>
        </div>
        <div class="summary-item">
            <h3>${totalPayments}</h3>
            <p>Ø§Ø¯Ø§ Ø´Ø¯Û (Ø±ÙˆÙ¾Û’)</p>
        </div>
        <div class="summary-item">
            <h3 class="${remaining > 0 ? 'amount-negative' : remaining < 0 ? 'amount-positive' : 'amount-neutral'}">${remaining}</h3>
            <p>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)</p>
        </div>
        <div class="summary-item">
            <h3>${deliveryEntries.length}</h3>
            <p>ÙØ±Ø§ÛÙ…ÛŒ Ø§Ù†Ù¹Ø±ÛŒØ²</p>
        </div>
    </div>

    ${deliveryEntries.length > 0 ? `
    <div class="section-title">ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ</div>
    <table class="print-entries-table">
        <thead>
            <tr>
                <th>Ø´Ø±ÙˆØ¹</th>
                <th>Ø§Ø®ØªØªØ§Ù…</th>
                <th>Ø¯Ù†</th>
                <th>Ù„ÛŒÙ¹Ø±/Ø¯Ù†</th>
                <th>Ú©Ù„ Ù„ÛŒÙ¹Ø±</th>
                <th>Ø±ÛŒÙ¹</th>
                <th>Ú©Ù„ Ø±Ù‚Ù…</th>
                <th>ØªØ¨ØµØ±Û</th>
            </tr>
        </thead>
        <tbody>
            ${deliveryEntries.map(entry => `
                <tr>
                    <td>${formatDate(entry.fromDate)}</td>
                    <td>${formatDate(entry.toDate)}</td>
                    <td>${entry.days}</td>
                    <td>${entry.liters}</td>
                    <td>${entry.totalLiters}</td>
                    <td>${entry.rate}</td>
                    <td class="amount-positive">${entry.amount}</td>
                    <td>${entry.note || '-'}</td>
                </tr>
            `).join('')}
        </tbody>
    </table>
    ` : ''}

    ${paymentEntries.length > 0 ? `
    <div class="section-title">ğŸ’° Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</div>
    <table class="print-entries-table">
        <thead>
            <tr>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ø±Ù‚Ù…</th>
                <th>ØªØ¨ØµØ±Û</th>
            </tr>
        </thead>
        <tbody>
            ${paymentEntries.map(entry => `
                <tr>
                    <td>${formatDate(entry.date)}</td>
                    <td class="amount-positive">${entry.amount} Ø±ÙˆÙ¾Û’</td>
                    <td>${entry.note || '-'}</td>
                </tr>
            `).join('')}
        </tbody>
    </table>
    ` : ''}

    ${dayOffEntries.length > 0 ? `
    <div class="section-title">ğŸš« Ú†Ú¾Ù¹ÛŒ Ú©Û’ Ø¯Ù†</div>
    <table class="print-entries-table">
        <thead>
            <tr>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>ÙˆØ¬Û</th>
            </tr>
        </thead>
        <tbody>
            ${dayOffEntries.map(entry => `
                <tr>
                    <td>${formatDate(entry.date)}</td>
                    <td>${entry.reason || '-'}</td>
                </tr>
            `).join('')}
        </tbody>
    </table>
    ` : ''}

    <div class="final-summary">
        <h3>ğŸ“Š Ø­ØªÙ…ÛŒ Ø®Ù„Ø§ØµÛ</h3>
        <div class="final-grid">
            <div class="final-item">
                <h4>Ú©Ù„ Ø¨Ù„</h4>
                <div class="value">${totalRevenue} Ø±ÙˆÙ¾Û’</div>
            </div>
            <div class="final-item">
                <h4>Ø§Ø¯Ø§ Ø´Ø¯Û</h4>
                <div class="value">${totalPayments} Ø±ÙˆÙ¾Û’</div>
            </div>
            <div class="final-item">
                <h4>Ø¨Ø§Ù‚ÛŒ</h4>
                <div class="value" style="color: ${remaining > 0 ? '#d32f2f' : '#1b5e20'}">${remaining} Ø±ÙˆÙ¾Û’</div>
            </div>
        </div>
    </div>

    <div class="print-footer">
        <p>Legal Size Report | ${customer.name} | Generated: ${new Date().toLocaleDateString('ur-PK')} ${new Date().toLocaleTimeString('ur-PK')}</p>
        <p><strong>Perfect Urdu Legal Size Printing - Optimized for 8.5" x 14"</strong></p>
    </div>
</body>
</html>`;
            
            return html;
        }

        function createAllCustomersLegalSizeHTML() {
            const html = `<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Customers - Legal Size Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans Arabic', 'Segoe UI', Tahoma, sans-serif;
            direction: rtl;
            line-height: 1.4;
            color: #333;
            background: #fff;
            padding: 20px;
        }
        
        @page {
            size: legal;
            margin: 0.5in;
        }
        
        .print-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .print-header h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .print-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .summary-item {
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 2px solid #667eea;
        }
        
        .summary-item h3 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .customers-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }
        
        .customers-table th,
        .customers-table td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: right;
        }
        
        .customers-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .customers-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .amount-positive { color: #4CAF50; font-weight: bold; }
        .amount-negative { color: #f44336; font-weight: bold; }
        .amount-neutral { color: #2196F3; font-weight: bold; }
        
        .print-footer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="print-header">
        <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
        <h2>ØªÙ…Ø§Ù… Ú¯Ø§ÛÚ©ÙˆÚº Ú©ÛŒ Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹ (Legal Size)</h2>
        <p>ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('ur-PK')} | ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ur-PK')}</p>
    </div>

    ${(() => {
        // Calculate overall totals
        let totalCustomers = customers.length;
        let totalRevenue = 0;
        let totalPayments = 0;
        let totalDeliveries = 0;
        
        customers.forEach(customer => {
            if (customer.entries) {
                customer.entries.forEach(entry => {
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        totalRevenue += days * entry.liters * entry.rate;
                        totalDeliveries++;
                    } else if (entry.type === 'payment') {
                        totalPayments += parseFloat(entry.amount);
                    }
                });
            }
        });
        
        const totalPending = totalRevenue - totalPayments;
        
        return `
        <div class="print-summary">
            <div class="summary-item">
                <h3>${totalCustomers}</h3>
                <p>Ú©Ù„ Ú¯Ø§ÛÚ©</p>
            </div>
            <div class="summary-item">
                <h3>${totalRevenue}</h3>
                <p>Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ</p>
            </div>
            <div class="summary-item">
                <h3>${totalPayments}</h3>
                <p>ÙˆØµÙˆÙ„ Ø´Ø¯Û</p>
            </div>
            <div class="summary-item">
                <h3>${totalPending}</h3>
                <p>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…</p>
            </div>
        </div>
        `;
    })()}

    <table class="customers-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Ù†Ø§Ù…</th>
                <th>ÙÙˆÙ†</th>
                <th>Ú©Ù„ Ø¨Ù„</th>
                <th>Ø§Ø¯Ø§ Ø´Ø¯Û</th>
                <th>Ø¨Ø§Ù‚ÛŒ</th>
                <th>Ø§Ù†Ù¹Ø±ÛŒØ²</th>
            </tr>
        </thead>
        <tbody>
            ${customers.map((customer, index) => {
                let customerRevenue = 0;
                let customerPayments = 0;
                let entryCount = 0;
                
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        entryCount++;
                        if (entry.type === 'delivery') {
                            const days = calculateDays(entry.fromDate, entry.toDate);
                            customerRevenue += days * entry.liters * entry.rate;
                        } else if (entry.type === 'payment') {
                            customerPayments += parseFloat(entry.amount);
                        }
                    });
                }
                
                const customerRemaining = customerRevenue - customerPayments;
                const statusClass = customerRemaining > 0 ? 'amount-negative' : customerRemaining < 0 ? 'amount-positive' : 'amount-neutral';
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${customer.name}</strong></td>
                        <td>${customer.phone || '-'}</td>
                        <td class="amount-neutral">${customerRevenue}</td>
                        <td class="amount-positive">${customerPayments}</td>
                        <td class="${statusClass}">${customerRemaining}</td>
                        <td>${entryCount}</td>
                    </tr>
                `;
            }).join('')}
        </tbody>
    </table>

    <div class="print-footer">
        <p>All Customers Legal Size Report | Generated: ${new Date().toLocaleDateString('ur-PK')} ${new Date().toLocaleTimeString('ur-PK')}</p>
        <p><strong>Perfect Urdu Legal Size Printing - Optimized for 8.5" x 14"</strong></p>
    </div>
</body>
</html>`;
            
            return html;
        }

        function createBusinessSummaryLegalSizeHTML() {
            // Similar implementation for business summary...
            const html = `<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Summary - Legal Size</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            direction: rtl;
            line-height: 1.4;
            color: #333;
            background: #fff;
            padding: 20px;
        }
        
        @page { size: legal; margin: 0.5in; }
        
        .print-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .print-header h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .summary-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="print-header">
        <h1>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©Ø§ Ú©Ø§Ø±ÙˆØ¨Ø§Ø±</h1>
        <h2>Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ Ø®Ù„Ø§ØµÛ (Legal Size)</h2>
        <p>ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('ur-PK')}</p>
    </div>

    <div class="summary-section">
        <h3>ğŸ“Š Ú©Ø§Ø±ÙˆØ¨Ø§Ø±ÛŒ ØªØ¬Ø²ÛŒÛ</h3>
        <p>Total Customers: ${customers.length}</p>
        <p>Report generated for legal size printing (8.5" x 14")</p>
    </div>
</body>
</html>`;
            
            return html;
        }

        function downloadHTMLFile(content, fileName) {
            const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // =================== CUSTOMER MANAGEMENT ===================
        
        function loadCustomers() {
            displayCustomers(customers);
        }

        function displayCustomers(customerList) {
            const grid = document.getElementById('customers-grid');
            if (!grid) return;
            
            grid.innerHTML = '';

            customerList.forEach(customer => {
                const card = document.createElement('div');
                card.className = 'customer-card';
                
                // Calculate customer totals
                let totalRevenue = 0;
                let totalPayments = 0;
                let deliveryCount = 0;
                let paymentCount = 0;
                
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        if (entry.type === 'delivery') {
                            const days = calculateDays(entry.fromDate, entry.toDate);
                            totalRevenue += days * entry.liters * entry.rate;
                            deliveryCount++;
                        } else if (entry.type === 'payment') {
                            totalPayments += parseFloat(entry.amount);
                            paymentCount++;
                        }
                    });
                }
                
                const remaining = totalRevenue - totalPayments;
                const statusEmoji = remaining > 0 ? 'ğŸ”´' : remaining < 0 ? 'ğŸŸ¢' : 'ğŸŸ¡';
                
                card.innerHTML = `
                    <h3>${statusEmoji} ${customer.name}</h3>
                    <p>ğŸ“ ${customer.phone || 'ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº'}</p>
                    ${customer.address ? `<p>ğŸ“ ${customer.address}</p>` : ''}
                    <div style="margin: 15px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                        <p><strong>ğŸ’° Ú©Ù„ Ø¨Ù„:</strong> ${totalRevenue} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>ğŸ’³ Ø§Ø¯Ø§ Ø´Ø¯Û:</strong> ${totalPayments} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>ğŸ“‹ Ø¨Ø§Ù‚ÛŒ:</strong> ${remaining} Ø±ÙˆÙ¾Û’</p>
                        <p><strong>ğŸ“ Ø§Ù†Ù¹Ø±ÛŒØ²:</strong> ${deliveryCount} ÙØ±Ø§ÛÙ…ÛŒ, ${paymentCount} Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</p>
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                        <button class="btn" onclick="event.stopPropagation(); showCustomerLedger(${customer.id})" style="background: #2196F3; padding: 6px 10px; font-size: 11px;">ğŸ“ Ú©Ú¾Ø§ØªÛ</button>
                        <button class="btn" onclick="event.stopPropagation(); generateCustomerLegalSize(${customer.id})" style="background: #4CAF50; padding: 6px 10px; font-size: 11px;">ğŸ–¨ï¸ Legal Print</button>
                        <button class="btn" onclick="event.stopPropagation(); deleteCustomer(${customer.id})" style="background: #f44336; padding: 6px 10px; font-size: 11px;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });

            const addBtn = document.createElement('div');
            addBtn.className = 'customer-card add-customer-card';
            addBtn.innerHTML = 'â•<br><small style="font-size: 0.5em; margin-top: 10px;">Ù†ÛŒØ§ Ú¯Ø§ÛÚ© Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</small>';
            addBtn.onclick = showAddCustomerModal;
            grid.appendChild(addBtn);
        }

        function showAddCustomerModal() {
            document.getElementById('add-customer-modal').style.display = 'flex';
        }

        function addCustomer() {
            const name = document.getElementById('customer-name').value.trim();
            const phone = document.getElementById('customer-phone').value.trim();
            const address = document.getElementById('customer-address').value.trim();
            
            if (!name) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = {
                id: nextId++,
                name: name,
                phone: phone,
                address: address,
                createdAt: new Date().toISOString(),
                entries: []
            };
            
            customers.push(customer);
            saveToStorage();
            
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-address').value = '';
            
            closeModal();
            loadCustomers();
            updateDashboard();
            
            showNotification('Ú¯Ø§ÛÚ© Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
        }

        function deleteCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            showConfirm(`Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ "${customer.name}" Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ`, () => {
                customers = customers.filter(c => c.id !== customerId);
                
                if (currentCustomerId === customerId) {
                    currentCustomerId = null;
                    showCustomers();
                }
                
                saveToStorage();
                loadCustomers();
                updateDashboard();
                
                showNotification(`"${customer.name}" Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø­Ø°Ù ÛÙˆ Ú¯ÛŒØ§!`, 'success');
            });
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) || 
                (customer.phone && customer.phone.includes(searchTerm))
            );
            displayCustomers(filteredCustomers);
        }

        // =================== LEDGER MANAGEMENT ===================

        function showCustomerLedger(customerId) {
            currentCustomerId = customerId;
            const customer = customers.find(c => c.id === customerId);
            
            document.getElementById('ledger-title').textContent = `${customer.name} Ú©Ø§ Ú©Ú¾Ø§ØªÛ`;
            showSection('ledger-section');
            loadLedgerEntries(customerId);
        }

        function loadLedgerEntries(customerId) {
            const customer = customers.find(c => c.id === customerId);
            const container = document.getElementById('ledger-entries');
            
            container.innerHTML = '';

            if (!customer.entries || customer.entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Ú©ÙˆØ¦ÛŒ Ø§Ù†Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</div>';
                updateBillSummary([]);
                return;
            }

            // Sort entries by date (newest first)
            const sortedEntries = [...customer.entries].sort((a, b) => {
                const aDate = new Date(a.date || a.fromDate || a.createdAt);
                const bDate = new Date(b.date || b.fromDate || b.createdAt);
                return bDate - aDate;
            });

            sortedEntries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = `entry-item ${entry.type}`;
                
                if (entry.type === 'delivery') {
                    const days = calculateDays(entry.fromDate, entry.toDate);
                    const totalLiters = days * entry.liters;
                    const total = totalLiters * entry.rate;
                    
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn edit-btn" onclick="editDelivery(${entry.id})" title="ØªØ±Ù…ÛŒÙ… Ú©Ø±ÛŒÚº">âœï¸</button>
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>ğŸ¥› Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ</strong>
                                <div style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    ${total} Ø±ÙˆÙ¾Û’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.fromDate)} Ø³Û’ ${formatDate(entry.toDate)} ØªÚ© (${days} Ø¯Ù†)<br>
                            ğŸ¥› Ø±ÙˆØ²Ø§Ù†Û ${entry.liters} Ù„ÛŒÙ¹Ø± Ã— ${days} Ø¯Ù† = <strong>${totalLiters} Ú©Ù„ Ù„ÛŒÙ¹Ø±</strong><br>
                            ğŸ’° ${totalLiters} Ù„ÛŒÙ¹Ø± Ã— ${entry.rate} Ø±ÙˆÙ¾Û’ = <strong>${total} Ø±ÙˆÙ¾Û’</strong><br>
                            ${entry.note ? `ğŸ“ ${entry.note}<br>` : ''}
                            â° Ø´Ø§Ù…Ù„: ${formatDateTime(entry.createdAt)}
                        </div>
                    `;
                } else if (entry.type === 'day-off') {
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>ğŸš« Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù†</strong>
                                <div style="background: #ff416c; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    Ø¢Ù ÚˆÛ’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.date)}<br>
                            ğŸ“ ${entry.reason || 'Ú©ÙˆØ¦ÛŒ ÙˆØ¬Û Ù†ÛÛŒÚº Ø¯ÛŒ Ú¯Ø¦ÛŒ'}<br>
                            â° Ø´Ø§Ù…Ù„: ${formatDateTime(entry.createdAt)}
                        </div>
                    `;
                }
                
                container.appendChild(entryDiv);
            });

            updateBillSummary(customer.entries);
        }

        function updateBillSummary(entries) {
            let totalLiters = 0;
            let totalDays = 0;
            let totalAmount = 0;
            let totalPayments = 0;
            let deliveryCount = 0;
            let paymentCount = 0;
            let dayOffCount = 0;

            if (entries && entries.length > 0) {
                entries.forEach(entry => {
                    if (entry.type === 'delivery') {
                        const days = calculateDays(entry.fromDate, entry.toDate);
                        const liters = days * parseFloat(entry.liters || 0);
                        const amount = liters * parseFloat(entry.rate || 0);
                        
                        totalLiters += liters;
                        totalDays += days;
                        totalAmount += amount;
                        deliveryCount++;
                    } else if (entry.type === 'payment') {
                        totalPayments += parseFloat(entry.amount || 0);
                        paymentCount++;
                    } else if (entry.type === 'day-off') {
                        dayOffCount++;
                    }
                });
            }

            const remainingAmount = totalAmount - totalPayments;

            document.getElementById('bill-summary').innerHTML = `
                <h3>ğŸ“‹ Ø¨Ù„ Ú©Ø§ Ø®Ù„Ø§ØµÛ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">${deliveryCount}</div>
                        <div>ÙØ±Ø§ÛÙ…ÛŒ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #2196F3; font-weight: bold;">${totalDays}</div>
                        <div>Ú©Ù„ Ø¯Ù†</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #ff9800; font-weight: bold;">${totalLiters}</div>
                        <div>Ú©Ù„ Ù„ÛŒÙ¹Ø±</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #9c27b0; font-weight: bold;">${totalAmount} Ø±ÙˆÙ¾Û’</div>
                        <div>Ú©Ù„ Ø¨Ù„</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">${paymentCount}</div>
                        <div>Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">${totalPayments} Ø±ÙˆÙ¾Û’</div>
                        <div>Ø§Ø¯Ø§ Ø´Ø¯Û</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: ${remainingAmount > 0 ? '#f44336' : '#4CAF50'}; font-weight: bold;">${remainingAmount} Ø±ÙˆÙ¾Û’</div>
                        <div>Ø¨Ø§Ù‚ÛŒ Ø±Ù‚Ù…</div>
                    </div>
                    <div style="text-align: center; background: white; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.5em; color: #ff5722; font-weight: bold;">${dayOffCount}</div>
                        <div>Ú†Ú¾Ù¹ÛŒØ§Úº</div>
                    </div>
                </div>
            `;
        }

        // =================== ENTRY MANAGEMENT ===================

        function showAddDeliveryModal() {
            editingEntryId = null;
            document.getElementById('delivery-modal-title').textContent = 'Ø¯ÙˆØ¯Ú¾ Ú©ÛŒ ÙØ±Ø§ÛÙ…ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            document.getElementById('delivery-submit-btn').textContent = 'Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
            
            clearDeliveryForm();
            document.getElementById('add-delivery-modal').style.display = 'flex';
        }

        function showAddPaymentModal() {
            clearPaymentForm();
            document.getElementById('payment-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('add-payment-modal').style.display = 'flex';
        }

        function showAddDayOffModal() {
            clearDayOffForm();
            document.getElementById('day-off-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('add-day-off-modal').style.display = 'flex';
        }

        function addDelivery() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const fromDate = document.getElementById('delivery-from-date').value;
            const toDate = document.getElementById('delivery-to-date').value;
            const liters = parseFloat(document.getElementById('delivery-liters').value);
            const rate = parseFloat(document.getElementById('delivery-rate').value);
            const note = document.getElementById('delivery-note').value.trim();
            
            if (!fromDate || !toDate || !liters || !rate) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… Ø¶Ø±ÙˆØ±ÛŒ ÙÛŒÙ„ÚˆØ² Ø¨Ú¾Ø±ÛŒÚº', 'error');
                return;
            }
            
            if (new Date(fromDate) > new Date(toDate)) {
                showNotification('Ø§Ø®ØªØªØ§Ù… Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø³Û’ Ù¾ÛÙ„Û’ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ØªÛŒ', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.entries) {
                customer.entries = [];
            }
            
            if (editingEntryId) {
                const entryIndex = customer.entries.findIndex(e => e.id === editingEntryId);
                if (entryIndex > -1) {
                    customer.entries[entryIndex] = {
                        ...customer.entries[entryIndex],
                        fromDate: fromDate,
                        toDate: toDate,
                        liters: liters,
                        rate: rate,
                        note: note,
                        updatedAt: new Date().toISOString()
                    };
                    showNotification('ÙØ±Ø§ÛÙ…ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
                }
            } else {
                const entry = {
                    id: Date.now(),
                    type: 'delivery',
                    fromDate: fromDate,
                    toDate: toDate,
                    liters: liters,
                    rate: rate,
                    note: note,
                    createdAt: new Date().toISOString()
                };
                
                customer.entries.push(entry);
                showNotification('ÙØ±Ø§ÛÙ…ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
            }
            
            saveToStorage();
            clearDeliveryForm();
            closeModal();
            loadLedgerEntries(currentCustomerId);
            loadCustomers();
            updateDashboard();
        }

        function addPayment() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const date = document.getElementById('payment-date').value;
            const note = document.getElementById('payment-note').value.trim();
            
            if (!amount || !date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù‚Ù… Ø§ÙˆØ± ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.entries) {
                customer.entries = [];
            }
            
            const payment = {
                id: Date.now(),
                type: 'payment',
                amount: amount,
                date: date,
                note: note,
                createdAt: new Date().toISOString()
            };
            
            customer.entries.push(payment);
            saveToStorage();
            
            clearPaymentForm();
            closeModal();
            loadLedgerEntries(currentCustomerId);
            loadCustomers();
            updateDashboard();
            
            showNotification('Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
        }

        function addDayOff() {
            if (!currentCustomerId) {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const date = document.getElementById('day-off-date').value;
            const reason = document.getElementById('day-off-reason').value.trim();
            
            if (!date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id === currentCustomerId);
            if (!customer.entries) {
                customer.entries = [];
            }
            
            const dayOff = {
                id: Date.now(),
                type: 'day-off',
                date: date,
                reason: reason,
                createdAt: new Date().toISOString()
            };
            
            customer.entries.push(dayOff);
            saveToStorage();
            
            clearDayOffForm();
            closeModal();
            loadLedgerEntries(currentCustomerId);
            updateDashboard();
            
            showNotification('Ú†Ú¾Ù¹ÛŒ Ú©Ø§ Ø¯Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§!', 'success');
        }

        function editDelivery(entryId) {
            const customer = customers.find(c => c.id === currentCustomerId);
            const entry = customer.entries.find(e => e.id === entryId);
            
            if (!entry || entry.type !== 'delivery') {
                showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                return;
            }
            
            editingEntryId = entryId;
            document.getElementById('delivery-modal-title').textContent = 'ÙØ±Ø§ÛÙ…ÛŒ Ù…ÛŒÚº ØªØ±Ù…ÛŒÙ… Ú©Ø±ÛŒÚº';
            document.getElementById('delivery-submit-btn').textContent = 'Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            
            document.getElementById('delivery-from-date').value = entry.fromDate;
            document.getElementById('delivery-to-date').value = entry.toDate;
            document.getElementById('delivery-liters').value = entry.liters;
            document.getElementById('delivery-rate').value = entry.rate;
            document.getElementById('delivery-note').value = entry.note || '';
            
            document.getElementById('add-delivery-modal').style.display = 'flex';
        }

        function deleteEntry(entryId) {
            showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÛ Ø§Ù†Ù¹Ø±ÛŒ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ', () => {
                const customer = customers.find(c => c.id === currentCustomerId);
                customer.entries = customer.entries.filter(e => e.id !== entryId);
                
                saveToStorage();
                loadLedgerEntries(currentCustomerId);
                loadCustomers();
                updateDashboard();
                
                showNotification('Ø§Ù†Ù¹Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø­Ø°Ù ÛÙˆ Ú¯Ø¦ÛŒ!', 'success');
            });
        }

        // =================== SAMPLE DATA ===================

        function addSampleData() {
            if (customers.length > 0) {
                showConfirm('Ú©ÛŒØ§ Ø¢Ù¾ sample data Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ (Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø±ÛÛ’ Ú¯Ø§)', () => {
                    createSampleData();
                });
            } else {
                createSampleData();
            }
        }

        function createSampleData() {
            const sampleCustomers = [
                {
                    id: nextId++,
                    name: 'Ø§Ø­Ù…Ø¯ Ø¹Ù„ÛŒ',
                    phone: '03001234567',
                    address: 'Ú¯Ù„ÛŒ Ù†Ù…Ø¨Ø± 5ØŒ Ù…Ø­Ù„Û Ø´Ø§Û Ù¾ÙˆØ±',
                    createdAt: new Date('2025-01-01').toISOString(),
                    entries: [
                        {
                            id: Date.now() + 1,
                            type: 'delivery',
                            fromDate: '2025-01-01',
                            toDate: '2025-01-31',
                            liters: 2,
                            rate: 120,
                            note: 'ØµØ¨Ø­ Ø´Ø§Ù… Ø¯ÙˆØ¯Ú¾',
                            createdAt: new Date('2025-01-01').toISOString()
                        },
                        {
                            id: Date.now() + 2,
                            type: 'payment',
                            date: '2025-01-15',
                            amount: 3000,
                            note: 'Ù¾ÛÙ„ÛŒ Ù‚Ø³Ø·',
                            createdAt: new Date('2025-01-15').toISOString()
                        },
                        {
                            id: Date.now() + 3,
                            type: 'delivery',
                            fromDate: '2025-02-01',
                            toDate: '2025-02-28',
                            liters: 2.5,
                            rate: 125,
                            note: 'ÙØ±ÙˆØ±ÛŒ Ú©Ø§ Ø¯ÙˆØ¯Ú¾',
                            createdAt: new Date('2025-02-01').toISOString()
                        }
                    ]
                },
                {
                    id: nextId++,
                    name: 'ÙØ§Ø·Ù…Û Ø®Ø§Ù†',
                    phone: '03009876543',
                    address: 'Ú©ÙˆÙ¹ Ù„Ú©Ú¾Ù¾ØªØŒ Ù„Ø§ÛÙˆØ±',
                    createdAt: new Date('2025-01-15').toISOString(),
                    entries: [
                        {
                            id: Date.now() + 4,
                            type: 'delivery',
                            fromDate: '2025-01-15',
                            toDate: '2025-02-14',
                            liters: 1.5,
                            rate: 115,
                            note: 'ØµØ±Ù ØµØ¨Ø­',
                            createdAt: new Date('2025-01-15').toISOString()
                        },
                        {
                            id: Date.now() + 5,
                            type: 'payment',
                            date: '2025-02-01',
                            amount: 2500,
                            note: 'Ù…Ú©Ù…Ù„ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ',
                            createdAt: new Date('2025-02-01').toISOString()
                        },
                        {
                            id: Date.now() + 6,
                            type: 'day-off',
                            date: '2025-02-10',
                            reason: 'Ø´Ø§Ø¯ÛŒ Ú©ÛŒ ØªÙ‚Ø±ÛŒØ¨',
                            createdAt: new Date('2025-02-10').toISOString()
                        }
                    ]
                },
                {
                    id: nextId++,
                    name: 'Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†',
                    phone: '03005555555',
                    address: 'Ù…Ø§Ù„ Ø±ÙˆÚˆØŒ Ú©ÛŒÙ†Ù¹',
                    createdAt: new Date('2025-02-01').toISOString(),
                    entries: [
                        {
                            id: Date.now() + 7,
                            type: 'delivery',
                            fromDate: '2025-02-01',
                            toDate: '2025-02-28',
                            liters: 3,
                            rate: 125,
                            note: 'Ø¨Ú¾ÛŒÙ†Ø³ Ú©Ø§ Ø¯ÙˆØ¯Ú¾',
                            createdAt: new Date('2025-02-01').toISOString()
                        },
                        {
                            id: Date.now() + 8,
                            type: 'day-off',
                            date: '2025-02-15',
                            reason: 'Ø¹ÛŒØ¯ Ú©ÛŒ Ú†Ú¾Ù¹ÛŒ',
                            createdAt: new Date('2025-02-15').toISOString()
                        }
                    ]
                }
            ];

            customers.push(...sampleCustomers);
            saveToStorage();
            loadCustomers();
            updateDashboard();
            
            showNotification('Sample data Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§! Ø§Ø¨ Ø¢Ù¾ Legal Size printing test Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº', 'success');
        }

        // =================== UTILITY FUNCTIONS ===================

        function calculateDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ur-PK');
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return `${date.toLocaleDateString('ur-PK')} ${date.toLocaleTimeString('ur-PK')}`;
        }

        function updateDashboard() {
            let totalRevenue = 0;
            let totalPayments = 0;
            let totalCustomers = customers.length;
            
            customers.forEach(customer => {
                if (customer.entries) {
                    customer.entries.forEach(entry => {
                        if (entry.type === 'delivery') {
                            const days = calculateDays(entry.fromDate, entry.toDate);
                            totalRevenue += days * entry.liters * entry.rate;
                        } else if (entry.type === 'payment') {
                            totalPayments += parseFloat(entry.amount);
                        }
                    });
                }
            });
            
            const pendingAmount = totalRevenue - totalPayments;
            
            if (document.getElementById('total-customers-stat')) {
                document.getElementById('total-customers-stat').textContent = totalCustomers;
                document.getElementById('total-revenue-stat').textContent = totalRevenue;
                document.getElementById('total-payments-stat').textContent = totalPayments;
                document.getElementById('pending-amount-stat').textContent = pendingAmount;
            }
        }

        // =================== FORM HELPERS ===================

        function clearDeliveryForm() {
            document.getElementById('delivery-from-date').value = '';
            document.getElementById('delivery-to-date').value = '';
            document.getElementById('delivery-liters').value = '';
            document.getElementById('delivery-rate').value = '';
            document.getElementById('delivery-note').value = '';
        }

        function clearPaymentForm() {
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-date').value = '';
            document.getElementById('payment-note').value = '';
        }

        function clearDayOffForm() {
            document.getElementById('day-off-date').value = '';
            document.getElementById('day-off-reason').value = '';
        }

        // =================== NAVIGATION ===================
        
        function showDashboard() {
            setActiveNav(0);
            showSection('dashboard-section');
            updateDashboard();
        }

        function showCustomers() {
            setActiveNav(1);
            showSection('customers-section');
            loadCustomers();
        }

        function showLedger() {
            if (currentCustomerId) {
                setActiveNav(2);
                showSection('ledger-section');
                loadLedgerEntries(currentCustomerId);
            } else {
                showNotification('Ù¾ÛÙ„Û’ Ú¯Ø§ÛÚ© Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'info');
                showCustomers();
            }
        }

        function showReports() {
            setActiveNav(3);
            showSection('reports-section');
        }

        function showBackup() {
            setActiveNav(4);
            showSection('backup-section');
        }

        function setActiveNav(index) {
            document.querySelectorAll('.nav-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function showSection(sectionId) {
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            editingEntryId = null;
        }

        // =================== NOTIFICATIONS ===================

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                font-size: 14px;
                direction: rtl;
                opacity: 0;
                transition: opacity 0.3s ease;
                font-family: 'Noto Sans Arabic', sans-serif;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        function showConfirm(message, callback) {
            const confirmDiv = document.createElement('div');
            confirmDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Noto Sans Arabic', sans-serif;
            `;
            
            confirmDiv.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; direction: rtl; text-align: center;">
                    <p style="margin-bottom: 20px; font-size: 16px; color: #333;">${message}</p>
                    <div>
                        <button id="confirm-yes" style="background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 8px; margin: 5px; cursor: pointer; font-family: 'Noto Sans Arabic', sans-serif;">ÛØ§Úº</button>
                        <button id="confirm-no" style="background: #f44336; color: white; border: none; padding: 12px 25px; border-radius: 8px; margin: 5px; cursor: pointer; font-family: 'Noto Sans Arabic', sans-serif;">Ù†ÛÛŒÚº</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
            
            document.getElementById('confirm-yes').onclick = function() {
                document.body.removeChild(confirmDiv);
                callback();
            };
            
            document.getElementById('confirm-no').onclick = function() {
                document.body.removeChild(confirmDiv);
            };
        }

        // =================== EVENT LISTENERS ===================

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'n':
                        e.preventDefault();
                        if (!document.querySelector('.modal').style.display || document.querySelector('.modal').style.display === 'none') {
                            showAddCustomerModal();
                        }
                        break;
                    case 'p':
                        e.preventDefault();
                        if (currentCustomerId) {
                            generateCurrentCustomerLegalSize();
                        } else {
                            generateAllCustomersLegalSize();
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        saveToStorage();
                        showNotification('ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§!', 'success');
                        break;
                }
            }
        });

        // Auto-save every 30 seconds
        setInterval(() => {
            saveToStorage();
        }, 30000);

    </script>
</body>
</html>>
                    `;
                } else if (entry.type === 'payment') {
                    entryDiv.innerHTML = `
                        <div class="entry-actions">
                            <button class="entry-action-btn delete-btn" onclick="deleteEntry(${entry.id})" title="Ø­Ø°Ù Ú©Ø±ÛŒÚº">ğŸ—‘ï¸</button>
                        </div>
                        <div class="entry-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>ğŸ’° Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</strong>
                                <div style="background: #2196F3; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    ${entry.amount} Ø±ÙˆÙ¾Û’
                                </div>
                            </div>
                            ğŸ“… ${formatDate(entry.date)}<br>
                            ğŸ’° ${entry.amount} Ø±ÙˆÙ¾Û’<br>
                            ${entry.note ? `ğŸ“ ${entry.note}<br>` : ''}
                            â° Ø´Ø§Ù…Ù„: ${formatDateTime(entry.createdAt)}
                        </div
